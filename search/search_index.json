{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Tools for document mkdocks, markdown, mermaid for diagrams https://github.com/mermaid-js/mermaid For full documentation visit mkdocs.org . Commands mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs -h - Print help message and exit. Project layout mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files. Documentation","title":"Introducion"},{"location":"#tools-for-document","text":"mkdocks, markdown, mermaid for diagrams https://github.com/mermaid-js/mermaid For full documentation visit mkdocs.org .","title":"Tools for document"},{"location":"#commands","text":"mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs -h - Print help message and exit.","title":"Commands"},{"location":"#project-layout","text":"mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"Project layout"},{"location":"backend%20copy/","text":"nodemon mainitaan my\u00f6s packages One abroach is to save geometries of client to document of users collection. this could be if client need data from several years. These needs can be handle by separatly from the frontend tool. Automaattinen p\u00e4ivitys joka vuorokausi tai heiman harvemmin vaikka joka vain kasvukaudella!!!! kasvukauden ulkopuolella vain uudet asiskkaat saavat uutta dataa mutta t\u00e4ll\u00f6in sentinelhub minimi sopimus. kavukaudella tarvitaan resursseja!!! LIS\u00c4\u00c4 komnettijokaisen metodin yl\u00e4puoleel niin ett\u00e4 paramterit ja paluuarvo kerrotaan teht\u00e4v\u00e4 p\u00e4ivitt\u00e4\u00e4 databasea sentineklHub NDVi image datalla. palauttaa piv\u00e4mm\u00e4rt ja statistikkaa niilt\u00e4 p\u00e4ivilt\u00e4 haliutulla aikaj\u00e4ntell\u00e4 jloille on ndv-dataa saatavilla palauttaa NDVI-image SOCKET yhtey My\u00f6s users colelction jossa k\u00e4ytt\u00e4j\u00e4kohtaiset pellot TARINA videoon On olemassa tietokanta, jossa on k\u00e4ytt\u00e4j\u00e4 ei companyid kohtaiset peltogeometriat n\u00e4m\u00e4 voidaan launchata activate routeen NDVI forntendiss\u00e4 testi joka ajaa monta samamakaista datasetti\u00e4 ko. routeen. Samalla fronnti moni toroi socketin kautta edistymist\u00e4 kunkin comapnyIdeen kohdalla workareacount prosenntein workarea.lenght. Concurrentjuttuja list:ss\u00e4 imagejen suhteen activate: dates & statistics suhteen. T\u00e4m\u00e4 demo ei ota kantaa mist\u00e4 c because of need to get data as fast as possible we must speedup getiing data using concurrent processes axios.all will help Because all servers has specifig limits so sentinelhub has too for https://docs.sentinel-hub.com/api/latest/api/overview/rate-limiting/ there ways to update and get the imnage related data update when navigatinf specifig geometry area first check from sentinel (mitk\u00e4 ehdot jos t\u00e4m\u00e4 p\u00e4iv\u00e4 on uudempi kuin mik\u00e4 on viimeisin dates-taulussa/kollectionissa) ja muita kascukaudella!!! Jos in uusi AOI niin silloin ei tsekata ekana kascukautta ja hyl\u00e4t\u00e4 \"talvella\" vaan jos dates-data l\u00f6ytyy niin on kyse p\u00e4vityksest\u00e4 ja sillon vain kasvukaudella. TESTI Siis geometria on avain ja haetaan dates-p\u00e4iv\u00e4t sentinelilt\u00e4 jos ei ole kannassa jos on kannassa niin haetaan viimeinen p\u00e4iv\u00e4ys ja verrataan nykyp\u00e4iv\u00e4\u00e4n jos ei ole smaat niin k\u00e4yd\u00e4\u00e4n hakemassa sentinellt\u00e4 viimeisen dates p\u00e4iv\u00e4yksen ja t\u00e4m\u00e4n jetken v\u00e4liseslt\u00e4 ajakta dataa. testaa kaukanko kest\u00e4\u00e4 esim. muutama p\u00e4iv\u00e4 verratuna koko kasvukauteen hakea!!! ststus codes 429 ??? token 404 SECRETS in .env file in developing mode in production should put the secrets service environtment variables","title":"Backend copy"},{"location":"backend/","text":"Huom joissa middleware on yteys senetinelhubiin joka tarvii tokenin middleware hoitaa sen voimassa olon (1h kerrallaan) NDVI-routes jatkoksi kontrooleista JSDOC ja sequence sequenceDiagram participant Client participant Middleware participant Controller Client ->> Middleware: POST /list Middleware ->> Middleware: checkToken Middleware -->> Controller: Forward request Controller -->> Client: Response Client ->> Middleware: POST /activate Middleware ->> Middleware: checkToken Middleware -->> Controller: Forward request Controller -->> Client: Response Client ->> Controller: GET /image/:sentinelid Controller -->> Client: Response Client ->> Controller: POST /weather Controller -->> Client: Response Client ->> Controller: GET /status Controller -->> Client: Response Client ->> Controller: GET /aois Controller -->> Client: Response You can create some authorization mechanims for this assignment (admin can see/modify all the reservations, worker can see/modify only own made reservations, etc..). Using simple authentication module like require('passport') or JWT is enough. Core requirements, grade 0-3 A new Worker, Client and Service can be created, modified, deleted Worker can create a new reservation with client and service information Worker can see a list of only own made reservations Worker can edit/delete only own made reservation Extra requirements, grade 4-5 Reservation can contain multiple services in same reservation Admin can see all the worker data (name, phone, email, etc...) Admin can see the list of all reservations Admin can modify all available reservations Use JWT or similar for the access token implementation Client (testing service) Use Postman or Visual Studio Code RestClient to test your RESTful service. You don't need to do any client UI implementation to your application, but if you have skills and/or time you can use some client side framework like React, Angular or Vue to create a basic UI to your application. Documentation You need to include your planning documentation, which includes for example REST endpoints used, structure of your application, which APIs (and npms) will be used, what features you are going to implement, etc... You need to keep track of your doing, which includes: day, task/feature information, time spent. Include also total hours. Every student need to keep that! Include final documentation which describes what you have done and what planned features are implemented and are working in your app. Describe application architecture shown graphically, structure, function relationships, application relationships to files, databases, etc. At the end, write your own feelings about your work with grade proposal. What parts of the project you found were easy, what parts were hard, what was the greatest learning experience for you during the project, any additional info you might want to provide. Self evaluation grade number about your work. Remember include link to a video where you demo your app. Use your repository README.md (or multiple md's) to create your documentation. Remember add your name and course what you are participating. Returning Create your own repository to our GitLab/Labranet and add at least a reporter role to Pasi Manninen for the evaluation purposes. This repository should contain all the source codes and documentation. The repository must contain all the programming codes used in the application. Remember tell which codes have been learned from the tutorials and / or partially copied from elsewhere on the Internet or from the books. The source URLs of the other implemented codes used must be clearly displayed and told. All the programming codes are clearly commented. It is also clearly told what codes have been done by yourself (your own made codes). Use a read.me file or wikis for the project documentation. The results of the assignments are presented in a seminar or with a recorded video. For video recording, student can use e.g. Screencast-O-Matic. For storing, student can use e.g. YouTube or other cloud service because repositories are limites to 500 MB in GitLab/JAMK. Grading Grading is based on following: Project work has been done throughout the course (not only in the last days) Informativeness of the documentation Number of the completed features App and code structure, cleanes, commenting, error-free code Quality of the code RESTful implementation Taking advantage and usage of external libraries Results and their analysis Reporting and presentation Extra credit can be aquired by writing some tests Also tried Python approach and PostgreSQL as a database. but for this demo MERN-stack is the one/selected for the technology mostly because of previous experieces and estimate for the success insert data into database TOKEN tarvitaan alimmainen tuosta kuvasta https://fullstackopen.com/osa4/token_perustainen_kirjautuminen Backend on toteutettu Node.js:n p\u00e4\u00e4ll\u00e4 toimivaa Express-kirjastoa k\u00e4ytt\u00e4m\u00e4ll\u00e4. Tietokanta on MongoDB-palvelussa, kannan tyyppi on NoSQL. MongoDB-tietokannan k\u00e4sittelyyn k\u00e4ytet\u00e4\u00e4n Mongoose-kirjaston metodeja. Speedup, \"unofficial way\" to use axios.all parallel requests Node is yksis\u00f6ikeinen threa toisin kui Python not so ... could had been better choice of the future manner. sentinel-hub, fillin g the databse restrictions for basic play whcih free account is needed many acounts to get work to done. Pretty big load for this kind of job to done/finished, time consuming and resourse consuming too. Limits and restrcitiosn takes a palace are true. VIDEO data studio n\u00e4kym\u00e4 ett\u00e4 mit\u00e4 tapahtuu kun jokin k\u00e4sky annetaan, mutta kuinka videota editoidaan ett\u00e4 saadaan odotusaika N\u00e4yt\u00e4 my\u00f6s deployment Azure mahd. console.log Toiminnastahan ei varsinaisesti videota muuta kuin frontista ja logista developert tilassa locaalisesti loggeri morgan vaan kerrotaan kehitysasioista!!!! ehk\u00f6\u00e4 sentinelhubin resursseista ja niiden kulumisesta!!! Mahdollisesti piperline ja muuotsten n\u00e4kyvyys jotenkin. Esimerkkin\u00e4 pelto jolle ei viel\u00e4 dataa ja kuinka sentinelhub consuming ja database update Many way to keep data up to date, if conditions for save satellite data meet cron, user or tools on frontend will do it for spcifig geometries AOI (area of interest) usea ikkuna jaeettu oikalla mesta esim. 4 osaako skaalata samaan aikaan 4 peltoa Container make a change and see the results let tools and test dev-routes out of this document Azure data studio mongo shell commands -> screenshots examples: use ndvidb db.users.updateOne({ email: 'laakkti@outlook.com' },{ $set: { admin: true } }) delete item db.users.deleteOne({_id: ObjectId(\"66222e420dacd3041c02f44e\")}); Routes list image dev-routes to maintenance and update database nodemon mainitaan my\u00f6s packages One approach is to save geometries of client to document of users collection. this could be if client need data from several years. These needs can be handle by separatly from the frontend tool. Automaattinen p\u00e4ivitys joka vuorokausi tai heiman harvemmin vaikka joka vain kasvukaudella!!!! kasvukauden ulkopuolella vain uudet asiskkaat saavat uutta dataa mutta t\u00e4ll\u00f6in sentinelhub minimi sopimus. kavukaudella tarvitaan resursseja!!! LIS\u00c4\u00c4 komnettijokaisen metodin yl\u00e4puoleel niin ett\u00e4 paramterit ja paluuarvo kerrotaan teht\u00e4v\u00e4 p\u00e4ivitt\u00e4\u00e4 databasea sentineklHub NDVi image datalla. palauttaa piv\u00e4mm\u00e4rt ja statistikkaa niilt\u00e4 p\u00e4ivilt\u00e4 haliutulla aikaj\u00e4ntell\u00e4 jloille on ndv-dataa saatavilla palauttaa NDVI-image SOCKET yhtey My\u00f6s users colelction jossa k\u00e4ytt\u00e4j\u00e4kohtaiset pellot TARINA videoon On olemassa tietokanta, jossa on k\u00e4ytt\u00e4j\u00e4 ei companyid kohtaiset peltogeometriat n\u00e4m\u00e4 voidaan launchata activate routeen NDVI forntendiss\u00e4 testi joka ajaa monta samamakaista datasetti\u00e4 ko. routeen. Samalla fronnti moni toroi socketin kautta edistymist\u00e4 kunkin comapnyIdeen kohdalla workareacount prosenntein workarea.lenght. Concurrentjuttuja list:ss\u00e4 imagejen suhteen activate: dates & statistics suhteen. T\u00e4m\u00e4 demo ei ota kantaa mist\u00e4 c because of need to get data as fast as possible we must speedup getiing data using concurrent processes axios.all will help Because all servers has specifig limits so sentinelhub has too for https://docs.sentinel-hub.com/api/latest/api/overview/rate-limiting/ there ways to update and get the imnage related data update when navigatinf specifig geometry area first check from sentinel (mitk\u00e4 ehdot jos t\u00e4m\u00e4 p\u00e4iv\u00e4 on uudempi kuin mik\u00e4 on viimeisin dates-taulussa/kollectionissa) ja muita kascukaudella!!! Jos in uusi AOI niin silloin ei tsekata ekana kascukautta ja hyl\u00e4t\u00e4 \"talvella\" vaan jos dates-data l\u00f6ytyy niin on kyse p\u00e4vityksest\u00e4 ja sillon vain kasvukaudella. TESTI Siis geometria on avain ja haetaan dates-p\u00e4iv\u00e4t sentinelilt\u00e4 jos ei ole kannassa jos on kannassa niin haetaan viimeinen p\u00e4iv\u00e4ys ja verrataan nykyp\u00e4iv\u00e4\u00e4n jos ei ole smaat niin k\u00e4yd\u00e4\u00e4n hakemassa sentinellt\u00e4 viimeisen dates p\u00e4iv\u00e4yksen ja t\u00e4m\u00e4n jetken v\u00e4liseslt\u00e4 ajakta dataa. testaa kaukanko kest\u00e4\u00e4 esim. muutama p\u00e4iv\u00e4 verratuna koko kasvukauteen hakea!!! ststus codes 429 ??? token 404 SECRETS in .env file in developing mode in production should put the secrets service environtment variables","title":"Backend"},{"location":"backend/#ndvi-routes-jatkoksi-kontrooleista-jsdoc-ja-sequence","text":"sequenceDiagram participant Client participant Middleware participant Controller Client ->> Middleware: POST /list Middleware ->> Middleware: checkToken Middleware -->> Controller: Forward request Controller -->> Client: Response Client ->> Middleware: POST /activate Middleware ->> Middleware: checkToken Middleware -->> Controller: Forward request Controller -->> Client: Response Client ->> Controller: GET /image/:sentinelid Controller -->> Client: Response Client ->> Controller: POST /weather Controller -->> Client: Response Client ->> Controller: GET /status Controller -->> Client: Response Client ->> Controller: GET /aois Controller -->> Client: Response You can create some authorization mechanims for this assignment (admin can see/modify all the reservations, worker can see/modify only own made reservations, etc..). Using simple authentication module like require('passport') or JWT is enough. Core requirements, grade 0-3 A new Worker, Client and Service can be created, modified, deleted Worker can create a new reservation with client and service information Worker can see a list of only own made reservations Worker can edit/delete only own made reservation Extra requirements, grade 4-5 Reservation can contain multiple services in same reservation Admin can see all the worker data (name, phone, email, etc...) Admin can see the list of all reservations Admin can modify all available reservations Use JWT or similar for the access token implementation Client (testing service) Use Postman or Visual Studio Code RestClient to test your RESTful service. You don't need to do any client UI implementation to your application, but if you have skills and/or time you can use some client side framework like React, Angular or Vue to create a basic UI to your application. Documentation You need to include your planning documentation, which includes for example REST endpoints used, structure of your application, which APIs (and npms) will be used, what features you are going to implement, etc... You need to keep track of your doing, which includes: day, task/feature information, time spent. Include also total hours. Every student need to keep that! Include final documentation which describes what you have done and what planned features are implemented and are working in your app. Describe application architecture shown graphically, structure, function relationships, application relationships to files, databases, etc. At the end, write your own feelings about your work with grade proposal. What parts of the project you found were easy, what parts were hard, what was the greatest learning experience for you during the project, any additional info you might want to provide. Self evaluation grade number about your work. Remember include link to a video where you demo your app. Use your repository README.md (or multiple md's) to create your documentation. Remember add your name and course what you are participating. Returning Create your own repository to our GitLab/Labranet and add at least a reporter role to Pasi Manninen for the evaluation purposes. This repository should contain all the source codes and documentation. The repository must contain all the programming codes used in the application. Remember tell which codes have been learned from the tutorials and / or partially copied from elsewhere on the Internet or from the books. The source URLs of the other implemented codes used must be clearly displayed and told. All the programming codes are clearly commented. It is also clearly told what codes have been done by yourself (your own made codes). Use a read.me file or wikis for the project documentation. The results of the assignments are presented in a seminar or with a recorded video. For video recording, student can use e.g. Screencast-O-Matic. For storing, student can use e.g. YouTube or other cloud service because repositories are limites to 500 MB in GitLab/JAMK. Grading Grading is based on following: Project work has been done throughout the course (not only in the last days) Informativeness of the documentation Number of the completed features App and code structure, cleanes, commenting, error-free code Quality of the code RESTful implementation Taking advantage and usage of external libraries Results and their analysis Reporting and presentation Extra credit can be aquired by writing some tests Also tried Python approach and PostgreSQL as a database. but for this demo MERN-stack is the one/selected for the technology mostly because of previous experieces and estimate for the success insert data into database TOKEN tarvitaan alimmainen tuosta kuvasta https://fullstackopen.com/osa4/token_perustainen_kirjautuminen Backend on toteutettu Node.js:n p\u00e4\u00e4ll\u00e4 toimivaa Express-kirjastoa k\u00e4ytt\u00e4m\u00e4ll\u00e4. Tietokanta on MongoDB-palvelussa, kannan tyyppi on NoSQL. MongoDB-tietokannan k\u00e4sittelyyn k\u00e4ytet\u00e4\u00e4n Mongoose-kirjaston metodeja. Speedup, \"unofficial way\" to use axios.all parallel requests Node is yksis\u00f6ikeinen threa toisin kui Python not so ... could had been better choice of the future manner. sentinel-hub, fillin g the databse restrictions for basic play whcih free account is needed many acounts to get work to done. Pretty big load for this kind of job to done/finished, time consuming and resourse consuming too. Limits and restrcitiosn takes a palace are true.","title":"NDVI-routes jatkoksi kontrooleista JSDOC ja sequence"},{"location":"backend/#video","text":"data studio n\u00e4kym\u00e4 ett\u00e4 mit\u00e4 tapahtuu kun jokin k\u00e4sky annetaan, mutta kuinka videota editoidaan ett\u00e4 saadaan odotusaika N\u00e4yt\u00e4 my\u00f6s deployment Azure mahd. console.log Toiminnastahan ei varsinaisesti videota muuta kuin frontista ja logista developert tilassa locaalisesti loggeri morgan vaan kerrotaan kehitysasioista!!!! ehk\u00f6\u00e4 sentinelhubin resursseista ja niiden kulumisesta!!! Mahdollisesti piperline ja muuotsten n\u00e4kyvyys jotenkin. Esimerkkin\u00e4 pelto jolle ei viel\u00e4 dataa ja kuinka sentinelhub consuming ja database update Many way to keep data up to date, if conditions for save satellite data meet cron, user or tools on frontend will do it for spcifig geometries AOI (area of interest) usea ikkuna jaeettu oikalla mesta esim. 4 osaako skaalata samaan aikaan 4 peltoa Container make a change and see the results let tools and test dev-routes out of this document Azure data studio mongo shell commands -> screenshots examples: use ndvidb db.users.updateOne({ email: 'laakkti@outlook.com' },{ $set: { admin: true } }) delete item db.users.deleteOne({_id: ObjectId(\"66222e420dacd3041c02f44e\")});","title":"VIDEO"},{"location":"backend/#routes","text":"list image dev-routes to maintenance and update database nodemon mainitaan my\u00f6s packages One approach is to save geometries of client to document of users collection. this could be if client need data from several years. These needs can be handle by separatly from the frontend tool. Automaattinen p\u00e4ivitys joka vuorokausi tai heiman harvemmin vaikka joka vain kasvukaudella!!!! kasvukauden ulkopuolella vain uudet asiskkaat saavat uutta dataa mutta t\u00e4ll\u00f6in sentinelhub minimi sopimus. kavukaudella tarvitaan resursseja!!! LIS\u00c4\u00c4 komnettijokaisen metodin yl\u00e4puoleel niin ett\u00e4 paramterit ja paluuarvo kerrotaan teht\u00e4v\u00e4 p\u00e4ivitt\u00e4\u00e4 databasea sentineklHub NDVi image datalla. palauttaa piv\u00e4mm\u00e4rt ja statistikkaa niilt\u00e4 p\u00e4ivilt\u00e4 haliutulla aikaj\u00e4ntell\u00e4 jloille on ndv-dataa saatavilla palauttaa NDVI-image SOCKET yhtey My\u00f6s users colelction jossa k\u00e4ytt\u00e4j\u00e4kohtaiset pellot TARINA videoon On olemassa tietokanta, jossa on k\u00e4ytt\u00e4j\u00e4 ei companyid kohtaiset peltogeometriat n\u00e4m\u00e4 voidaan launchata activate routeen NDVI forntendiss\u00e4 testi joka ajaa monta samamakaista datasetti\u00e4 ko. routeen. Samalla fronnti moni toroi socketin kautta edistymist\u00e4 kunkin comapnyIdeen kohdalla workareacount prosenntein workarea.lenght. Concurrentjuttuja list:ss\u00e4 imagejen suhteen activate: dates & statistics suhteen. T\u00e4m\u00e4 demo ei ota kantaa mist\u00e4 c because of need to get data as fast as possible we must speedup getiing data using concurrent processes axios.all will help Because all servers has specifig limits so sentinelhub has too for https://docs.sentinel-hub.com/api/latest/api/overview/rate-limiting/ there ways to update and get the imnage related data update when navigatinf specifig geometry area first check from sentinel (mitk\u00e4 ehdot jos t\u00e4m\u00e4 p\u00e4iv\u00e4 on uudempi kuin mik\u00e4 on viimeisin dates-taulussa/kollectionissa) ja muita kascukaudella!!! Jos in uusi AOI niin silloin ei tsekata ekana kascukautta ja hyl\u00e4t\u00e4 \"talvella\" vaan jos dates-data l\u00f6ytyy niin on kyse p\u00e4vityksest\u00e4 ja sillon vain kasvukaudella. TESTI Siis geometria on avain ja haetaan dates-p\u00e4iv\u00e4t sentinelilt\u00e4 jos ei ole kannassa jos on kannassa niin haetaan viimeinen p\u00e4iv\u00e4ys ja verrataan nykyp\u00e4iv\u00e4\u00e4n jos ei ole smaat niin k\u00e4yd\u00e4\u00e4n hakemassa sentinellt\u00e4 viimeisen dates p\u00e4iv\u00e4yksen ja t\u00e4m\u00e4n jetken v\u00e4liseslt\u00e4 ajakta dataa. testaa kaukanko kest\u00e4\u00e4 esim. muutama p\u00e4iv\u00e4 verratuna koko kasvukauteen hakea!!! ststus codes 429 ??? token 404 SECRETS in .env file in developing mode in production should put the secrets service environtment variables","title":"Routes"},{"location":"myfeelings/","text":"some issues was pretty challenges mostly because of speed, resctrictions and limitations of the resources lot of testing, kuormitus/stressi yms. especially concurrent task caused work to work overall performance was pretty good with the resources available. mutta oli monipuolinen, haastava ja siten opettavainen ty\u00f6 testing to get all works as fast as possible condsidering the restrictions and limitations of resources plans chosen/paid. for me documenting was the biggest challenge, I hope learned do just in case not afterwards Based for my previous experience of this kind of course, this deeded more time mostly beacuse of documenting, possible I went too deep","title":"Myfeelings"},{"location":"auth/authentication/","text":"Token-based authentication This Fullstack reqired authentiation registration and login and is base on token to work. token based authentication middleware checks token every route but not except root, register and login TEE mermaid!!! request.admin will be checked where admistrirator privoleges are required Register Token Authorization of Header handling token on server middleware expiration window.localStorage t\u00e4h\u00e4n token extractor admin mahdollistaa tietyt toimenpiteet admoinistratoreille admin=true ja miss\u00e4 ehtoja on k\u00e4ytetty eli mit\u00e4 toimintoja rajoutksia k\u00e4ytt\u00f6liittym\u00e4\u00e4n frontendin puolella sek\u00e4 b\u00e4ckendiss\u00e4 middleearen asettamien request.token request.admin token sis\u00e4lt\u00e4\u00e4 admin jos true niin on oikeus tehd\u00e4 joitain toimintoja tsekataan ceckAuthToken metodissa Jos ei ole kirjauduttu tai jos on mutta ei ole adminin oikeuksia const value = checkToken.checkToken(request); if (!value.status || !value.admin) { return value.data; } --> checktoken is handled by middleware which sets request.token to token value or null if not tolen or it is expired or not valid const getTokenFrom = (request) => { const authorization = request.get(\"authorization\"); if (authorization && authorization.startsWith(\"Bearer \")) { return authorization.replace(\"Bearer \", \"\"); } return null; }; const tokenExtractor = (request, response, next) => { request.token = getTokenFrom(request); next(); };","title":"Authentication"},{"location":"auth/authentication/#token-based-authentication","text":"This Fullstack reqired authentiation registration and login and is base on token to work. token based authentication middleware checks token every route but not except root, register and login TEE mermaid!!! request.admin will be checked where admistrirator privoleges are required","title":"Token-based authentication"},{"location":"auth/authentication/#register","text":"","title":"Register"},{"location":"auth/authentication/#token","text":"","title":"Token"},{"location":"auth/authentication/#authorization-of-header","text":"","title":"Authorization of Header"},{"location":"auth/authentication/#handling-token-on-server-middleware","text":"","title":"handling token on server middleware"},{"location":"auth/authentication/#expiration","text":"","title":"expiration"},{"location":"auth/authentication/#windowlocalstorage","text":"t\u00e4h\u00e4n token extractor admin mahdollistaa tietyt toimenpiteet admoinistratoreille admin=true ja miss\u00e4 ehtoja on k\u00e4ytetty eli mit\u00e4 toimintoja rajoutksia k\u00e4ytt\u00f6liittym\u00e4\u00e4n frontendin puolella sek\u00e4 b\u00e4ckendiss\u00e4 middleearen asettamien request.token request.admin token sis\u00e4lt\u00e4\u00e4 admin jos true niin on oikeus tehd\u00e4 joitain toimintoja tsekataan ceckAuthToken metodissa Jos ei ole kirjauduttu tai jos on mutta ei ole adminin oikeuksia const value = checkToken.checkToken(request); if (!value.status || !value.admin) { return value.data; } --> checktoken is handled by middleware which sets request.token to token value or null if not tolen or it is expired or not valid const getTokenFrom = (request) => { const authorization = request.get(\"authorization\"); if (authorization && authorization.startsWith(\"Bearer \")) { return authorization.replace(\"Bearer \", \"\"); } return null; }; const tokenExtractor = (request, response, next) => { request.token = getTokenFrom(request); next(); };","title":"window.localStorage"},{"location":"auth/login/","text":"Login Returns the token with user data if authentication succesful. jsonwebtoken : Used for creating JWT tokens. controllers/ \u2502 \u2514\u2500\u2500 user-controllers.js \u2502 \u2514\u2500\u2500 login \u2514\u2500\u2500 routes/ \u2514\u2500\u2500 user-routes.js const userControllers = require('../controllers/user-controllers'); router.post('/login', userControllers.login); Endpoint Url HTTP Method /ndvi/api/v1/login POST Request Name Type Description username string email password string password given when registered Response Name Type Description token jsonwebtoken is needed for requests to server email string email of user firstname string firstname of user lastname string lastname of user admin boolean if true all the features are available (tools, tests), otherwise regular user return response.status(401).json({ error: \"Invalid username or password\", }); Sequence diagram sequenceDiagram autonumber participant Client participant Server as Server: login participant MongoDb activate Server Note left of Server: /ndvi/api/v1/login Client->>Server: request (username, password) alt Authentication Successful Server->>MongoDb: Validate user credentials MongoDb-->>Server: Acknowledge validation Server-->>Client: Status 200 (Login successful, TOKEN with user data returned) else Authentication Failed Server-->>Client: Status 401 (Login failed, invalid credentials) end deactivate Server","title":"login"},{"location":"auth/login/#login","text":"Returns the token with user data if authentication succesful. jsonwebtoken : Used for creating JWT tokens. controllers/ \u2502 \u2514\u2500\u2500 user-controllers.js \u2502 \u2514\u2500\u2500 login \u2514\u2500\u2500 routes/ \u2514\u2500\u2500 user-routes.js const userControllers = require('../controllers/user-controllers'); router.post('/login', userControllers.login); Endpoint Url HTTP Method /ndvi/api/v1/login POST Request Name Type Description username string email password string password given when registered Response Name Type Description token jsonwebtoken is needed for requests to server email string email of user firstname string firstname of user lastname string lastname of user admin boolean if true all the features are available (tools, tests), otherwise regular user return response.status(401).json({ error: \"Invalid username or password\", }); Sequence diagram sequenceDiagram autonumber participant Client participant Server as Server: login participant MongoDb activate Server Note left of Server: /ndvi/api/v1/login Client->>Server: request (username, password) alt Authentication Successful Server->>MongoDb: Validate user credentials MongoDb-->>Server: Acknowledge validation Server-->>Client: Status 200 (Login successful, TOKEN with user data returned) else Authentication Failed Server-->>Client: Status 401 (Login failed, invalid credentials) end deactivate Server","title":"Login"},{"location":"auth/registration/","text":"Registration In this demo case there is not other requirements for the user data than the email should be unique Some requirements for email formation is checked on UI of the frontend. Cnditions and restrictions for the data should be defined in frontend and get used before to send data to server. bcrypt Used for hashing passwords. controllers/ \u2502 \u2514\u2500\u2500 user-controllers.js \u2502 \u2514\u2500\u2500 register \u2514\u2500\u2500 routes/ \u2514\u2500\u2500 user-routes.js const userControllers = require('../controllers/user-controllers'); router.post('/register', userControllers.register); Endpoint Url HTTP Method /ndvi/api/v1/register POST Request Name Type Description email string email of user firstname string firstname of user lastname string lastname of user admin boolean false by default, true value is set in other way Response Name Type Description statuscode number 200 on success, 401 when failed return response.status(401).json({ error: \"That email address is already in use\", }); return response.status(200).json({ message: \"Registered successfully, please login.\", }); Sequence diagram sequenceDiagram autonumber participant Client participant Server participant MongoDb activate Server Note left of Server: /ndvi/api/v1/register Client->>Server: request (user data) alt Insertion Successful Server->>MongoDb: Insert user data MongoDb-->>Server: Acknowledge insertion Server-->>Client: status 200 (Registration successful) else Insertion Failed Server-->>Client: status 401 (Registration failed, user exists) end deactivate Server client requests for registration user data (email and hash of the password that is generated with the bcrypt.hash function) is inserted into MongoDb-database if email not already exists information of the successful is returned if insertion is successful status code 200 is returned to the client if insertion fails status code 401 is returned to the client","title":"register"},{"location":"auth/registration/#registration","text":"In this demo case there is not other requirements for the user data than the email should be unique Some requirements for email formation is checked on UI of the frontend. Cnditions and restrictions for the data should be defined in frontend and get used before to send data to server.","title":"Registration"},{"location":"auth/user-controller/","text":"To create a hierarchy or structure from the given code, we can break down the file into its components and their relationships. Here is a structured view of the provided code: Hierarchy and Structure 1. Imports and Dependencies External Modules bcrypt : Used for hashing passwords. jsonwebtoken : Used for creating JWT tokens. Internal Modules mongodb : Custom module for interacting with the MongoDB database. ../mongo/mongodb : Path to the custom mongodb module. 2. Functions Asynchronous Functions login : Handles user login. register : Handles user registration. 3. Function Details login Function Parameters : request , response , next Process : Extract body from the request. Fetch user by email using mongodb.login(body.email) . Compare provided password with the stored password hash using bcrypt.compare . If the user is found and the password matches: Create a JWT token. Send a successful response with the token and user details. If authentication fails: Send a 401 error response. Error Handling : Catches and logs errors, but doesn't send a specific error response within the try-catch block. register Function Parameters : request , response , next Process : Extract user details from the request body. Hash the provided password using bcrypt.hash . Register the user in the database using mongodb.register . Send a successful registration response. Error Handling : Catches and logs exceptions, sending a 401 error response if the email is already in use. Nested try-catch to handle and log additional errors during response sending. 4. Exports The login and register functions are exported as part of an object using module.exports . Diagram Here's a visual representation of the structure: Project \u2502 \u251c\u2500\u2500 Dependencies \u2502 \u251c\u2500\u2500 bcrypt \u2502 \u251c\u2500\u2500 jsonwebtoken \u2502 \u2514\u2500\u2500 ../mongo/mongodb \u2502 \u251c\u2500\u2500 Functions \u2502 \u251c\u2500\u2500 login(request, response, next) \u2502 \u2502 \u251c\u2500\u2500 Extracts body from request \u2502 \u2502 \u251c\u2500\u2500 Fetch user from DB using email \u2502 \u2502 \u251c\u2500\u2500 Compare password with bcrypt \u2502 \u2502 \u251c\u2500\u2500 If valid: \u2502 \u2502 \u2502 \u251c\u2500\u2500 Create JWT token \u2502 \u2502 \u2502 \u2514\u2500\u2500 Send response with token and user details \u2502 \u2502 \u2514\u2500\u2500 If invalid: \u2502 \u2502 \u2514\u2500\u2500 Send 401 error response \u2502 \u2502 \u2502 \u2514\u2500\u2500 register(request, response, next) \u2502 \u251c\u2500\u2500 Extract user details from request \u2502 \u251c\u2500\u2500 Hash password with bcrypt \u2502 \u251c\u2500\u2500 Register user in DB \u2502 \u251c\u2500\u2500 Send successful registration response \u2502 \u2514\u2500\u2500 Handle errors: \u2502 \u2514\u2500\u2500 Send 401 error if email in use \u2502 \u2514\u2500\u2500 Exports \u2514\u2500\u2500 module.exports \u251c\u2500\u2500 login \u2514\u2500\u2500 register Summary This hierarchy breaks down the provided code into clear sections: dependencies, functions (with detailed steps), and exports. This structure helps in understanding the flow and functionality of the code, making it easier to maintain and extend. To create a hierarchy or structure from the given code, we can break down the file into its components and their relationships. Here is a structured view of the provided code: Hierarchy and Structure 1. Imports and Dependencies External Modules bcrypt : Used for hashing passwords. jsonwebtoken : Used for creating JWT tokens. Internal Modules mongodb : Custom module for interacting with the MongoDB database. ../mongo/mongodb : Path to the custom mongodb module. 2. Functions Asynchronous Functions login : Handles user login. register : Handles user registration. 3. Function Details login Function Parameters : request , response , next Process : Extract body from the request. Fetch user by email using mongodb.login(body.email) . Compare provided password with the stored password hash using bcrypt.compare . If the user is found and the password matches: Create a JWT token. Send a successful response with the token and user details. If authentication fails: Send a 401 error response. Error Handling : Catches and logs errors, but doesn't send a specific error response within the try-catch block. register Function Parameters : request , response , next Process : Extract user details from the request body. Hash the provided password using bcrypt.hash . Register the user in the database using mongodb.register . Send a successful registration response. Error Handling : Catches and logs exceptions, sending a 401 error response if the email is already in use. Nested try-catch to handle and log additional errors during response sending. 4. Exports The login and register functions are exported as part of an object using module.exports . Diagram Here's a visual representation of the structure: Project \u2502 \u251c\u2500\u2500 Dependencies \u2502 \u251c\u2500\u2500 bcrypt \u2502 \u251c\u2500\u2500 jsonwebtoken \u2502 \u2514\u2500\u2500 ../mongo/mongodb \u2502 \u251c\u2500\u2500 Functions \u2502 \u251c\u2500\u2500 login(request, response, next) \u2502 \u2502 \u251c\u2500\u2500 Extracts body from request \u2502 \u2502 \u251c\u2500\u2500 Fetch user from DB using email \u2502 \u2502 \u251c\u2500\u2500 Compare password with bcrypt \u2502 \u2502 \u251c\u2500\u2500 If valid: \u2502 \u2502 \u2502 \u251c\u2500\u2500 Create JWT token \u2502 \u2502 \u2502 \u2514\u2500\u2500 Send response with token and user details \u2502 \u2502 \u2514\u2500\u2500 If invalid: \u2502 \u2502 \u2514\u2500\u2500 Send 401 error response \u2502 \u2502 \u2502 \u2514\u2500\u2500 register(request, response, next) \u2502 \u251c\u2500\u2500 Extract user details from request \u2502 \u251c\u2500\u2500 Hash password with bcrypt \u2502 \u251c\u2500\u2500 Register user in DB \u2502 \u251c\u2500\u2500 Send successful registration response \u2502 \u2514\u2500\u2500 Handle errors: \u2502 \u2514\u2500\u2500 Send 401 error if email in use \u2502 \u2514\u2500\u2500 Exports \u2514\u2500\u2500 module.exports \u251c\u2500\u2500 login \u2514\u2500\u2500 register Summary This hierarchy breaks down the provided code into clear sections: dependencies, functions (with detailed steps), and exports. This structure helps in understanding the flow and functionality of the code, making it easier to maintain and extend. To create a hierarchy or structure from the given code, we can break down the file into its components and their relationships. Here is a structured view of the provided code: Hierarchy and Structure 1. Imports and Dependencies External Modules bcrypt: Used for hashing passwords. jsonwebtoken: Used for creating JWT tokens. Internal Modules mongodb: Custom module for interacting with the MongoDB database. ../mongo/mongodb: Path to the custom mongodb module. 2. Functions Asynchronous Functions login: Handles user login. register: Handles user registration. 3. Function Details login Function Parameters: request, response, next Process: Extract body from the request. Fetch user by email using mongodb.login(body.email). Compare provided password with the stored password hash using bcrypt.compare. If the user is found and the password matches: Create a JWT token. Send a successful response with the token and user details. If authentication fails: Send a 401 error response. Error Handling: Catches and logs errors, but doesn't send a specific error response within the try-catch block. register Function Parameters: request, response, next Process: Extract user details from the request body. Hash the provided password using bcrypt.hash. Register the user in the database using mongodb.register. Send a successful registration response. Error Handling: Catches and logs exceptions, sending a 401 error response if the email is already in use. Nested try-catch to handle and log additional errors during response sending. 4. Exports The login and register functions are exported as part of an object using module.exports. Diagram Here's a visual representation of the structure: sql Copy code Project \u2502 \u251c\u2500\u2500 Dependencies \u2502 \u251c\u2500\u2500 bcrypt \u2502 \u251c\u2500\u2500 jsonwebtoken \u2502 \u2514\u2500\u2500 ../mongo/mongodb \u2502 \u251c\u2500\u2500 Functions \u2502 \u251c\u2500\u2500 login(request, response, next) \u2502 \u2502 \u251c\u2500\u2500 Extracts body from request \u2502 \u2502 \u251c\u2500\u2500 Fetch user from DB using email \u2502 \u2502 \u251c\u2500\u2500 Compare password with bcrypt \u2502 \u2502 \u251c\u2500\u2500 If valid: \u2502 \u2502 \u2502 \u251c\u2500\u2500 Create JWT token \u2502 \u2502 \u2502 \u2514\u2500\u2500 Send response with token and user details \u2502 \u2502 \u2514\u2500\u2500 If invalid: \u2502 \u2502 \u2514\u2500\u2500 Send 401 error response \u2502 \u2502 \u2502 \u2514\u2500\u2500 register(request, response, next) \u2502 \u251c\u2500\u2500 Extract user details from request \u2502 \u251c\u2500\u2500 Hash password with bcrypt \u2502 \u251c\u2500\u2500 Register user in DB \u2502 \u251c\u2500\u2500 Send successful registration response \u2502 \u2514\u2500\u2500 Handle errors: \u2502 \u2514\u2500\u2500 Send 401 error if email in use \u2502 \u2514\u2500\u2500 Exports \u2514\u2500\u2500 module.exports \u251c\u2500\u2500 login \u2514\u2500\u2500 register Summary This hierarchy breaks down the provided code into clear sections: dependencies, functions (with detailed steps), and exports. This structure helps in understanding the flow and functionality of the code, making it easier to maintain and extend.","title":"User controller"},{"location":"auth/user-controller/#hierarchy-and-structure","text":"","title":"Hierarchy and Structure"},{"location":"auth/user-controller/#diagram","text":"Here's a visual representation of the structure: Project \u2502 \u251c\u2500\u2500 Dependencies \u2502 \u251c\u2500\u2500 bcrypt \u2502 \u251c\u2500\u2500 jsonwebtoken \u2502 \u2514\u2500\u2500 ../mongo/mongodb \u2502 \u251c\u2500\u2500 Functions \u2502 \u251c\u2500\u2500 login(request, response, next) \u2502 \u2502 \u251c\u2500\u2500 Extracts body from request \u2502 \u2502 \u251c\u2500\u2500 Fetch user from DB using email \u2502 \u2502 \u251c\u2500\u2500 Compare password with bcrypt \u2502 \u2502 \u251c\u2500\u2500 If valid: \u2502 \u2502 \u2502 \u251c\u2500\u2500 Create JWT token \u2502 \u2502 \u2502 \u2514\u2500\u2500 Send response with token and user details \u2502 \u2502 \u2514\u2500\u2500 If invalid: \u2502 \u2502 \u2514\u2500\u2500 Send 401 error response \u2502 \u2502 \u2502 \u2514\u2500\u2500 register(request, response, next) \u2502 \u251c\u2500\u2500 Extract user details from request \u2502 \u251c\u2500\u2500 Hash password with bcrypt \u2502 \u251c\u2500\u2500 Register user in DB \u2502 \u251c\u2500\u2500 Send successful registration response \u2502 \u2514\u2500\u2500 Handle errors: \u2502 \u2514\u2500\u2500 Send 401 error if email in use \u2502 \u2514\u2500\u2500 Exports \u2514\u2500\u2500 module.exports \u251c\u2500\u2500 login \u2514\u2500\u2500 register","title":"Diagram"},{"location":"auth/user-controller/#summary","text":"This hierarchy breaks down the provided code into clear sections: dependencies, functions (with detailed steps), and exports. This structure helps in understanding the flow and functionality of the code, making it easier to maintain and extend. To create a hierarchy or structure from the given code, we can break down the file into its components and their relationships. Here is a structured view of the provided code:","title":"Summary"},{"location":"auth/user-controller/#hierarchy-and-structure_1","text":"","title":"Hierarchy and Structure"},{"location":"auth/user-controller/#diagram_1","text":"Here's a visual representation of the structure: Project \u2502 \u251c\u2500\u2500 Dependencies \u2502 \u251c\u2500\u2500 bcrypt \u2502 \u251c\u2500\u2500 jsonwebtoken \u2502 \u2514\u2500\u2500 ../mongo/mongodb \u2502 \u251c\u2500\u2500 Functions \u2502 \u251c\u2500\u2500 login(request, response, next) \u2502 \u2502 \u251c\u2500\u2500 Extracts body from request \u2502 \u2502 \u251c\u2500\u2500 Fetch user from DB using email \u2502 \u2502 \u251c\u2500\u2500 Compare password with bcrypt \u2502 \u2502 \u251c\u2500\u2500 If valid: \u2502 \u2502 \u2502 \u251c\u2500\u2500 Create JWT token \u2502 \u2502 \u2502 \u2514\u2500\u2500 Send response with token and user details \u2502 \u2502 \u2514\u2500\u2500 If invalid: \u2502 \u2502 \u2514\u2500\u2500 Send 401 error response \u2502 \u2502 \u2502 \u2514\u2500\u2500 register(request, response, next) \u2502 \u251c\u2500\u2500 Extract user details from request \u2502 \u251c\u2500\u2500 Hash password with bcrypt \u2502 \u251c\u2500\u2500 Register user in DB \u2502 \u251c\u2500\u2500 Send successful registration response \u2502 \u2514\u2500\u2500 Handle errors: \u2502 \u2514\u2500\u2500 Send 401 error if email in use \u2502 \u2514\u2500\u2500 Exports \u2514\u2500\u2500 module.exports \u251c\u2500\u2500 login \u2514\u2500\u2500 register","title":"Diagram"},{"location":"auth/user-controller/#summary_1","text":"This hierarchy breaks down the provided code into clear sections: dependencies, functions (with detailed steps), and exports. This structure helps in understanding the flow and functionality of the code, making it easier to maintain and extend. To create a hierarchy or structure from the given code, we can break down the file into its components and their relationships. Here is a structured view of the provided code: Hierarchy and Structure 1. Imports and Dependencies External Modules bcrypt: Used for hashing passwords. jsonwebtoken: Used for creating JWT tokens. Internal Modules mongodb: Custom module for interacting with the MongoDB database. ../mongo/mongodb: Path to the custom mongodb module. 2. Functions Asynchronous Functions login: Handles user login. register: Handles user registration. 3. Function Details login Function Parameters: request, response, next Process: Extract body from the request. Fetch user by email using mongodb.login(body.email). Compare provided password with the stored password hash using bcrypt.compare. If the user is found and the password matches: Create a JWT token. Send a successful response with the token and user details. If authentication fails: Send a 401 error response. Error Handling: Catches and logs errors, but doesn't send a specific error response within the try-catch block. register Function Parameters: request, response, next Process: Extract user details from the request body. Hash the provided password using bcrypt.hash. Register the user in the database using mongodb.register. Send a successful registration response. Error Handling: Catches and logs exceptions, sending a 401 error response if the email is already in use. Nested try-catch to handle and log additional errors during response sending. 4. Exports The login and register functions are exported as part of an object using module.exports. Diagram Here's a visual representation of the structure: sql Copy code Project \u2502 \u251c\u2500\u2500 Dependencies \u2502 \u251c\u2500\u2500 bcrypt \u2502 \u251c\u2500\u2500 jsonwebtoken \u2502 \u2514\u2500\u2500 ../mongo/mongodb \u2502 \u251c\u2500\u2500 Functions \u2502 \u251c\u2500\u2500 login(request, response, next) \u2502 \u2502 \u251c\u2500\u2500 Extracts body from request \u2502 \u2502 \u251c\u2500\u2500 Fetch user from DB using email \u2502 \u2502 \u251c\u2500\u2500 Compare password with bcrypt \u2502 \u2502 \u251c\u2500\u2500 If valid: \u2502 \u2502 \u2502 \u251c\u2500\u2500 Create JWT token \u2502 \u2502 \u2502 \u2514\u2500\u2500 Send response with token and user details \u2502 \u2502 \u2514\u2500\u2500 If invalid: \u2502 \u2502 \u2514\u2500\u2500 Send 401 error response \u2502 \u2502 \u2502 \u2514\u2500\u2500 register(request, response, next) \u2502 \u251c\u2500\u2500 Extract user details from request \u2502 \u251c\u2500\u2500 Hash password with bcrypt \u2502 \u251c\u2500\u2500 Register user in DB \u2502 \u251c\u2500\u2500 Send successful registration response \u2502 \u2514\u2500\u2500 Handle errors: \u2502 \u2514\u2500\u2500 Send 401 error if email in use \u2502 \u2514\u2500\u2500 Exports \u2514\u2500\u2500 module.exports \u251c\u2500\u2500 login \u2514\u2500\u2500 register Summary This hierarchy breaks down the provided code into clear sections: dependencies, functions (with detailed steps), and exports. This structure helps in understanding the flow and functionality of the code, making it easier to maintain and extend.","title":"Summary"},{"location":"database/mongodb/","text":"sek\u00e4 dates ett\u00e4 images mongoURI=\"mongodb+srv://laakktidev:AA4598@develop.pgqgteo.mongodb.net/ndvidb?retryWrites=true&w=majority\" Folder Structure - mongo - models - dates.js - images.js - users.js - workarea.js - mongodb.js miksi var -> const!!! var mongoose = require(\"mongoose\"); var workareaSchema = new mongoose.Schema({ id: { type: String, required: true, unique: true, }, workareaid: { type: String, required: true, unique: true, }, name: { type: String, required: true, unique: false, }, backofficeid: { type: String, required: true, unique: false, }, geometry: { type: String, required: true, unique: true, }, ndvi: { type: Boolean, default: false, } }); module.exports = new mongoose.model(\"Workarea\", workareaSchema); classDiagram class workareaSchema { - id: String - workareaid: String - name: String - backofficeid: String - geometry: String - ndvi: Boolean + required: true + unique: true + default: false } Item 1 content goes here. Item 2 content goes here. noSQL This adds neItem (array) to the beginning of the array of dates in document markable is $position: 0 to the beginnign of the array const ret = await datesModel.findOneAndUpdate( { id: id }, { $push: { dates: { $each: newItem, $position: 0 } } }, { new: true } ); MongoDB Atlas \"cloud service\" t\u00e4h\u00e4n oleelliset asiat mm. kuva rinnakkain voiko kuvan klikata suurempana auki??? jos niin miten Tietoturva!!! ip access: huomioi lokaali docker ja azure Data handling in Azure Data Studio integrated https://docs.mongodb.com/mongodb-shell/ data in collection db.dates.find() db.dates.find({},{_id:0,id:0,area:0,__v:0}) count/size of dates array db.dates.aggregate([ { $project: { _id: 0, datesCount: { $size: '$dates' } } }]) db.images.countDocuments() poista collection: db.dates.drop() Data-studio kuvia my\u00f6s /* * Registers a new user. * @param {string} firstname - The user's first name. * @param {string} lastname - The user's last name. * @param {string} email - The user's email. * @param {string} passwordHash - The hashed password. * @param {boolean} admin - Whether the user is an admin. / register, /* * Logs in a user. * @param {string} email - The user's email. * @returns {Object|null} - The user object if found, otherwise null. / login, /* * Saves user data. * @param {string} data - The user data. * @returns {boolean} - Whether the operation was successful. / saveUser, /* * Retrieves user status. * @param {string} companyId - The company ID. * @returns {Object|boolean} - The user object if found, otherwise false. / userStatus, /* * Updates user data. * @param {string} companyId - The company ID. * @param {Array} data - The new data. * @returns {boolean} - Whether the operation was successful. / updateUser, /* * Saves image data. * @param {Object} data - The image data. * @returns {boolean} - Whether the operation was successful. / saveImage, /* * Retrieves image data by ID. * @param {string} id - The ID. * @returns {Object|null} - The image data object if found, otherwise null. / getImage, /* * Retrieves all images that match the search string. * @param {string} search - The search string. * @returns {Array} - The array of matching image data objects. / getAllImages, /* * Deletes an image by ID. * @param {string} id - The ID. * @returns {boolean} - Whether the operation was successful. / deleteImage, /* * Saves dates data. * @param {string} id - The ID. * @param {Array} data - The dates data. * @param {Object} geometry - The geometry. * @param {number} area - The area. * @returns {boolean} - Whether the operation was successful. / saveDates, /* * Inserts multiple dates into the database. * @param {Array} dataArray - The array of data objects. * @returns {boolean} - Whether the operation was successful. / insertManyDates, /* * Updates dates data. * @param {string} id - The ID. * @param {Array} newItem - The new item to add. * @returns {boolean} - Whether the operation was successful. / updateDates, /* * Deletes dates data. * @param {string} id - The ID. * @returns {boolean} - Whether the operation was successful. / deleteDates, /* * Retrieves dates data by ID. * @param {string} id - The ID. * @returns {Object|null} - The dates data object if found, otherwise null. / getDates, /* * Retrieves all date sets. * @returns {Array} - The array of date sets. / getAllDateSets, /* * Clears all collections in the database. / doEmptyDb, /* * Retrieves all data for a specific user. * @param {string} user - The user name. * @returns {Array} - The array of data objects. / getAllData, /* * Checks if data exists for a specific user and date. * @param {string} user - The user name. * @param {string} date - The date. * @returns {Object|null} - The data object if found, otherwise null. / ifExists, /* * Saves block data. * @param {Object} data - The block data. * @returns {boolean} - Whether the operation was successful. / saveBlock, /* * Retrieves all block data. * @returns {Array} - The array of block data objects. / getBlocks, /* * Retrieves all block data that are not marked as NDVI. * @returns {Array} - The array of block data objects. / getBlocksNotNDVI, /* * Sets the NDVI status of a block by ID. * @param {string} id - The block ID. * @param {boolean} status - The NDVI status to set. * @returns {boolean} - Whether the operation was successful. / setBlockNDVIStatus, /* * Sets the NDVI status of all block data. * @param {boolean} status - The NDVI status to set. * @returns {boolean} - Whether the operation was successful. / setAllBlockNDVIStatus, /* * Drops the dates collection. * @returns {boolean} - Whether the operation was successful. / dropDates, /* * Drops the images collection. * @returns {boolean} - Whether the operation was successful. / dropImages There is also postgreSQL approach in github source code but this doumentatioin is not handling it, mongoDb with some reason is the choosen one for the database. costs price So the whole syste is MERN stack fullstack LAITA t\u00e4m\u00e4 intoroolett\u00e4 fullstack is MERN-stack. Mern is very populr stack now a datas... MERN is considered a full-stack because it encompasses both the client-side and server-side of web development: Client-side (Front-end): React is used for building the user interface, which is the part of the app that users interact with directly. Server-side (Back-end): Node.js runs the server, Express.js handles the routing and middleware, and MongoDB is used for storing data. So, with MERN, you have all the components necessary to build and run a complete web application from start to finish, using JavaScript throughout the entire development process. This is why it\u2019s referred to as a \u201cfull-stack\u201d solution.\ud83c\udf10 Mainitse mongoose mongodb.js:ss\u00e4 https://www.npmjs.com/package/mongoose npm i mongoose HUOM: insertMany eli array annetaan parametriksi sek\u00e4 dates ett\u00e4 images mongoURI=\"mongodb+srv://laakktidev:AA4598@develop.pgqgteo.mongodb.net/ndvidb?retryWrites=true&w=majority\" Folder Structure - mongo - models - dates.js - images.js - users.js - mongodb.js miksi var -> const!!! var mongoose = require(\"mongoose\"); var workareaSchema = new mongoose.Schema({ id: { type: String, required: true, unique: true, }, workareaid: { type: String, required: true, unique: true, }, name: { type: String, required: true, unique: false, }, backofficeid: { type: String, required: true, unique: false, }, geometry: { type: String, required: true, unique: true, }, ndvi: { type: Boolean, default: false, } }); module.exports = new mongoose.model(\"Workarea\", workareaSchema); classDiagram class workareaSchema { - id: String - workareaid: String - name: String - backofficeid: String - geometry: String - ndvi: Boolean + required: true + unique: true + default: false } Item 1 content goes here. Item 2 content goes here. noSQL This adds neItem (array) to the beginning of the array of dates in document markable is $position: 0 to the beginnign of the array const ret = await datesModel.findOneAndUpdate( { id: id }, { $push: { dates: { $each: newItem, $position: 0 } } }, { new: true } ); MongoDB Atlas \"cloud service\" t\u00e4h\u00e4n oleelliset asiat mm. kuva rinnakkain voiko kuvan klikata suurempana auki??? jos niin miten Tietoturva!!! ip access: huomioi lokaali docker ja azure Data handling in Azure Data Studio integrated https://docs.mongodb.com/mongodb-shell/ data in collection db.dates.find() db.dates.find({},{_id:0,id:0,area:0,__v:0}) count/size of dates array db.dates.aggregate([ { $project: { _id: 0, datesCount: { $size: '$dates' } } }]) db.images.countDocuments() poista collection: db.dates.drop()","title":"Mongodb"},{"location":"database/mongodb/#folder-structure","text":"- mongo - models - dates.js - images.js - users.js - workarea.js - mongodb.js miksi var -> const!!! var mongoose = require(\"mongoose\"); var workareaSchema = new mongoose.Schema({ id: { type: String, required: true, unique: true, }, workareaid: { type: String, required: true, unique: true, }, name: { type: String, required: true, unique: false, }, backofficeid: { type: String, required: true, unique: false, }, geometry: { type: String, required: true, unique: true, }, ndvi: { type: Boolean, default: false, } }); module.exports = new mongoose.model(\"Workarea\", workareaSchema); classDiagram class workareaSchema { - id: String - workareaid: String - name: String - backofficeid: String - geometry: String - ndvi: Boolean + required: true + unique: true + default: false } Item 1 content goes here. Item 2 content goes here. noSQL This adds neItem (array) to the beginning of the array of dates in document markable is $position: 0 to the beginnign of the array const ret = await datesModel.findOneAndUpdate( { id: id }, { $push: { dates: { $each: newItem, $position: 0 } } }, { new: true } ); MongoDB Atlas \"cloud service\" t\u00e4h\u00e4n oleelliset asiat mm. kuva rinnakkain voiko kuvan klikata suurempana auki??? jos niin miten Tietoturva!!! ip access: huomioi lokaali docker ja azure Data handling in Azure Data Studio integrated https://docs.mongodb.com/mongodb-shell/ data in collection db.dates.find() db.dates.find({},{_id:0,id:0,area:0,__v:0}) count/size of dates array db.dates.aggregate([ { $project: { _id: 0, datesCount: { $size: '$dates' } } }]) db.images.countDocuments() poista collection: db.dates.drop() Data-studio kuvia my\u00f6s /* * Registers a new user. * @param {string} firstname - The user's first name. * @param {string} lastname - The user's last name. * @param {string} email - The user's email. * @param {string} passwordHash - The hashed password. * @param {boolean} admin - Whether the user is an admin. / register, /* * Logs in a user. * @param {string} email - The user's email. * @returns {Object|null} - The user object if found, otherwise null. / login, /* * Saves user data. * @param {string} data - The user data. * @returns {boolean} - Whether the operation was successful. / saveUser, /* * Retrieves user status. * @param {string} companyId - The company ID. * @returns {Object|boolean} - The user object if found, otherwise false. / userStatus, /* * Updates user data. * @param {string} companyId - The company ID. * @param {Array} data - The new data. * @returns {boolean} - Whether the operation was successful. / updateUser, /* * Saves image data. * @param {Object} data - The image data. * @returns {boolean} - Whether the operation was successful. / saveImage, /* * Retrieves image data by ID. * @param {string} id - The ID. * @returns {Object|null} - The image data object if found, otherwise null. / getImage, /* * Retrieves all images that match the search string. * @param {string} search - The search string. * @returns {Array} - The array of matching image data objects. / getAllImages, /* * Deletes an image by ID. * @param {string} id - The ID. * @returns {boolean} - Whether the operation was successful. / deleteImage, /* * Saves dates data. * @param {string} id - The ID. * @param {Array} data - The dates data. * @param {Object} geometry - The geometry. * @param {number} area - The area. * @returns {boolean} - Whether the operation was successful. / saveDates, /* * Inserts multiple dates into the database. * @param {Array} dataArray - The array of data objects. * @returns {boolean} - Whether the operation was successful. / insertManyDates, /* * Updates dates data. * @param {string} id - The ID. * @param {Array} newItem - The new item to add. * @returns {boolean} - Whether the operation was successful. / updateDates, /* * Deletes dates data. * @param {string} id - The ID. * @returns {boolean} - Whether the operation was successful. / deleteDates, /* * Retrieves dates data by ID. * @param {string} id - The ID. * @returns {Object|null} - The dates data object if found, otherwise null. / getDates, /* * Retrieves all date sets. * @returns {Array} - The array of date sets. / getAllDateSets, /* * Clears all collections in the database. / doEmptyDb, /* * Retrieves all data for a specific user. * @param {string} user - The user name. * @returns {Array} - The array of data objects. / getAllData, /* * Checks if data exists for a specific user and date. * @param {string} user - The user name. * @param {string} date - The date. * @returns {Object|null} - The data object if found, otherwise null. / ifExists, /* * Saves block data. * @param {Object} data - The block data. * @returns {boolean} - Whether the operation was successful. / saveBlock, /* * Retrieves all block data. * @returns {Array} - The array of block data objects. / getBlocks, /* * Retrieves all block data that are not marked as NDVI. * @returns {Array} - The array of block data objects. / getBlocksNotNDVI, /* * Sets the NDVI status of a block by ID. * @param {string} id - The block ID. * @param {boolean} status - The NDVI status to set. * @returns {boolean} - Whether the operation was successful. / setBlockNDVIStatus, /* * Sets the NDVI status of all block data. * @param {boolean} status - The NDVI status to set. * @returns {boolean} - Whether the operation was successful. / setAllBlockNDVIStatus, /* * Drops the dates collection. * @returns {boolean} - Whether the operation was successful. / dropDates, /* * Drops the images collection. * @returns {boolean} - Whether the operation was successful. / dropImages There is also postgreSQL approach in github source code but this doumentatioin is not handling it, mongoDb with some reason is the choosen one for the database. costs price So the whole syste is MERN stack fullstack LAITA t\u00e4m\u00e4 intoroolett\u00e4 fullstack is MERN-stack. Mern is very populr stack now a datas... MERN is considered a full-stack because it encompasses both the client-side and server-side of web development: Client-side (Front-end): React is used for building the user interface, which is the part of the app that users interact with directly. Server-side (Back-end): Node.js runs the server, Express.js handles the routing and middleware, and MongoDB is used for storing data. So, with MERN, you have all the components necessary to build and run a complete web application from start to finish, using JavaScript throughout the entire development process. This is why it\u2019s referred to as a \u201cfull-stack\u201d solution.\ud83c\udf10 Mainitse mongoose mongodb.js:ss\u00e4 https://www.npmjs.com/package/mongoose npm i mongoose HUOM: insertMany eli array annetaan parametriksi sek\u00e4 dates ett\u00e4 images mongoURI=\"mongodb+srv://laakktidev:AA4598@develop.pgqgteo.mongodb.net/ndvidb?retryWrites=true&w=majority\"","title":"Folder Structure"},{"location":"database/mongodb/#folder-structure_1","text":"- mongo - models - dates.js - images.js - users.js - mongodb.js miksi var -> const!!! var mongoose = require(\"mongoose\"); var workareaSchema = new mongoose.Schema({ id: { type: String, required: true, unique: true, }, workareaid: { type: String, required: true, unique: true, }, name: { type: String, required: true, unique: false, }, backofficeid: { type: String, required: true, unique: false, }, geometry: { type: String, required: true, unique: true, }, ndvi: { type: Boolean, default: false, } }); module.exports = new mongoose.model(\"Workarea\", workareaSchema); classDiagram class workareaSchema { - id: String - workareaid: String - name: String - backofficeid: String - geometry: String - ndvi: Boolean + required: true + unique: true + default: false } Item 1 content goes here. Item 2 content goes here. noSQL This adds neItem (array) to the beginning of the array of dates in document markable is $position: 0 to the beginnign of the array const ret = await datesModel.findOneAndUpdate( { id: id }, { $push: { dates: { $each: newItem, $position: 0 } } }, { new: true } ); MongoDB Atlas \"cloud service\" t\u00e4h\u00e4n oleelliset asiat mm. kuva rinnakkain voiko kuvan klikata suurempana auki??? jos niin miten Tietoturva!!! ip access: huomioi lokaali docker ja azure Data handling in Azure Data Studio integrated https://docs.mongodb.com/mongodb-shell/ data in collection db.dates.find() db.dates.find({},{_id:0,id:0,area:0,__v:0}) count/size of dates array db.dates.aggregate([ { $project: { _id: 0, datesCount: { $size: '$dates' } } }]) db.images.countDocuments() poista collection: db.dates.drop()","title":"Folder Structure"},{"location":"database/mongodb_js/","text":"mongodb.js component mongodb.js is like a api for the database. Which uses mogoose library for the database operations. The code is a Node.js module that interacts with a MongoDB database using Mongoose. It includes models for images, dates, and users, and establishes a connection to the database with the given URI. Functionality: Database Connection: Establishes a connection to a MongoDB database using Mongoose. User Operations: saveUser : Saves a new user if they don\u2019t already exist. updateUser : Updates user data based on the company ID. userStatus : Checks the status of a user based on the company ID. Operations for Dates: saveDates : Saves new date entries if they don\u2019t already exist. insertManyDates : Inserts multiple new date entries if they don\u2019t already exist. updateDates : Updates existing date entries with new items. deleteDates : Deletes date entries based on an ID. getDates : Retrieves date entries for a specific ID. getAllDateSets : Retrieves all date entries. Image Operations: saveImage : Attempts to save a new image entry to the database if it doesn't already exist. Returns true if successful, false otherwise. getImage : Retrieves an image entry from the database based on its ID, excluding certain fields from the result. getAllImages : Searches for all image entries that match a given search pattern, performing a case-insensitive search and excluding specific fields. deleteImage : Deletes an image entry from the database based on its ID and returns the outcome of this operation. Each function includes error handling to manage exceptions during database operations. The //#checked comment indicates that these functions have been verified.","title":"API(mongodb.js)"},{"location":"database/mongodb_js/#mongodbjs","text":"component mongodb.js is like a api for the database. Which uses mogoose library for the database operations. The code is a Node.js module that interacts with a MongoDB database using Mongoose. It includes models for images, dates, and users, and establishes a connection to the database with the given URI.","title":"mongodb.js"},{"location":"database/mongodb_js/#functionality","text":"","title":"Functionality:"},{"location":"database/mongodb_js/#database-connection","text":"Establishes a connection to a MongoDB database using Mongoose.","title":"Database Connection:"},{"location":"database/mongodb_js/#user-operations","text":"saveUser : Saves a new user if they don\u2019t already exist. updateUser : Updates user data based on the company ID. userStatus : Checks the status of a user based on the company ID.","title":"User Operations:"},{"location":"database/mongodb_js/#operations-for-dates","text":"saveDates : Saves new date entries if they don\u2019t already exist. insertManyDates : Inserts multiple new date entries if they don\u2019t already exist. updateDates : Updates existing date entries with new items. deleteDates : Deletes date entries based on an ID. getDates : Retrieves date entries for a specific ID. getAllDateSets : Retrieves all date entries.","title":"Operations for Dates:"},{"location":"database/mongodb_js/#image-operations","text":"saveImage : Attempts to save a new image entry to the database if it doesn't already exist. Returns true if successful, false otherwise. getImage : Retrieves an image entry from the database based on its ID, excluding certain fields from the result. getAllImages : Searches for all image entries that match a given search pattern, performing a case-insensitive search and excluding specific fields. deleteImage : Deletes an image entry from the database based on its ID and returns the outcome of this operation. Each function includes error handling to manage exceptions during database operations. The //#checked comment indicates that these functions have been verified.","title":"Image Operations:"},{"location":"database/overview/","text":"Database There was two potential choices for database noSQL MongoDB Atlas as a service and other SQL postgreSQL as Azure flexible service There was few reasons to select Mongodb as an database environment/platform. DBMS So mongodb is a part of MERN stack. USING mongoose to handle MongoDB MERN uses MongoDb Atlas tsekkaa my\u00f6 planning docu schema Luokka kaavioina??? PostgreSQL schema Alternatives mongodb.js there is all the methods for using an and for developing issues. Both databases choices are available and selitetty shortly but demo is using mongoDb approach which has explaine in this document. At this case because xxx is not complicated it's up to you which database to choose. Both are good, but for statistics SQL-language is probably more versatile. For statistisc python pandas like deanfo.js is good choise. Bacuse of of NDVi data, some kind of summary ans sttaistics could be obvious and can be benefit/taking advanced/utilize.","title":"Overview"},{"location":"database/overview/#database","text":"There was two potential choices for database noSQL MongoDB Atlas as a service and other SQL postgreSQL as Azure flexible service There was few reasons to select Mongodb as an database environment/platform. DBMS So mongodb is a part of MERN stack.","title":"Database"},{"location":"database/overview/#using-mongoose-to-handle","text":"","title":"USING mongoose to handle"},{"location":"database/overview/#mongodb","text":"MERN uses MongoDb Atlas tsekkaa my\u00f6 planning docu","title":"MongoDB"},{"location":"database/overview/#schema","text":"Luokka kaavioina???","title":"schema"},{"location":"database/overview/#postgresql","text":"","title":"PostgreSQL"},{"location":"database/overview/#schema_1","text":"Alternatives mongodb.js there is all the methods for using an and for developing issues. Both databases choices are available and selitetty shortly but demo is using mongoDb approach which has explaine in this document. At this case because xxx is not complicated it's up to you which database to choose. Both are good, but for statistics SQL-language is probably more versatile. For statistisc python pandas like deanfo.js is good choise. Bacuse of of NDVi data, some kind of summary ans sttaistics could be obvious and can be benefit/taking advanced/utilize.","title":"schema"},{"location":"database/models/dateschema/","text":"datesSchema classDiagram class Dates { id: String dates: Array geometry: Object area: Number } dates.js mongo/ \u2514\u2500\u2500 models/ \u2514\u2500\u2500 dates.js var mongoose = require(\"mongoose\"); const uniqueValidator = require(\"mongoose-unique-validator\"); var datesSchema = new mongoose.Schema({ id: { type:String, required: true, unique: true }, dates: Array, geometry: { type: Object, unique: true }, area: Number }); datesSchema.plugin(uniqueValidator); module.exports = new mongoose.model(\"Dates\", datesSchema);","title":"datesSchema"},{"location":"database/models/imageschema/","text":"imageSchema classDiagram class Image { id: String average: Number max: Number min: Number std: Number image: ImageData scale: Array } class ImageData { minX: Number minY: Number maxX: Number maxY: Number dataUrl: Buffer } Image --> ImageData image.js mongo/ \u2514\u2500\u2500 models/ \u2514\u2500\u2500 image.js var mongoose = require(\"mongoose\"); const uniqueValidator = require(\"mongoose-unique-validator\"); var imageSchema = new mongoose.Schema({ id: { type:String, required: true, unique: true }, average: Number, max: Number, min: Number, std: Number, image: { minX: Number, minY: Number, maxX: Number, maxY: Number, dataUrl: Buffer }, scale: Array }); imageSchema.plugin(uniqueValidator); module.exports = new mongoose.model(\"Image\", imageSchema);","title":"imageSchema"},{"location":"database/models/userschema/","text":"userSchema classDiagram class User { firstname: String lastname: String email: String passwordHash: String admin: Boolean } user.js mongo/ \u2514\u2500\u2500 models/ \u2514\u2500\u2500 user.js const mongoose = require('mongoose') const uniqueValidator = require('mongoose-unique-validator') const userSchema = mongoose.Schema({ firstname: String, lastname: String, email: { type: String, unique: true }, passwordHash: String, admin: Boolean }) userSchema.plugin(uniqueValidator) module.exports = mongoose.model('User', userSchema)","title":"userSchema"},{"location":"database/models/workareaschema/","text":"workareaSchema classDiagram class Workarea { id: String workareaid: String name: String backofficeid: String geometry: Object ndvi: Boolean } workarea.js mongo/ \u2514\u2500\u2500 models/ \u2514\u2500\u2500 workarea.js var mongoose = require(\"mongoose\"); var workareaSchema = new mongoose.Schema({ id: { type: String, required: true, unique: true, }, workareaid: { type: String, required: true, unique: true, }, name: { type: String, required: true, unique: false, }, backofficeid: { type: String, required: true, unique: false, }, geometry: { type: Object, required: true, unique: true, }, ndvi: { type: Boolean, default: false, } }); module.exports = new mongoose.model(\"Workarea\", workareaSchema);","title":"workareaSchema"},{"location":"deployment/azure/","text":"postgerSQL flexible server container registry azure web/app service https://portal.azure.com/","title":"Azure"},{"location":"deployment/deployment/","text":"Deployment In this case the app is deployed to Azure webservice as an container. now the MERN Stack runs on container in Azure web service... !!!! frontend lis\u00e4t\u00e4\u00e4n build ja serverille static asetus HUOM selaimessa PWA asennus LIS\u00c4\u00c4\u00c4 frontend build folder to the root of the server code app.js app.use(express.static(\"build\")); // If the URL contains 'login' or 'register', pass without token validation if (url === '/' || url.includes('login') || url.includes('register')) { return next(); } The idea The idea is containerize an application (Azure web app container /-register) https://portal.azure.com/ laakkti@outlook.com https://portal.azure.com/#@laakktioutlook.onmicrosoft.com/resource/subscriptions/08680159-3a33-4f02-a0f1-1b648e13f8a5/resources t\u00e4h\u00e4n vois tulla anmation gif koko jutusta Dockerfile FROM node:18 COPY . . RUN npm install CMD [\"npm\", \"start\"] .dockerignore .node_modules Container Registry Registry name (Username): ndvireg Login server: ndvireg.azurecr.io password: Tm9qFwxVD4/DSPi3LmEomsuvW9NDOUlb8f1/Rtp7t3+ACRApVSqe password2: 7+aJFEG6LSKQYgic1rueERF7FKEtCHsfgHUy1FqfUM+ACRCBU4qY docker login ndvireg.azurecr.io Username: ndvireg Password: Tm9qFwxVD4/DSPi3LmEomsuvW9NDOUlb8f1/Rtp7t3+ACRApVSqe Building the Docker Image docker build -t ndvireg.azurecr.io/ndvidemo:latest . with command docker images can be seen that image is really created Deploying to Azure To push the image from your local to the Azure Container Registry docker push ndvireg.azurecr.io/ndvidemo:latest Azure Web App Hosting the container from register Continuous Deployment Url for the server https://ndvidemo.azurewebsites.net Updating changes docker build -t ndvireg.azurecr.io/ndvidemo:latest . docker push ndvireg.azurecr.io/ndvidemo:latest REMARKS (tee tyyli punaisella!!!) !!!!!!!!! ei aina p\u00e4ivity!!!! joten container registryn repository deletetoitava sek\u00e4 jos kus serveri p\u00e4ivityksen j\u00e4lkeen k\u00e4ynnistett\u00e4v\u00e4!!! Container registry ndvireg | Repositories DELETE Testing Docker image in local on Docker Desktop tai sitten vaan komento rivilt\u00e4 run ... E:\\YAMK\\ytsp0200-3004\\backend_doc\\docs\\img Pipeline Azure pipeline on Azure DevOps. Pipeline is more advanced for deployment pipeline is triggered by git push Creating a pipeline First the repository for Azure DevOps https://dev.azure.com/ project have to be created the source files should be pushed to the repository of Azure DevOps. Step by step azure-pipelines.yml Azure Devops generated YAML file defining pipelines for CI/CD (Continuous Integration/Continuous Deployment). # Docker # Build and push an image to Azure Container Registry # https://docs.microsoft.com/azure/devops/pipelines/languages/docker trigger: - master resources: - repo: self variables: # Container registry service connection established during pipeline creation dockerRegistryServiceConnection: '2b2e35d0-3140-4c01-8409-9e453d42fa6f' imageRepository: 'ndvi' containerRegistry: 'ndvireg.azurecr.io' dockerfilePath: '$(Build.SourcesDirectory)/Dockerfile' tag: '$(Build.BuildId)' # Agent VM image name vmImageName: 'ubuntu-latest' stages: - stage: Build displayName: Build and push stage jobs: - job: Build displayName: Build pool: vmImage: $(vmImageName) steps: - task: Docker@2 displayName: Build and push an image to container registry inputs: command: buildAndPush repository: $(imageRepository) dockerfile: $(dockerfilePath) containerRegistry: $(dockerRegistryServiceConnection) tags: | $(tag) The result After deployment the application can be get in browser at address https://ndvidemo.azurewebsites.net/ If frontend app is included with backend the landing view is as following. If there is not frontend app included the view of root address looks like this.","title":"Deployment"},{"location":"deployment/deployment/#deployment","text":"In this case the app is deployed to Azure webservice as an container. now the MERN Stack runs on container in Azure web service... !!!! frontend lis\u00e4t\u00e4\u00e4n build ja serverille static asetus HUOM selaimessa PWA asennus LIS\u00c4\u00c4\u00c4 frontend build folder to the root of the server code app.js app.use(express.static(\"build\")); // If the URL contains 'login' or 'register', pass without token validation if (url === '/' || url.includes('login') || url.includes('register')) { return next(); }","title":"Deployment"},{"location":"deployment/deployment/#the-idea","text":"The idea is containerize an application (Azure web app container /-register) https://portal.azure.com/ laakkti@outlook.com https://portal.azure.com/#@laakktioutlook.onmicrosoft.com/resource/subscriptions/08680159-3a33-4f02-a0f1-1b648e13f8a5/resources t\u00e4h\u00e4n vois tulla anmation gif koko jutusta","title":"The idea"},{"location":"deployment/deployment/#dockerfile","text":"FROM node:18 COPY . . RUN npm install CMD [\"npm\", \"start\"]","title":"Dockerfile"},{"location":"deployment/deployment/#container-registry","text":"Registry name (Username): ndvireg Login server: ndvireg.azurecr.io password: Tm9qFwxVD4/DSPi3LmEomsuvW9NDOUlb8f1/Rtp7t3+ACRApVSqe password2: 7+aJFEG6LSKQYgic1rueERF7FKEtCHsfgHUy1FqfUM+ACRCBU4qY docker login ndvireg.azurecr.io Username: ndvireg Password: Tm9qFwxVD4/DSPi3LmEomsuvW9NDOUlb8f1/Rtp7t3+ACRApVSqe","title":"Container Registry"},{"location":"deployment/deployment/#building-the-docker-image","text":"docker build -t ndvireg.azurecr.io/ndvidemo:latest . with command docker images can be seen that image is really created","title":"Building the Docker Image"},{"location":"deployment/deployment/#deploying-to-azure","text":"To push the image from your local to the Azure Container Registry docker push ndvireg.azurecr.io/ndvidemo:latest","title":"Deploying to Azure"},{"location":"deployment/deployment/#azure-web-app","text":"Hosting the container from register","title":"Azure Web App"},{"location":"deployment/deployment/#continuous-deployment","text":"","title":"Continuous Deployment"},{"location":"deployment/deployment/#updating-changes","text":"docker build -t ndvireg.azurecr.io/ndvidemo:latest . docker push ndvireg.azurecr.io/ndvidemo:latest","title":"Updating changes"},{"location":"deployment/deployment/#testing-docker-image-in-local-on-docker-desktop","text":"tai sitten vaan komento rivilt\u00e4 run ... E:\\YAMK\\ytsp0200-3004\\backend_doc\\docs\\img","title":"Testing Docker image in local on Docker Desktop"},{"location":"deployment/deployment/#pipeline","text":"Azure pipeline on Azure DevOps. Pipeline is more advanced for deployment pipeline is triggered by git push","title":"Pipeline"},{"location":"deployment/deployment/#creating-a-pipeline","text":"First the repository for Azure DevOps https://dev.azure.com/ project have to be created the source files should be pushed to the repository of Azure DevOps. Step by step","title":"Creating a pipeline"},{"location":"deployment/deployment/#azure-pipelinesyml","text":"Azure Devops generated YAML file defining pipelines for CI/CD (Continuous Integration/Continuous Deployment). # Docker # Build and push an image to Azure Container Registry # https://docs.microsoft.com/azure/devops/pipelines/languages/docker trigger: - master resources: - repo: self variables: # Container registry service connection established during pipeline creation dockerRegistryServiceConnection: '2b2e35d0-3140-4c01-8409-9e453d42fa6f' imageRepository: 'ndvi' containerRegistry: 'ndvireg.azurecr.io' dockerfilePath: '$(Build.SourcesDirectory)/Dockerfile' tag: '$(Build.BuildId)' # Agent VM image name vmImageName: 'ubuntu-latest' stages: - stage: Build displayName: Build and push stage jobs: - job: Build displayName: Build pool: vmImage: $(vmImageName) steps: - task: Docker@2 displayName: Build and push an image to container registry inputs: command: buildAndPush repository: $(imageRepository) dockerfile: $(dockerfilePath) containerRegistry: $(dockerRegistryServiceConnection) tags: | $(tag)","title":"azure-pipelines.yml"},{"location":"deployment/deployment/#the-result","text":"After deployment the application can be get in browser at address https://ndvidemo.azurewebsites.net/ If frontend app is included with backend the landing view is as following. If there is not frontend app included the view of root address looks like this.","title":"The result"},{"location":"deployment/docker/","text":"img hakemistossa kuvia","title":"Docker"},{"location":"deployment/pipeline/","text":"Azure devops pipeline https://dev.azure.com/","title":"Pipeline"},{"location":"deployment/pipeline/#azure-devops-pipeline","text":"https://dev.azure.com/","title":"Azure devops pipeline"},{"location":"development/development/","text":"tools used tools.md Source code: laita gittiin Release: The MERN-stack runs on the Azure web service at address: https://ndvidemo.azurewebsites.net/ Developing Commands to get the development version from Github to work on your computer The members of the project can copy the project to own computer with the command: git clone https://gitlab.labranet.jamk.fi/AA4598/ytsp0200-3004 node_modules must be installed at the root of the backend with the command: nmp i start the server from the root of the backend with the command: nmp run dev HUOM when NODEMON installed!!!! the application starts at address http://localhost:5000/ node_modules must be installed at the root of the frontend with the command: nmp i start the client from the front end with the command: nmp start the application starts at the browser address http://localhost:3000/ Further development/to be developed Tools and xxx used for this project. ty\u00f6v\u00e4lineet vs code Jupyter Notebook for learning sentinelhub service Azure Data Studio for vscode + extensiosn Azure Data Studio Github Docker Desktop React Frontend Mermaid","title":"Development"},{"location":"development/development/#developing","text":"","title":"Developing"},{"location":"development/development/#further-developmentto-be-developed","text":"Tools and xxx used for this project. ty\u00f6v\u00e4lineet vs code Jupyter Notebook for learning sentinelhub service Azure Data Studio for vscode + extensiosn Azure Data Studio Github Docker Desktop React Frontend Mermaid","title":"Further development/to be developed"},{"location":"intro/","text":"Tools for document mkdocks, markdown, mermaid for diagrams https://github.com/mermaid-js/mermaid For full documentation visit mkdocs.org . Commands mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs -h - Print help message and exit. Project layout mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files. Documentation","title":"Tools for document"},{"location":"intro/#tools-for-document","text":"mkdocks, markdown, mermaid for diagrams https://github.com/mermaid-js/mermaid For full documentation visit mkdocs.org .","title":"Tools for document"},{"location":"intro/#commands","text":"mkdocs new [dir-name] - Create a new project. mkdocs serve - Start the live-reloading docs server. mkdocs build - Build the documentation site. mkdocs -h - Print help message and exit.","title":"Commands"},{"location":"intro/#project-layout","text":"mkdocs.yml # The configuration file. docs/ index.md # The documentation homepage. ... # Other markdown pages, images and other files.","title":"Project layout"},{"location":"intro/overview/","text":"eris\u00e4vyiset vihre\u00e4t h1,h2,h3,h4, h5 on punainen remarks api for NDVI-satellite images and statistics from Sentinel-hub services API What is NDVI NDVI (Normalized Difference Vegetation Index) General description The server (API) app makes it possible to getting NDVI (Normalized Difference Vegetation Index) satellite data from sentinel hub service sentinel-2-l1c and serve it for client. So the farmers and agriculture peoples can see the growing situation of the plants. NDVI (Normalized Difference Vegetation Index) The well known and widely used NDVI is a simple, but effective index for quantifying green vegetation. It normalizes green leaf scattering in Near Infra-red wavelengths with chlorophyll absorption in red wavelengths. The value range of the NDVI is -1 to 1. Negative values of NDVI (values approaching -1) correspond to water. Values close to zero (-0.1 to 0.1) generally correspond to barren areas of rock, sand, or snow. Low, positive values represent shrub and grassland (approximately 0.2 to 0.4), while high values indicate temperate and tropical rainforests (values approaching 1). It is a good proxy for live green vegetation. Getting satellite data from sentinel hub service sentinel-2-l1c requests for sentinel-hub service storing data and queries to database (MongoDb Atlas) reponses to clients from several routes About technology restfull APIs done Framework node express mongo and react MERN Framework Database MERN stack copy build folder at root otetaan app.js api routes user login token-based authentication register app.use(middleware.tokenExtractor); Sentinel-hub token middleware huolehtiin tsekkauksesta requstien yhteydess\u00e4 ett\u00e4 on snetinelin token on elossa ja jos ei ole niin uusitaan. const sentinelhubTokenMiddleware = require('../sentinelhub/sentinelhub_token'); const router = express.Router(); // Middleware for checking token const { checkToken } = sentinelhubTokenMiddleware; // Routes router.post('/list', checkToken, ndviControllers.list); router.post('/activate', checkToken, ndviControllers.activate); Sentinel-hub hakemistossa kaikki liittyv\u00e4 sentinelhub token list image activate activate by the companyid all the aois (geometries geoJson)of the array to get ndvi-images and statsoistocs of specifig period and save data into database weather AOIs to MongoDB Database models components libraries package.json deployment container azure container registry pipeline azure-pipelines.yml Publicification For the result of deployment the MERN stack in a container is running on Azure web service results feelings Developing tools how to get developing environment to work/use green colors if you want.... 02231C 004D25 0F823B 48C053 006400 228B22 2E8B57 556B2F 2F4F4F 546E7A About this document this topic is pretty large to documentize for this assignment so is consentrated for some main parts tolls and test are documented in the future if needed. yleiskatsaus sama kuin intro? data p\u00e4ivitet\u00e4\u00e4n aina kun p\u00e4iv\u00e4 on eri kuin kuluvap\u00e4iv\u00e4 siis tsekkaus onko uutta statistiikkaa JAMK fullstack kurssi readme. kuinka kehitys npm run dev For this demo the databse is filled in the the data neede for a presentation for the app idea using/used the function tool code is made for maintenance token is needed for all functions of the app jus for use of app admin prop has more privolegies mainly for mainteneace and usin ghte tests and tools created. This service is for getting NDVI omages and ralated data from sentinelhub, store it to database for fetching it from user interface and show and handling it. NDVI data is used for agriculture to monitor grain and plant growth t\u00e4h\u00e4n kuvia sentinelhub What is NDVI technology used in generally backend node/express mongo frontend REACT (t\u00e4st\u00e4 enemm\u00e4n ja tarkemmin omassa docussaan) Fullstack MERN Why it\u2019s time to stop processing satellite imagery on your laptop https://medium.com/sentinel-hub/tk-why-its-time-to-stop-processing-satellite-imagery-on-your-laptop-a09dbf8c72c0 There is codetools made for getting and upadatinf NDVi data for specifig geometry (geojson) in specifig date range. should nbe registeed an login In this demo application all the data is avaialable in real world just custom data is avaialeble. test dta is for all users in this demo normaaly in real world dta is custom data fort the registered users theirs fields.","title":"Overview"},{"location":"intro/overview/#api-for-ndvi-satellite-images-and-statistics-from-sentinel-hub-services","text":"API","title":"api for NDVI-satellite images and statistics from Sentinel-hub services"},{"location":"intro/overview/#_1","text":"requests for sentinel-hub service storing data and queries to database (MongoDb Atlas) reponses to clients from several routes","title":""},{"location":"intro/overview/#about-technology","text":"restfull APIs done Framework node express mongo and react MERN","title":"About technology"},{"location":"intro/overview/#framework","text":"","title":"Framework"},{"location":"intro/overview/#database","text":"","title":"Database"},{"location":"intro/overview/#mern-stack","text":"copy build folder at root otetaan","title":"MERN stack"},{"location":"intro/overview/#appjs","text":"","title":"app.js"},{"location":"intro/overview/#api-routes","text":"","title":"api routes"},{"location":"intro/overview/#sentinel-hub-token","text":"middleware huolehtiin tsekkauksesta requstien yhteydess\u00e4 ett\u00e4 on snetinelin token on elossa ja jos ei ole niin uusitaan. const sentinelhubTokenMiddleware = require('../sentinelhub/sentinelhub_token'); const router = express.Router(); // Middleware for checking token const { checkToken } = sentinelhubTokenMiddleware; // Routes router.post('/list', checkToken, ndviControllers.list); router.post('/activate', checkToken, ndviControllers.activate);","title":"Sentinel-hub token"},{"location":"intro/overview/#aois-to-mongodb","text":"","title":"AOIs to MongoDB"},{"location":"intro/overview/#database_1","text":"","title":"Database"},{"location":"intro/overview/#models","text":"","title":"models"},{"location":"intro/overview/#components","text":"","title":"components"},{"location":"intro/overview/#libraries","text":"package.json","title":"libraries"},{"location":"intro/overview/#deployment","text":"","title":"deployment"},{"location":"intro/overview/#container","text":"","title":"container"},{"location":"intro/overview/#azure","text":"","title":"azure"},{"location":"intro/overview/#container-registry","text":"","title":"container registry"},{"location":"intro/overview/#pipeline","text":"azure-pipelines.yml","title":"pipeline"},{"location":"intro/overview/#publicification","text":"For the result of deployment the MERN stack in a container is running on Azure web service","title":"Publicification"},{"location":"intro/overview/#results","text":"","title":"results"},{"location":"intro/overview/#feelings","text":"","title":"feelings"},{"location":"intro/overview/#developing","text":"","title":"Developing"},{"location":"intro/overview/#tools","text":"how to get developing environment to work/use","title":"tools"},{"location":"intro/overview/#02231c","text":"","title":"02231C"},{"location":"intro/overview/#004d25","text":"","title":"004D25"},{"location":"intro/overview/#0f823b","text":"","title":"0F823B"},{"location":"intro/overview/#48c053","text":"","title":"48C053"},{"location":"intro/overview/#006400","text":"","title":"006400"},{"location":"intro/overview/#228b22","text":"","title":"228B22"},{"location":"intro/overview/#2e8b57","text":"","title":"2E8B57"},{"location":"intro/overview/#556b2f","text":"","title":"556B2F"},{"location":"intro/overview/#2f4f4f","text":"546E7A","title":"2F4F4F"},{"location":"intro/overview/#about-this-document","text":"this topic is pretty large to documentize for this assignment so is consentrated for some main parts tolls and test are documented in the future if needed. yleiskatsaus sama kuin intro? data p\u00e4ivitet\u00e4\u00e4n aina kun p\u00e4iv\u00e4 on eri kuin kuluvap\u00e4iv\u00e4 siis tsekkaus onko uutta statistiikkaa JAMK fullstack kurssi readme. kuinka kehitys npm run dev For this demo the databse is filled in the the data neede for a presentation for the app idea using/used the function tool code is made for maintenance token is needed for all functions of the app jus for use of app admin prop has more privolegies mainly for mainteneace and usin ghte tests and tools created. This service is for getting NDVI omages and ralated data from sentinelhub, store it to database for fetching it from user interface and show and handling it. NDVI data is used for agriculture to monitor grain and plant growth t\u00e4h\u00e4n kuvia sentinelhub What is NDVI technology used in generally backend node/express mongo frontend REACT (t\u00e4st\u00e4 enemm\u00e4n ja tarkemmin omassa docussaan) Fullstack MERN","title":"About this document"},{"location":"libraries/libraries/","text":"Node Node.js is a JavaScript runtime environment that allows you to execute JavaScript code on the server-side. It provides the necessary runtime to run Express.js, which is a web application framework for Node.js. Express.js simplifies the process of building web applications and APIs in Node.js by providing a robust set of features and utilities. package.json { \"name\": \"ndviworker\", \"version\": \"1.0.0\", \"description\": \"NDVI images from sentinelhub API \", \"main\": \"app.js\", \"scripts\": { \"start\": \"node app.js\", \"dev\": \"nodemon index.js\" }, \"author\": \"AA4598@student.jamk.fi\", \"license\": \"ISC\", \"dependencies\": { \"@sentinel-hub/sentinelhub-js\": \"^0.4.7\", \"@turf/turf\": \"^6.5.0\", \"axios\": \"^1.6.8\", \"bcrypt\": \"^5.1.1\", \"cors\": \"^2.8.5\", \"dotenv\": \"^16.4.5\", \"express\": \"^4.19.2\", \"jimp\": \"^0.22.12\", \"jsonwebtoken\": \"^9.0.2\", \"mongoose\": \"^8.3.1\", \"mongoose-unique-validator\": \"^5.0.0\", \"morgan\": \"^1.10.0\", \"node-cron\": \"^3.0.3\", \"nodemon\": \"^3.1.0\" } } Express A fast, unopinionated, minimalist web framework for Node.js, used for building web applications and APIs. npm i express Nodemon A utility that automatically restarts your Node.js application when file changes are detected, making development easier. npm i nodemon CORS A middleware for Express to enable Cross-Origin Resource Sharing (CORS), allowing your API to be accessed from different domains. npm i cors @sentinel-hub/sentinelhub-js A JavaScript library to access Sentinel Hub services, enabling you to work with satellite imagery and data from Sentinel satellites. npm i @sentinel-hub/sentinelhub-js Dotenv A module that loads environment variables from a .env file into process.env , useful for managing configuration settings in a project. npm i dotenv Morgan An HTTP request logger middleware for Node.js, useful for logging details of incoming requests for debugging and monitoring. npm i morgan jsonwebtoken A library to create and verify JSON Web Tokens (JWT), commonly used for authentication and secure data exchange. npm i jsonwebtoken @turf/turf A JavaScript library for advanced geospatial analysis, providing various functions for processing and analyzing geographic data. npm i @turf/turf Axios A promise-based HTTP client for the browser and Node.js, used for making HTTP requests to interact with APIs. npm i axios Mongoose An Object Data Modeling (ODM) library for MongoDB and Node.js, providing a straightforward, schema-based solution to model your application data. npm i mongoose mongoose-unique-validator A plugin for Mongoose that provides unique validation for schema fields, ensuring no duplicate values are stored in the database. npm i mongoose-unique-validator Jimp A library for image processing in Node.js, offering various functionalities like resizing, cropping, and image manipulation. npm i jimp Node Cron A task scheduler for Node.js, allowing you to run scheduled tasks using Cron syntax. npm i node-cron bcrypt A library for hashing passwords in Node.js, providing secure methods to store and verify passwords. npm i bcrypt","title":"Libraries"},{"location":"libraries/libraries/#node","text":"Node.js is a JavaScript runtime environment that allows you to execute JavaScript code on the server-side. It provides the necessary runtime to run Express.js, which is a web application framework for Node.js. Express.js simplifies the process of building web applications and APIs in Node.js by providing a robust set of features and utilities.","title":"Node"},{"location":"libraries/libraries/#packagejson","text":"{ \"name\": \"ndviworker\", \"version\": \"1.0.0\", \"description\": \"NDVI images from sentinelhub API \", \"main\": \"app.js\", \"scripts\": { \"start\": \"node app.js\", \"dev\": \"nodemon index.js\" }, \"author\": \"AA4598@student.jamk.fi\", \"license\": \"ISC\", \"dependencies\": { \"@sentinel-hub/sentinelhub-js\": \"^0.4.7\", \"@turf/turf\": \"^6.5.0\", \"axios\": \"^1.6.8\", \"bcrypt\": \"^5.1.1\", \"cors\": \"^2.8.5\", \"dotenv\": \"^16.4.5\", \"express\": \"^4.19.2\", \"jimp\": \"^0.22.12\", \"jsonwebtoken\": \"^9.0.2\", \"mongoose\": \"^8.3.1\", \"mongoose-unique-validator\": \"^5.0.0\", \"morgan\": \"^1.10.0\", \"node-cron\": \"^3.0.3\", \"nodemon\": \"^3.1.0\" } }","title":"package.json"},{"location":"libraries/libraries/#express","text":"A fast, unopinionated, minimalist web framework for Node.js, used for building web applications and APIs. npm i express","title":"Express"},{"location":"libraries/libraries/#nodemon","text":"A utility that automatically restarts your Node.js application when file changes are detected, making development easier. npm i nodemon","title":"Nodemon"},{"location":"libraries/libraries/#cors","text":"A middleware for Express to enable Cross-Origin Resource Sharing (CORS), allowing your API to be accessed from different domains. npm i cors","title":"CORS"},{"location":"libraries/libraries/#sentinel-hubsentinelhub-js","text":"A JavaScript library to access Sentinel Hub services, enabling you to work with satellite imagery and data from Sentinel satellites. npm i @sentinel-hub/sentinelhub-js","title":"@sentinel-hub/sentinelhub-js"},{"location":"libraries/libraries/#dotenv","text":"A module that loads environment variables from a .env file into process.env , useful for managing configuration settings in a project. npm i dotenv","title":"Dotenv"},{"location":"libraries/libraries/#morgan","text":"An HTTP request logger middleware for Node.js, useful for logging details of incoming requests for debugging and monitoring. npm i morgan","title":"Morgan"},{"location":"libraries/libraries/#jsonwebtoken","text":"A library to create and verify JSON Web Tokens (JWT), commonly used for authentication and secure data exchange. npm i jsonwebtoken","title":"jsonwebtoken"},{"location":"libraries/libraries/#turfturf","text":"A JavaScript library for advanced geospatial analysis, providing various functions for processing and analyzing geographic data. npm i @turf/turf","title":"@turf/turf"},{"location":"libraries/libraries/#axios","text":"A promise-based HTTP client for the browser and Node.js, used for making HTTP requests to interact with APIs. npm i axios","title":"Axios"},{"location":"libraries/libraries/#mongoose","text":"An Object Data Modeling (ODM) library for MongoDB and Node.js, providing a straightforward, schema-based solution to model your application data. npm i mongoose","title":"Mongoose"},{"location":"libraries/libraries/#mongoose-unique-validator","text":"A plugin for Mongoose that provides unique validation for schema fields, ensuring no duplicate values are stored in the database. npm i mongoose-unique-validator","title":"mongoose-unique-validator"},{"location":"libraries/libraries/#jimp","text":"A library for image processing in Node.js, offering various functionalities like resizing, cropping, and image manipulation. npm i jimp","title":"Jimp"},{"location":"libraries/libraries/#node-cron","text":"A task scheduler for Node.js, allowing you to run scheduled tasks using Cron syntax. npm i node-cron","title":"Node Cron"},{"location":"libraries/libraries/#bcrypt","text":"A library for hashing passwords in Node.js, providing secure methods to store and verify passwords. npm i bcrypt","title":"bcrypt"},{"location":"libraries/packages/","text":"","title":"Packages"},{"location":"misc/env/","text":"Because this is just demo case the keys and passwords etc. can be publiched, normally never # sentinel-hub sentinelHubClientId = \"e6d09849-8f21-4200-b605-0bac5b7d1d56\" sentinelHubClientSecret = \"DxFgGuUSg6BHRBpWHM6QZH8ojExNik9L\" instanceId = \"736d4248-8e93-4bbf-824f-56dba7da0db5\" # mongodb mongoURI=\"mongodb+srv://laakktidev:AA4598@develop.pgqgteo.mongodb.net/ndvidb?retryWrites=true&w=majority\" # openweathermap OPW_API_KEY = \"bf4237c0169c9c266117e7ad17b6bf3f\" TOKEN=\"TOPSECRET\"","title":"Environment variables"},{"location":"results/results/","text":"From the start I started with Python, because the main API-documentation for sentinel-hub is for Python. There is examples of use IPythonwhich is handy Jupyter notebook But choide was usse of Javascript with node. Afterwards I would choose using sentinnel-hub with python as an node subprocess with spawn library. Why python is jsut more convonient and more supported, it also have real multithreading and parallel concurrent there is libraries for multiprosessing and threading stuff. which actaully needed when the database is em\u00e5yt and concurrent request for data from long time range with multiple aois. and for the future challenge with artificial intelligense python is the best choice. apawn sub-process for code JavaScript Standard Style https://standardjs.com// naming policy In general I have tried to follow the principles and best practices of dynamism, reusability, maintainability, further developability I think I did pretty well. About documenting To be honest the documentation was propably the most challenging part of this process, hope learned something and get it to routine level with suitable tools and methods. Which poin of view to the documentation... AI I use chatGbt, Geninim and Copilot for some routines impressive how Ai can JSdoc style commented only some corrections and fixes qualifies the methods parametres and return values has been very helpful commented afterwards ok this kind of code is not a rocket science not big problems, bussiness as usual with the problems Feelings this was a good learning process... the trip is more impoerant that the goal, this assignment with MERN-stack adds more self confidence in the future boosted/strengthened self-confidence","title":"Results"},{"location":"results/results/#from-the-start","text":"I started with Python, because the main API-documentation for sentinel-hub is for Python. There is examples of use IPythonwhich is handy Jupyter notebook But choide was usse of Javascript with node. Afterwards I would choose using sentinnel-hub with python as an node subprocess with spawn library. Why python is jsut more convonient and more supported, it also have real multithreading and parallel concurrent there is libraries for multiprosessing and threading stuff. which actaully needed when the database is em\u00e5yt and concurrent request for data from long time range with multiple aois. and for the future challenge with artificial intelligense python is the best choice. apawn sub-process","title":"From the start"},{"location":"results/results/#for-code-javascript-standard-style","text":"https://standardjs.com//","title":"for code JavaScript Standard Style"},{"location":"results/results/#naming-policy","text":"","title":"naming policy"},{"location":"results/results/#in-general","text":"I have tried to follow the principles and best practices of dynamism, reusability, maintainability, further developability I think I did pretty well.","title":"In general"},{"location":"results/results/#about-documenting","text":"To be honest the documentation was propably the most challenging part of this process, hope learned something and get it to routine level with suitable tools and methods. Which poin of view to the documentation...","title":"About documenting"},{"location":"results/results/#ai","text":"I use chatGbt, Geninim and Copilot for some routines impressive how Ai can JSdoc style commented only some corrections and fixes qualifies the methods parametres and return values has been very helpful commented afterwards ok this kind of code is not a rocket science not big problems, bussiness as usual with the problems","title":"AI"},{"location":"results/results/#feelings","text":"this was a good learning process... the trip is more impoerant that the goal, this assignment with MERN-stack adds more self confidence in the future boosted/strengthened self-confidence","title":"Feelings"},{"location":"risks_and_challenges/risks_and_challenges/","text":"RISKIT l\u00e4hinn\u00e4 activate sentinekhub resources plan, traffic of the server network traffic end to end. azure service plan because of the em\u00e5yt database it my need massive update process. so the most secue way is updat eone by one. It is possible concurrent update process but can not be promised to success riskit haastee ja resursstit which account/plan choose or you are ready to pay azure sek\u00e4 sentinelhub because of nature of the data the is no big risk to fail the data fetching is not unique event like e.g. measuring event but the same data is osisble to fetch/request/query any time beacuse sentinelhub service holds the dat ain bigger picture after all. MIK\u00c4 virheilmoitus ett\u00e4 resurssit sentinelhubilla loppu!!!! if using some parallel mechanism it could cause at some point to fail to DOS (Denial of Service). Sentinelhub has limit reuest ja prosessing units of specifig time demepnds of your service plan. sentinel-hub freea account plan montly resources is not enough for all data processing and fetching Mongodb free account 512 mb was not enough for all the data existing for NDVI data.","title":"Risks and challenges"},{"location":"roskis/aois_to_mongo/","text":"At the beginnig there is a file of list of geojson. File contans some/multiple geometries of the fields/plants in Finland AOIs to MongoDB sequenceDiagram autonumber participant Frontend participant Backend participant MongoDb Frontend->>Backend: GET /ndvi/api/v1/workAreasToMongo activate Backend note right of Backend: require(\"../data/workareas.json\") alt Backend->>Backend: Loop through each workarea (index i) Backend->>MongoDb: Insert workarea data[i] MongoDb-->>Backend: Acknowledge insertion else Loop Done deactivate Backend Backend->>Frontend: Status 200 (successful) end","title":"Aois to mongo"},{"location":"roskis/aois_to_mongo/#aois-to-mongodb","text":"sequenceDiagram autonumber participant Frontend participant Backend participant MongoDb Frontend->>Backend: GET /ndvi/api/v1/workAreasToMongo activate Backend note right of Backend: require(\"../data/workareas.json\") alt Backend->>Backend: Loop through each workarea (index i) Backend->>MongoDb: Insert workarea data[i] MongoDb-->>Backend: Acknowledge insertion else Loop Done deactivate Backend Backend->>Frontend: Status 200 (successful) end","title":"AOIs to MongoDB"},{"location":"roskis/api/","text":"Introduction RESTful interface for getting NDVI-images and related data from Sentinel Hub. list which days have images available for given geometry get images for given days and geometries NDVI service needs to be able to process requests for getting the dates with images for given geometries and for getting the images for given dates and geometries. Use Cases List List the days with found images for the given geometry found in Sentinel Hub. Service should store the given geometry and the days in which the images can be found so that there would be no need to re-query the days (only newer days from the last query should be queried) every time from Sentinel Hub. If the image is available for given day then the service should assign unique id \"sentinelid\" for that day and image. Endpoint Url HTTP Method /ndvi/api/v1/list POST Request Name Type Description geometry geoJSON Geometry in geoJSON format, coordinate reference system WGS84 (EPSG:4326) start_date dateString (ISO 8601) The start date to include images from end_date dateString (ISO 8601) The end date to include images to Request body { \"geometry\": \"geoJSON\", \"start_date\": \"dateString\", \"end_date\": \"dateString\" } Response Name Type Description array All the days from which images can be queried generationtime dateString (ISO 8601) The date of the image sentinelid string generationtime and geometry converted to sha256-format, generated for the request to be used when fetching the image from database e.g. 2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba038cb86b647 ** graphia/cahrtia varten lis\u00e4tty sttistiikkaa ** [ { \"generationtime\": \"2023-05-15T00:00:00Z\", \"sentinelid\": \"2023-05-15T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba...\" }, { \"generationtime\": \"2023-05-30T00:00:00Z\", \"sentinelid\": \"2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba...\" }, // ... ] Sequence diagram sequenceDiagram Client->>+NDVI: list(listData) alt data is invalid NDVI->>Client: 422 Unprocessable Entity else NDVI->>Client: return days for geometry end !!!!!!!! HUOMIOI my\u00f6s stardard deviation tarkoitta sit\u00e4 ett\u00e4 l\u00e4mp\u00e4n\u00e4 0:aa arvot ovat l\u00e4hell\u00e4 toisaan eli tasaista (voitaneen huomata NDVI-kuvasta) HUOMIO my\u00f6s min, max, mean arvot v\u00e4litet\u00e4\u00e4n graafia varten POISTA t\u00e4st\u00e4 dokusta Teemun jutut ehk\u00e4 turhia toisaalta Image Returns the NDVI image for the given sentinelid. Endpoint Url HTTP Method /ndvi/api/v1/image/ GET Request Name Type Description sentinelid string id for image (generated when image with related data fetched from sentinelhub and saved into database) epsg integer optional, used when related coordinates need to be in system EPSG:3067 Response Name Type Description average float Average value of the NDVI max float Maximum value of the NDVI min float Minimum value of the NDVI std float Standard deviation value of the NDVI image Image of the NDVI image.minX float Bounding rect minimum X value, coordinate reference system WGS84 (EPSG:4326) image.minY float Bounding rect minimum Y value, coordinate reference system WGS84 (EPSG:4326) image.maxX float Bounding rect maximum X value, coordinate reference system WGS84 (EPSG:4326) image.maxY float Bounding rect maximum Y value, coordinate reference system WGS84 (EPSG:4326) image.dataUrl Base&4 string Image in Base64 string format (i.e., data:image/png;base64...) scale array Array for NDVI value categories as colours scale.color string Colour as RGB string value scale.amount integer scale.from float Response datatypes { \"average\": \"float\", \"max\": \"float\", \"min\": \"float\", \"image\": { \"minX\": \"float\", \"minY\": \"float\", \"maxX\": \"float\", \"maxY\": \"float\", \"dataUrl\": \"Base64 string\" }, \"scale\": [ { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" } ] } Example LIS\u00c4\u00c4 STD { \"average\": 0.5657129907618343, \"max\": 0.75, \"min\": 0.15, \"image\": { \"minX\": 26.1930913, \"minY\": 62.9857763, \"maxX\": 26.194766, \"maxY\": 62.9867615 \"dataUrl\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABuCAYAAACnQwS5AAADnEl...\" }, \"scale\": [ { \"color\": \"rgb(244, 67, 54)\", \"amount\": 0, \"from\": 0.15 }, { \"color\": \"rgb(255, 152, 0)\", \"amount\": 0, \"from\": 0.3 }, { \"color\": \"rgb(255, 235, 59)\", \"amount\": 22, \"from\": 0.45 }, { \"color\": \"rgb(76, 175, 80)\", \"amount\": 78, \"from\": 0.6 } ] } Sequence diagram sequenceDiagram Client->>+NDVI: image alt no image available for sentinelid NDVI->>Client: 404 Not found else NDVI->>-Client: 200 OK end MARK:notice::: in case of 404 there is sometring error situation on front end or database is corrupted. Will happen very rarely or never but in testinf/developing situations. Activate esimerkki lis\u00e4\u00e4 jokin peltosetti, at the beginnig there no data at all for a specifig time range, so all the data have to be prosessed and fetched/requested from sentinelhub When activate with AOIs so it will be known later which geometries NDI data need to be updated data form upcoming dates 24h cron ja t\u00e4m\u00e4 vain kasvukauden aikana p\u00e4iivtt\u00e4\u00e4 koko kantaa ja peltosetit ovat sopiva m\u00e4\u00e4r\u00e4 kerrall muuten tulee mahd. sanomista too many requests TESTATTAVA useaa samaiakaista toimeksiantoa RiSKI jos resurssit eiv\u00e4t riit\u00e4 erillinen kappale SWOT tai j\u00e4rkev\u00e4mpi ottaa geometriat taleteen ja aja ne Status of activation If tou have large set of fields it will take more time for totally new data time period range Dev Demo kannan testaukseen ja yll\u00e4pitoon erillinen route voidaan helposti ottaa mukaan t\u00e4st\u00e4h\u00e4n on esimerkki t\u00e4m\u00e4 on Mongo joka tapauksessa, json-tiedosto, jossa geometriat -> mongoon CRUD tosin t\u00e4ss\u00e4 tapauksessa ei ole Updatea PUT UPDATE MUTTA UPDATE tai PUT on kun User authetication tulisiko peltotilkutkin listana!!!!","title":"Introduction"},{"location":"roskis/api/#introduction","text":"RESTful interface for getting NDVI-images and related data from Sentinel Hub. list which days have images available for given geometry get images for given days and geometries NDVI service needs to be able to process requests for getting the dates with images for given geometries and for getting the images for given dates and geometries.","title":"Introduction"},{"location":"roskis/api/#use-cases","text":"","title":"Use Cases"},{"location":"roskis/api/#list","text":"List the days with found images for the given geometry found in Sentinel Hub. Service should store the given geometry and the days in which the images can be found so that there would be no need to re-query the days (only newer days from the last query should be queried) every time from Sentinel Hub. If the image is available for given day then the service should assign unique id \"sentinelid\" for that day and image. Endpoint Url HTTP Method /ndvi/api/v1/list POST Request Name Type Description geometry geoJSON Geometry in geoJSON format, coordinate reference system WGS84 (EPSG:4326) start_date dateString (ISO 8601) The start date to include images from end_date dateString (ISO 8601) The end date to include images to Request body { \"geometry\": \"geoJSON\", \"start_date\": \"dateString\", \"end_date\": \"dateString\" } Response Name Type Description array All the days from which images can be queried generationtime dateString (ISO 8601) The date of the image sentinelid string generationtime and geometry converted to sha256-format, generated for the request to be used when fetching the image from database e.g. 2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba038cb86b647","title":"List"},{"location":"roskis/api/#-","text":"** graphia/cahrtia varten lis\u00e4tty sttistiikkaa ** [ { \"generationtime\": \"2023-05-15T00:00:00Z\", \"sentinelid\": \"2023-05-15T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba...\" }, { \"generationtime\": \"2023-05-30T00:00:00Z\", \"sentinelid\": \"2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba...\" }, // ... ] Sequence diagram sequenceDiagram Client->>+NDVI: list(listData) alt data is invalid NDVI->>Client: 422 Unprocessable Entity else NDVI->>Client: return days for geometry end !!!!!!!!","title":"-->"},{"location":"roskis/api/#huomioi-myos-stardard-deviation-tarkoitta-sita-etta-lampana-0aa-arvot-ovat-lahella-toisaan-eli-tasaista-voitaneen-huomata-ndvi-kuvasta","text":"HUOMIO my\u00f6s min, max, mean arvot v\u00e4litet\u00e4\u00e4n graafia varten POISTA t\u00e4st\u00e4 dokusta Teemun jutut ehk\u00e4 turhia toisaalta","title":"HUOMIOI my\u00f6s stardard deviation tarkoitta sit\u00e4 ett\u00e4 l\u00e4mp\u00e4n\u00e4 0:aa arvot ovat l\u00e4hell\u00e4 toisaan eli tasaista (voitaneen huomata NDVI-kuvasta)"},{"location":"roskis/api/#image","text":"Returns the NDVI image for the given sentinelid. Endpoint Url HTTP Method /ndvi/api/v1/image/ GET Request Name Type Description sentinelid string id for image (generated when image with related data fetched from sentinelhub and saved into database) epsg integer optional, used when related coordinates need to be in system EPSG:3067 Response Name Type Description average float Average value of the NDVI max float Maximum value of the NDVI min float Minimum value of the NDVI std float Standard deviation value of the NDVI image Image of the NDVI image.minX float Bounding rect minimum X value, coordinate reference system WGS84 (EPSG:4326) image.minY float Bounding rect minimum Y value, coordinate reference system WGS84 (EPSG:4326) image.maxX float Bounding rect maximum X value, coordinate reference system WGS84 (EPSG:4326) image.maxY float Bounding rect maximum Y value, coordinate reference system WGS84 (EPSG:4326) image.dataUrl Base&4 string Image in Base64 string format (i.e., data:image/png;base64...) scale array Array for NDVI value categories as colours scale.color string Colour as RGB string value scale.amount integer scale.from float Response datatypes { \"average\": \"float\", \"max\": \"float\", \"min\": \"float\", \"image\": { \"minX\": \"float\", \"minY\": \"float\", \"maxX\": \"float\", \"maxY\": \"float\", \"dataUrl\": \"Base64 string\" }, \"scale\": [ { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" } ] } Example LIS\u00c4\u00c4 STD { \"average\": 0.5657129907618343, \"max\": 0.75, \"min\": 0.15, \"image\": { \"minX\": 26.1930913, \"minY\": 62.9857763, \"maxX\": 26.194766, \"maxY\": 62.9867615 \"dataUrl\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABuCAYAAACnQwS5AAADnEl...\" }, \"scale\": [ { \"color\": \"rgb(244, 67, 54)\", \"amount\": 0, \"from\": 0.15 }, { \"color\": \"rgb(255, 152, 0)\", \"amount\": 0, \"from\": 0.3 }, { \"color\": \"rgb(255, 235, 59)\", \"amount\": 22, \"from\": 0.45 }, { \"color\": \"rgb(76, 175, 80)\", \"amount\": 78, \"from\": 0.6 } ] } Sequence diagram sequenceDiagram Client->>+NDVI: image alt no image available for sentinelid NDVI->>Client: 404 Not found else NDVI->>-Client: 200 OK end MARK:notice::: in case of 404 there is sometring error situation on front end or database is corrupted. Will happen very rarely or never but in testinf/developing situations.","title":"Image"},{"location":"roskis/api/#activate","text":"esimerkki lis\u00e4\u00e4 jokin peltosetti, at the beginnig there no data at all for a specifig time range, so all the data have to be prosessed and fetched/requested from sentinelhub When activate with AOIs so it will be known later which geometries NDI data need to be updated data form upcoming dates 24h cron ja t\u00e4m\u00e4 vain kasvukauden aikana p\u00e4iivtt\u00e4\u00e4 koko kantaa ja peltosetit ovat sopiva m\u00e4\u00e4r\u00e4 kerrall muuten tulee mahd. sanomista too many requests TESTATTAVA useaa samaiakaista toimeksiantoa RiSKI jos resurssit eiv\u00e4t riit\u00e4 erillinen kappale SWOT tai j\u00e4rkev\u00e4mpi ottaa geometriat taleteen ja aja ne","title":"Activate"},{"location":"roskis/api/#status-of-activation","text":"If tou have large set of fields it will take more time for totally new data time period range","title":"Status of activation"},{"location":"roskis/api/#dev","text":"Demo kannan testaukseen ja yll\u00e4pitoon erillinen route voidaan helposti ottaa mukaan t\u00e4st\u00e4h\u00e4n on esimerkki t\u00e4m\u00e4 on Mongo joka tapauksessa, json-tiedosto, jossa geometriat -> mongoon CRUD tosin t\u00e4ss\u00e4 tapauksessa ei ole Updatea PUT UPDATE MUTTA UPDATE tai PUT on kun","title":"Dev"},{"location":"roskis/api/#user","text":"","title":"User"},{"location":"roskis/attachments/","text":"t\u00e4nne linkit ja mahd. kuvat yms. viitataan kappaleista voiko mkdocksiissa hyp\u00e4t\u00e4 tai ottta ikkunna jokin toinen doku evalscript https://docs.sentinel-hub.com/api/latest/evalscript/","title":"Attachments"},{"location":"roskis/attachments/#evalscript","text":"https://docs.sentinel-hub.com/api/latest/evalscript/","title":"evalscript"},{"location":"roskis/background_intro/","text":"I tested performance sentinel-hub dservice with iPythin using Jupyter notebook Johonkin viekl\u00e4 list mit\u00e4tekno,ogioita tuli k\u00e4ytetty\u00e4 ty\u00e4todostus Topic for this topic an alternative abroac for the restFull server and API would be Python based but for the some reasons Javascript based abroach was chosen. Ali prosessi sentinelhub dev-routes building/develoiping for this kind of MERN stack system need olso develoiping code/tools and Needs much of testing... Tarinan loppuun Now I thinbkkthat Python would be the choose for the restFull server and fatching and handling data from sentinelHub Python API. lot of testing and tool code osuus mietteit\u00e4 tuhlasin paljion aikaa proseesin nooeuttamiseen, kokeilin my\u00f6s Python aliprosessia Actually test database contains all AOI in the system, NDVI database will include all NDVI-imagedata of specifig time/date perioid for all AOI. Contorlling and montoring all the AOI on the system. Posisble to make data analysess in generel considering all the AOIs on the system. StadardDeviation is for se if the growth is steady tasaista, this is seen also in te NDVI image ofin visual. the closer the value is to zero, the more steady the growth.","title":"Background intro"},{"location":"roskis/background_intro/#topic","text":"for this topic an alternative abroac for the restFull server and API would be Python based but for the some reasons Javascript based abroach was chosen. Ali prosessi sentinelhub dev-routes building/develoiping for this kind of MERN stack system need olso develoiping code/tools and Needs much of testing... Tarinan loppuun Now I thinbkkthat Python would be the choose for the restFull server and fatching and handling data from sentinelHub Python API. lot of testing and tool code osuus mietteit\u00e4 tuhlasin paljion aikaa proseesin nooeuttamiseen, kokeilin my\u00f6s Python aliprosessia","title":"Topic"},{"location":"roskis/background_intro/#actually-test-database-contains-all-aoi-in-the-system-ndvi-database-will-include-all-ndvi-imagedata-of-specifig-timedate-perioid-for-all-aoi","text":"Contorlling and montoring all the AOI on the system. Posisble to make data analysess in generel considering all the AOIs on the system. StadardDeviation is for se if the growth is steady tasaista, this is seen also in te NDVI image ofin visual. the closer the value is to zero, the more steady the growth.","title":"Actually test database contains all AOI in the system, NDVI database will include all NDVI-imagedata of specifig time/date perioid for all AOI."},{"location":"roskis/collections/","text":"dates images users aois kaikki geometriat tosin acctivaten kautta yksi skenaario eli companyId ja array of geometries (JSON)","title":"Collections"},{"location":"roskis/descriptions/","text":"t\u00e4nne tullee lyhenteet AOI area of interest e.g. agriculture field or forest (tsekkaa viel\u00e4 netist\u00e4 (chatgbt)","title":"Descriptions"},{"location":"roskis/diagrams/","text":"project-root \u2514\u2500\u2500 src \u251c\u2500\u2500 App.js \u251c\u2500\u2500 02.jpg \u2514\u2500\u2500 ... Muuten ok mutta response clientille kun storen j\u00e4lkeen haetaan uudelleen mongosta Tosin jos geometrille ei ole kuvia response list ei toimi sequenceDiagram autonumber participant Client participant Server participant MongoDB participant SentinelHub Client->>Server: Request Server->>MongoDB: Query MongoDB-->>Server: Data alt Data found in MongoDB Server-->>Client: Response else Data not found in MongoDB Server->>SentinelHub: Request SentinelHub-->>Server: Response Server->>MongoDB: Store Data Server-->>Client: Response end Participants: Client: The entity initiating the request. Server: The central processing entity that handles client requests, communicates with MongoDB, and interacts with SentinelHub. MongoDB: The database used to store and retrieve data. SentinelHub: An external service from which the server can request data. Sequence of Interactions: The \"Client\" sends a \"Request\" to the \"Server.\" The \"Server\" checks if the required data is available in \"MongoDB\" by sending a \"Query\" to it. If the data is found in \"MongoDB,\" it responds directly to the \"Client\" with a \"Response.\" If the data is not found in \"MongoDB\" after receiving a response from \"SentinelHub,\" the \"Server\" stores the data in \"MongoDB.\" The \"Server\" then retrieves the data from \"MongoDB.\" Finally, the \"Server\" responds to the \"Client\" with the retrieved data. sequenceDiagram participant Client participant Server participant MongoDB participant SentinelHub Client->>Server: Request Server->>MongoDB: Query MongoDB-->>Server: Data alt Data found in MongoDB Server-->>Client: Response else Data not found in MongoDB Server->>SentinelHub: Request SentinelHub-->>Server: Response Server->>MongoDB: Store Data Server->>MongoDB: Retrieve Data MongoDB-->>Server: Retrieved Data Server-->>Client: Response end sequenceDiagram participant Client participant Server participant MongoDB participant SentinelHub Client->>Server: Request Server->>MongoDB: Query MongoDB-->>Server: Data alt Data found in MongoDB Server-->>Client: Response else Data not found in MongoDB Server->>SentinelHub: Request SentinelHub-->>Server: Response Server->>MongoDB: Store Data Server->>MongoDB: Query MongoDB-->>Server: Data Server-->>Client: Response end ::: sequenceDiagram participant Client participant Server participant MongoDB participant SentinelHubXX Client->>Server: Request Server->>MongoDB: Query MongoDB-->>Server: Data alt Data found in MongoDB Server-->>Client: Response (Data found in MongoDB) Note right of Server: Data found in MongoDB else Data not found in MongoDB Server->>SentinelHubXX: Request SentinelHubXX-->>Server: Response (Data not found in MongoDB) Server->>MongoDB: Store Data Server->>MongoDB: Query MongoDB-->>Server: Data Server-->>Client: Response (Data not found in MongoDB) Note right of Server: Data not found in MongoDB end ::: %%{ init: { 'theme': 'base', 'themeVariables': { 'primaryColor': '#BB2528', graph LR; A[Wiki supports Mermaid] --> B[Visit https://mermaidjs.github.io/ for Mermaid syntax]; 'primaryTextColor': '#fff', 'primaryBorderColor': '#7C0000', 'lineColor': '#F8B229', 'secondaryColor': '#006100', 'tertiaryColor': '#fff' } } }%% graph TD A[Christmas] -->|Get money| B(Go shopping) B --> C{Let me think} B --> G[/Another/] C ==>|One| D[Laptop] C -->|Two| E[iPhone] C -->|Three| F[fa:fa-car Car] subgraph section C D E F G end ::: flowchart TB subgraph personalBankingCustomer[Personal Banking Customer] h1[-Person-]:::type d1[A customer of the bank, with \\n personal bank accounts]:::description end personalBankingCustomer:::person subgraph internetBankingSystem[Internet Banking System] h2[-Software System-]:::type d2[Allows customers to view \\n information about their bank \\n banks, and make payments]:::description end internetBankingSystem:::internalSystem subgraph mainframeBankingSystem[Mainfram Banking System] h3[-Software System-]:::type d3[Stores all of the core banking \\n information about customers, \\n accounts, transactions etc]:::description end mainframeBankingSystem:::externalSystem subgraph emailSystem[Email System] h4[-Software System-]:::type d4[The internal Microsoft Exchange \\n email system]:::description end emailSystem:::externalSystem personalBankingCustomer--Views account \\n balances, and \\n makes payments \\n using-->internetBankingSystem internetBankingSystem--Gets accounts \\n information from, \\n and makes \\n payments using-->mainframeBankingSystem internetBankingSystem--Sends emails using--> emailSystem emailSystem--Sends emails to-->personalBankingCustomer %% Element type definitions classDef person fill:#08427b classDef internalSystem fill:#1168bd classDef externalSystem fill:#999999 classDef type stroke-width:0px, color:#fff, fill:transparent, font-size:12px classDef description stroke-width:0px, color:#fff, fill:transparent, font-size:13px ::: graph TD A[Christmas] -->|Get money| B(Go shopping) B --> C{Let me think} C -->|One| D[Laptop] C -->|Two| E[iPhone] C -->|Three| F[fa:fa-car Car] classDef node fill:#0f0,stroke-width:4px; classDef red fill:#f00,stroke-width:1px; class B red; graph LR MyApp --> DB(fa:fa-database MySQL) style DB fill:#00BBFF","title":"Diagrams"},{"location":"roskis/diary/","text":"npm run dev### 26.3.2024 dev-route for json array of geometries (geoJson) to mongoDb, testing adding std for the data from setinelHub resfFull plugin tee testi routeihin ilman ja tokenin kanssa!!!! tsekkaa v\u00e4\u00e4r\u00e4 osoit ekun token on p\u00e4\u00e4ll\u00e4 01.04.2024 routes for token based registering and loggiin token based... implement support for token-based authentication, routes for registering and logging, mongoDb schemas and Api methods 28.03.2024 dev-route/workarea json data to database dev-route to response for AOIList request 29.03.2024 endpoint route /list responses with list of dates if stattistics for date is not existed in database it will ve fetched from sentinelhub t\u00e4h\u00e4n osoite and stored to database also NDVI images of the list are stored in database name of the image 01.04.2024 pai -route for reuest iamge /image /activate /weather TEE frontendin kanssa samaan tahtiin 29.03.2024 Checking mobile use e.g. pwa tsekkaa mobile programming kurssi 01.04.2024 t\u00e4m\u00e4 backend diaryyn registering and loggiin token based... 2.04.2024 refactoring page demo fetching all the geometry based NDVI images from the server/database/senetinelhub lot of time for setting UI and resoinsicve not working/performing perfectly need session to desighn and learn more UI and UX to produce responsive application we can chage aoi any time we want so the selected view will be pdated new data. todo; compareyears mallia koosta chartiin ja div m\u00e4\u00e4ritet\u00e4\u00e4n parentissa 90% 90% Compare years The years not the save weather conditionals for agriculture in Finaland is pretty changing. Conditions are ... thre is not data for the same dates every year. The average values of each year are put to the same axis TODO: yhdist\u00e4 getImageRequest ja getAxiosRequest siis annetaan koko url imagessa on nyt lis\u00e4n\u00e4 image, muuten sama kuin... 11.04.2024 set React Bootstrap layout create, simple example to practise dynamic resposivgibility 14.04.2024 Testing when/while backend is running in Azure web service, works fine but hhe Azure plan is pretty slow comparing to testing/use in local. 15.04.2024 To biggest challenge was positioning the elements and responsive Many studies had, there has been said tHAT UI/UX TAKes much of times so not focusing it to spned suunnitelty aika, theres bunch of UI gaphical libs.","title":"Diary"},{"location":"roskis/finalize/","text":"t\u00e4nn etulee viimeistelyt mm. testit ja standardointi","title":"Finalize"},{"location":"roskis/ndvi/","text":"","title":"Ndvi"},{"location":"roskis/planning/","text":"KOKEMU SEEN learning curve I have learned from experience that starting the project from scratch would take much less time. xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx planning to use Python beacuse of multithreading because sumultanousus data fetchong na processing and storeing sentinelhub python api but few day later eent back to original plan. Purely because of earlier experiment MERN stack and it is needed for schedule with this schedu I will achoeve more features actually everything which is needed, but not foget pythion evironment ans ecosystem in the future. I would prefer Python from the start/sctratch. but from the start I would chosee Python for the future bacause of AI etc. getting NDVI data, statistiscs and prosessing Imagedata For the plan base of the backend server needs node/express. for develing logginf morgan Every applivation need database for storing data so it cn can be achieving faster and more eaier and not consuming resources of the sources sentinelhub request and processing limits and restrutions of the choosen plan. Store the data As MERN stack assumes that database choise would be Mongo. Another candidate was postgresql but Mongo got a win at this time. MongoDb at cloud could be MongoDb Atlas. This projet does not need complicated queries ad relations between tables jist few noSQL commands, otherwise SQL-bases postge could be better choice https://www.mongodb.com/atlas/database mongoose for mongodb would be the library which methods would be used. because of speed and costs, so musch data is time consuming wasting also the price for getting data everytime and processing it at sentinel-hub has a price, pretty expensive. Updating routes login and regitratios xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx 22.03.2024 (source) Data (in json) format should be inserted into database including geometrias of different areas (fields, plants) agriculture AOI (Area Of Interest) mongoDb Schema instead of \"Go Live\" npx http-server . -p 8080 on build folder STATE variable handling when the app is growing will come a situation when redeux is more handy tha delvering variables as parameter/argument in a chain of elements REDUX or context should be worth of no need to deliver varibels element to element, probably chain... UI comments bootstao grid system would be more clearer separate kuin kikkailla resonsive Ui is pretty challengint to achieve, took lot of time. Probably the most challenging part of designing. For this document I ghave picked up some the most important issues/topics Animated gif kun bargraph clikataan pylv\u00e4st\u00e4 n\u00e4yt\u00e4 kun client ottaa yhteyden niin backendissa dev versiossa morgan n\u00e4ytt\u00e4\u00e4.... PWA The easiest way is use template when creating the app with \"npx create-react-app\" 1. using template npx create-react-app my-app --template cra-template-pwa in index.js serviceWorkerRegistration.register(); manifest.json LIGTHOUSE test in developers tools I am nit sure is there reason to use PWA with this appalication. Sizing pienenn\u00e4 filmin kuvia to be notised that mobile portrait , pc viewport and fullscreen and PWA Fullscreen bootstrap grid system there is not height for row 1 & 2 paljonko on mt-5 pikseleiss\u00e4/tarvitaanko tieto this demo has example n\u00e4yt\u00e4 anmation gif eri n\u00e4yttt\u00f6 koista for sizing the last row is used HOOK useDynamicRowHeight rowRef useEffect(() => { window.addEventListener(\"resize\", handleResize); return () => { window.removeEventListener(\"resize\", handleResize); }; }, [rowRef]); Mobile It woukd be better to define separate branch for mobile and pc so it would be easier to maintain ja implement further development. 21.03.2024 database selection between mongoDb and postgereSql. -> mongoDb was selected, reason the costs 22.03.2024 (source) Data (in json) format should be inserted into database including geometrias of different areas (fields, plants) agriculture AOI (Area Of Interest) mongoDb Schema wrapping the compoinent itself can not be modified just container around it forthe need UI design trying to do a dynamic to be suitable for different size of displays helping guidelines import \"./grid.css\"; className=\"grid-line\" .grid-line { border: 1px solid #ddd000; } MERMAID source: ./src/data/workareas.json target: mongoDb schema workarea.js ./src/mongo/models/workarea.js var mongoose = require(\"mongoose\"); var workareaSchema = new mongoose.Schema({ id: { type: String, required: true, unique: true, }, workareaid: { type: String, required: true, unique: true, }, name: { type: String, required: true, unique: false, }, backofficeid: { type: String, required: true, unique: false, }, geometry: { type: Object, required: true, unique: true, }, ndvi: { type: Boolean, default: false, } }); module.exports = new mongoose.model(\"Workarea\", workareaSchema); mongodb.md:ss\u00e4!!!! mongodb.js saveWorkArea url path route ./routes/dev-routes.js const devControllers = require('../controllers/dev-controllers'); router.get('/workAreasToMongo', devControllers.workAreasToMongo); dev-controllers.js workAreasToMongo App.js if (process.env.NODE_ENV !== 'production') { const devRouter = require('./routes/dev-routes'); app.use('/ndvi/api/v1', devRouter); } endpoint: .../ndvi/api/v1/workAreasToMongo sequenceDiagram autonumber participant Frontend participant Backend participant MongoDb Frontend->>Backend: GET /ndvi/api/v1/workAreasToMongo activate Backend note right of Backend: require(\"../data/workareas.json\") alt Backend->>Backend: Loop through each workarea (index i) Backend->>MongoDb: Insert workarea data[i] MongoDb-->>Backend: Acknowledge insertion else Loop Done deactivate Backend Backend->>Frontend: Status 200 (successful) end","title":"Planning"},{"location":"roskis/planning/#learning-curve","text":"I have learned from experience that starting the project from scratch would take much less time.","title":"learning curve"},{"location":"roskis/planning/#xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx","text":"planning to use Python beacuse of multithreading because sumultanousus data fetchong na processing and storeing sentinelhub python api but few day later eent back to original plan. Purely because of earlier experiment MERN stack and it is needed for schedule with this schedu I will achoeve more features actually everything which is needed, but not foget pythion evironment ans ecosystem in the future. I would prefer Python from the start/sctratch. but from the start I would chosee Python for the future bacause of AI etc.","title":"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"},{"location":"roskis/planning/#getting-ndvi-data-statistiscs-and-prosessing-imagedata","text":"For the plan base of the backend server needs node/express. for develing logginf morgan Every applivation need database for storing data so it cn can be achieving faster and more eaier and not consuming resources of the sources sentinelhub request and processing limits and restrutions of the choosen plan.","title":"getting NDVI data, statistiscs and prosessing Imagedata"},{"location":"roskis/planning/#store-the-data","text":"As MERN stack assumes that database choise would be Mongo. Another candidate was postgresql but Mongo got a win at this time. MongoDb at cloud could be MongoDb Atlas. This projet does not need complicated queries ad relations between tables jist few noSQL commands, otherwise SQL-bases postge could be better choice https://www.mongodb.com/atlas/database mongoose for mongodb would be the library which methods would be used. because of speed and costs, so musch data is time consuming wasting also the price for getting data everytime and processing it at sentinel-hub has a price, pretty expensive.","title":"Store the data"},{"location":"roskis/planning/#updating","text":"routes login and regitratios","title":"Updating"},{"location":"roskis/planning/#xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx_1","text":"22.03.2024 (source) Data (in json) format should be inserted into database including geometrias of different areas (fields, plants) agriculture AOI (Area Of Interest) mongoDb Schema instead of \"Go Live\" npx http-server . -p 8080 on build folder","title":"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"},{"location":"roskis/planning/#state-variable-handling","text":"when the app is growing will come a situation when redeux is more handy tha delvering variables as parameter/argument in a chain of elements REDUX or context should be worth of no need to deliver varibels element to element, probably chain...","title":"STATE variable handling"},{"location":"roskis/planning/#ui-comments","text":"bootstao grid system would be more clearer separate kuin kikkailla resonsive Ui is pretty challengint to achieve, took lot of time. Probably the most challenging part of designing. For this document I ghave picked up some the most important issues/topics Animated gif kun bargraph clikataan pylv\u00e4st\u00e4","title":"UI comments"},{"location":"roskis/planning/#nayta-kun-client-ottaa-yhteyden-niin-backendissa-dev-versiossa-morgan-nayttaa","text":"","title":"n\u00e4yt\u00e4 kun client ottaa yhteyden niin backendissa dev versiossa morgan n\u00e4ytt\u00e4\u00e4...."},{"location":"roskis/planning/#pwa","text":"The easiest way is use template when creating the app with \"npx create-react-app\" 1. using template npx create-react-app my-app --template cra-template-pwa in index.js serviceWorkerRegistration.register(); manifest.json LIGTHOUSE test in developers tools I am nit sure is there reason to use PWA with this appalication.","title":"PWA"},{"location":"roskis/planning/#sizing","text":"pienenn\u00e4 filmin kuvia to be notised that mobile portrait , pc viewport and fullscreen and PWA","title":"Sizing"},{"location":"roskis/planning/#mobile","text":"It woukd be better to define separate branch for mobile and pc so it would be easier to maintain ja implement further development. 21.03.2024 database selection between mongoDb and postgereSql. -> mongoDb was selected, reason the costs 22.03.2024 (source) Data (in json) format should be inserted into database including geometrias of different areas (fields, plants) agriculture AOI (Area Of Interest)","title":"Mobile"},{"location":"roskis/planning/#mongodb-schema","text":"wrapping the compoinent itself can not be modified just container around it forthe need","title":"mongoDb Schema"},{"location":"roskis/planning/#ui-design","text":"trying to do a dynamic to be suitable for different size of displays helping guidelines import \"./grid.css\"; className=\"grid-line\" .grid-line { border: 1px solid #ddd000; } MERMAID source: ./src/data/workareas.json target: mongoDb schema workarea.js ./src/mongo/models/workarea.js var mongoose = require(\"mongoose\"); var workareaSchema = new mongoose.Schema({ id: { type: String, required: true, unique: true, }, workareaid: { type: String, required: true, unique: true, }, name: { type: String, required: true, unique: false, }, backofficeid: { type: String, required: true, unique: false, }, geometry: { type: Object, required: true, unique: true, }, ndvi: { type: Boolean, default: false, } }); module.exports = new mongoose.model(\"Workarea\", workareaSchema);","title":"UI design"},{"location":"roskis/planning/#mongodbmdssa","text":"mongodb.js saveWorkArea","title":"mongodb.md:ss\u00e4!!!!"},{"location":"roskis/project/","text":"techiques use for the project Python: investigating the old system not working IPython for testing and learning sentinelkhub APi Sentinelhub API learning/sudiyng inveestigating Frontend: Backend: tools VS Code Jupyter Notebook Azure Data Studio Mermaid for diagrams","title":"Project"},{"location":"roskis/pwa/","text":"Kerro mit\u00e4 ja miksi serviceWorkerRegistration.register(); for this kind of app the pwa is not necessary approach, lighthosue of the developers tools not big effect performance speed on loading. etc. LIGHTHOUSE tests No good performance But compared empty created with create-react-app !!!!!!! voidan asentaa appiksi jotta ei tarvitse erillis\u00e4 linkkej\u00e4tai sy\u00e4tt\u00e4\u00e4 url JOSTAKINtarinaa Progressive Web Apps (PWAs) built with React offer several advantages, combining the benefits of traditional web applications with those of native mobile apps. Here are some key advantages: Enhanced Performance and Speed Fast Loading Times : PWAs load quickly, thanks to efficient caching and service workers. This ensures that users have a smooth experience, even on slow networks. Reduced Data Usage : By caching content, PWAs can reduce the amount of data needed to load subsequent pages, which is particularly beneficial for users with limited data plans. Improved User Engagement Offline Access : PWAs can work offline or with poor network connections, providing users access to content and functionalities even when they are not connected to the internet. Push Notifications : PWAs can send push notifications, keeping users engaged and informed about updates or new content. Add to Home Screen : Users can add PWAs to their home screen, providing an app-like experience without the need to download from an app store. Cost Efficiency Single Codebase : Developing a PWA with React means you maintain a single codebase for both web and mobile platforms, reducing development and maintenance costs. No App Store Fees : PWAs are distributed via the web, bypassing app store fees and the approval process, which can save time and money. Better SEO and Discoverability Indexed by Search Engines : Unlike native apps, PWAs are indexed by search engines, improving discoverability through traditional web searches. Linkability : PWAs use URLs, making it easy to share and link to specific content within the app. Enhanced User Experience Responsive Design : PWAs built with React can easily adapt to various screen sizes and orientations, providing a seamless experience across different devices. Native-like Experience : PWAs offer smooth animations and interactions, providing a user experience similar to native apps. Security HTTPS : PWAs are served via HTTPS, ensuring secure data transmission and protecting against man-in-the-middle attacks. Service Workers : Service workers can help improve security by controlling how network requests are handled, providing an additional layer of security. Regular Updates Background Updates : PWAs can update in the background without requiring user intervention, ensuring users always have the latest version without needing to download updates from an app store. Cross-platform Compatibility Multi-platform Reach : PWAs can run on any device with a modern web browser, including desktops, tablets, and smartphones, providing a broad reach without platform-specific development. By leveraging React to build a PWA, developers can create fast, engaging, and reliable web applications that offer a native-like experience while enjoying the benefits of web technologies.","title":"Pwa"},{"location":"roskis/pwa/#lighthouse-tests","text":"No good performance But compared empty created with create-react-app !!!!!!! voidan asentaa appiksi jotta ei tarvitse erillis\u00e4 linkkej\u00e4tai sy\u00e4tt\u00e4\u00e4 url JOSTAKINtarinaa Progressive Web Apps (PWAs) built with React offer several advantages, combining the benefits of traditional web applications with those of native mobile apps. Here are some key advantages:","title":"LIGHTHOUSE tests"},{"location":"roskis/pwa/#enhanced-performance-and-speed","text":"Fast Loading Times : PWAs load quickly, thanks to efficient caching and service workers. This ensures that users have a smooth experience, even on slow networks. Reduced Data Usage : By caching content, PWAs can reduce the amount of data needed to load subsequent pages, which is particularly beneficial for users with limited data plans.","title":"Enhanced Performance and Speed"},{"location":"roskis/pwa/#improved-user-engagement","text":"Offline Access : PWAs can work offline or with poor network connections, providing users access to content and functionalities even when they are not connected to the internet. Push Notifications : PWAs can send push notifications, keeping users engaged and informed about updates or new content. Add to Home Screen : Users can add PWAs to their home screen, providing an app-like experience without the need to download from an app store.","title":"Improved User Engagement"},{"location":"roskis/pwa/#cost-efficiency","text":"Single Codebase : Developing a PWA with React means you maintain a single codebase for both web and mobile platforms, reducing development and maintenance costs. No App Store Fees : PWAs are distributed via the web, bypassing app store fees and the approval process, which can save time and money.","title":"Cost Efficiency"},{"location":"roskis/pwa/#better-seo-and-discoverability","text":"Indexed by Search Engines : Unlike native apps, PWAs are indexed by search engines, improving discoverability through traditional web searches. Linkability : PWAs use URLs, making it easy to share and link to specific content within the app.","title":"Better SEO and Discoverability"},{"location":"roskis/pwa/#enhanced-user-experience","text":"Responsive Design : PWAs built with React can easily adapt to various screen sizes and orientations, providing a seamless experience across different devices. Native-like Experience : PWAs offer smooth animations and interactions, providing a user experience similar to native apps.","title":"Enhanced User Experience"},{"location":"roskis/pwa/#security","text":"HTTPS : PWAs are served via HTTPS, ensuring secure data transmission and protecting against man-in-the-middle attacks. Service Workers : Service workers can help improve security by controlling how network requests are handled, providing an additional layer of security.","title":"Security"},{"location":"roskis/pwa/#regular-updates","text":"Background Updates : PWAs can update in the background without requiring user intervention, ensuring users always have the latest version without needing to download updates from an app store.","title":"Regular Updates"},{"location":"roskis/pwa/#cross-platform-compatibility","text":"Multi-platform Reach : PWAs can run on any device with a modern web browser, including desktops, tablets, and smartphones, providing a broad reach without platform-specific development. By leveraging React to build a PWA, developers can create fast, engaging, and reliable web applications that offer a native-like experience while enjoying the benefits of web technologies.","title":"Cross-platform Compatibility"},{"location":"roskis/q%26a/","text":"","title":"Q&a"},{"location":"roskis/statistics/","text":"Tsekkaa Pentille l\u00e4hetetty dta-ana doku NDVI (Normalized Difference Vegetation Index) is a remote sensing technique used to assess and monitor vegetation health. It is calculated using the formula: where NIR is the near-infrared reflectance and Red is the red reflectance. Given your information: Minimum NDVI = 0.2 Maximum NDVI = 0.8 Mean NDVI = 0.6 Standard deviation is a measure of the amount of variation or dispersion in a set of values. It provides an indication of how spread out the values in a data set are around the mean. In the context of NDVI, a higher standard deviation indicates greater variability in vegetation health within the analyzed area. Without the specific values for the standard deviation, we can't provide a precise comparison. However, in a general sense: If the standard deviation is low (close to 0), it suggests that most NDVI values are close to the mean (0.6), indicating relatively uniform and consistent vegetation health. If the standard deviation is high, it suggests that NDVI values are more spread out from the mean, indicating a greater range of vegetation health within the area. This might signify areas with diverse vegetation conditions, including both healthy and stressed vegetation. Regarding \"pin numbers,\" it seems there might be a misunderstanding or additional context needed. If you are referring to specific data points or locations represented by \"pin numbers,\" the standard deviation can help you understand the variability in NDVI values across those points. Higher standard deviation values suggest more variability among the data points, while lower values suggest more consistency.\u00b5","title":"Statistics"},{"location":"roskis/testdata/","text":"test data is in json-format and it will be inserted to Mongodb database in cloud Atlas as well as the other data. t\u00e4h\u00e4n kuva mermaid ko. toimenpiteest\u00e4","title":"Testdata"},{"location":"roskis/testing/","text":"\u00c4Tm\u00e4 on normaaliti\u00f6a kun jokin geometria valitaan/aktovoidaan niin haetaan p\u00e4iv\u00e4m\u00e4rr\u00e4yt joille on ko. geometriasta NDVi dataa. kokiellaan samanaikaisia kutsuja list routeen, normaalisti route lukee tietokannasta tiedot ja jos tietokanta ei ole ajantasaalla p\u00e4ivit\u00e4\u00e4 sen mm. NDVi omages and statistisc data dates. update dates - select endDate earlier than the potential date which has nDVI-iamge with passed with specifig conditions because of nature of the server it should serve multiple concurrent requests We have to rtest how to handle manage this and which are vasteaika process time also depens of resource we have or ea are ready to pay. lets look after response time of the process where multiple concurrent field geometry sets do we must have/own two server one for update data and one for serve with/ NDVI-images from database when there is trafic for updating data from sentinelhub to database is there room enought to serve just request /query query is from database request is from server too many ewqueara HTTP status code 429 voisiko databaseen kirjoittaminenhidastaa sen verran ettei em. tapahdu?? kuormitustesti stressitesti 24.2.2024 2 x 30 peltosetti\u00e4 samaanaikaan lis\u00e4t\u00e4\u00e4n Mongo ja list-routen koodi MIK\u00c4 virheilmoitus ett\u00e4 resurssit sentinelhubilla loppu!!!! Should be tested concuretn clients request so can be seen resources needed.","title":"Testing"},{"location":"roskis/tools/","text":"Tools and xxx used for this project. ty\u00f6v\u00e4lineet vs code Jupyter Notebook for learning sentinelhub service Azure Data Studio for vscode + extensiosn Azure Data Studio Github Docker Desktop React Frontend Mermaid","title":"Tools"},{"location":"roskis/unofficial/","text":"voisi tulla 24/7 p\u00e4ivitys","title":"Unofficial"},{"location":"roskis/weather/","text":"Because of the plan which enable data just one year it has not been in this demo app saved to databse so to getting weather data coeect to openweathermap willbe appen every time without savinf results to database to get faster access to information. tsekkaa mobileharjoitus paikkakuntaine s\u00e4\u00e4n haku ja mm. oma mobile assignment sek\u00e4 eka MERN sek\u00e4 mit\u00e4 viimeksi teit l\u00e4mp\u00f6- ja sadesummat https://www.sirppi.fi/fi/?gad_source=1&gclid=Cj0KCQiA84CvBhCaARIsAMkAvkIF9GxC6Bc2pjISJB8zHSsa_H8nyPzmX3yqhQB0FCh5xu39IBTKUNIaAmTYEALw_wcB K\u00e4yt\u00e4 t\u00e4h\u00e4n current weather refresh??? import React, { useEffect } from \"react\"; import { useAxios } from \"axios-hooks\"; function App() { const [{ data, loading, error }, refetch] = useAxios(\"https://api.example.com/data\"); // Use useEffect to refetch data when specific conditions change useEffect(() => { // Example: Refetch data when a specific state variable changes if (/ some condition /) { refetch(); } }, [/ dependencies /]); if (loading) { return Loading... ; } if (error) { return Error fetching data: {error.message} ; } return ( Refetch Data {JSON.stringify(data, null, 2)} ); } export default App;","title":"Weather"},{"location":"routes/activate/","text":"TEKSTI ihan puppua t\u00e4h\u00e4n kohtaan Activate specifig aois to get NDVI-image and related statistics. This is just for updating database with multiple aois does not return any data for client, is triggered from the client. sama kuin list mutta array of geometries as parameter and process is different... is identical too list but technically implemented in the code some kind of parallel simplified, general and principled description not quite real does not return anything jsut success 200 statuscode Retrieves/returns a list of Sentinel-hub NDVI dates with statistics and updates the database if new data is available. lis\u00e4\u00e4 api.md:st\u00e4 usecases ja parametrit ja paluu arvot mutta frontend docu List the days with found images for the given geometry found in Sentinel Hub. Service should store the given geometry and the days in which the images can be found so that there would be no need to re-query the days (only newer days from the last query should be queried) every time from Sentinel Hub. If the image is available for given day then the service should assign unique id \"sentinelid\" for that day and image. Endpoint Url HTTP Method /ndvi/api/v1/activate POST Request Name Type Description geometry Array of geoJSON Array of geometries in geoJSON format, coordinate reference system WGS84 (EPSG:4326) start_date dateString (ISO 8601) The start date to include images from end_date dateString (ISO 8601) The end date to include images to Request body { \"geometry\": \"geoJSON\", \"start_date\": \"dateString\", \"end_date\": \"dateString\" } Response Name Type Description array All the days from which images can be queried generationtime dateString (ISO 8601) The date of the image sentinelid string generationtime and geometry converted to sha256-format, generated for the request to be used when fetching the image from database e.g. 2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba038cb86b647 sequenceDiagram Autonumber participant Client participant Server as Server: activate participant MongoDB participant SentinelHub activate Server Note left of Server: /ndvi/api/v1/activate Client->>Server: Request (array of geometries) loop for each geometry in array Server->>MongoDB: Query (geometry) MongoDB-->>Server: Data (geometry) alt Data found in MongoDB alt Current date is newer than last date in list for specific geometry (AOI) Server->>SentinelHub: Request new data (geometry) SentinelHub-->>Server: Response (New data) Server->>MongoDB: Store new data (geometry) Server->>MongoDB: Query (geometry) MongoDB-->>Server: Data (geometry) end Server-->>Client: Response (statuscode 200) Note right of Server: Data found in MongoDB for geometry else Data not found in MongoDB Server->>SentinelHub: Request (geometry) SentinelHub-->>Server: Response (Data not found in MongoDB) Server->>MongoDB: Store Data (geometry) Server->>MongoDB: Query (geometry) MongoDB-->>Server: Data (geometry) Server-->>Client: Response (statuscode 200) Note right of Server: Data not found in MongoDB for geometry end end deactivate Server","title":"activate"},{"location":"routes/activate/#teksti-ihan-puppua-tahan-kohtaan","text":"Activate specifig aois to get NDVI-image and related statistics. This is just for updating database with multiple aois does not return any data for client, is triggered from the client. sama kuin list mutta array of geometries as parameter and process is different... is identical too list but technically implemented in the code some kind of parallel simplified, general and principled description not quite real does not return anything jsut success 200 statuscode Retrieves/returns a list of Sentinel-hub NDVI dates with statistics and updates the database if new data is available. lis\u00e4\u00e4 api.md:st\u00e4 usecases ja parametrit ja paluu arvot mutta frontend docu List the days with found images for the given geometry found in Sentinel Hub. Service should store the given geometry and the days in which the images can be found so that there would be no need to re-query the days (only newer days from the last query should be queried) every time from Sentinel Hub. If the image is available for given day then the service should assign unique id \"sentinelid\" for that day and image. Endpoint Url HTTP Method /ndvi/api/v1/activate POST Request Name Type Description geometry Array of geoJSON Array of geometries in geoJSON format, coordinate reference system WGS84 (EPSG:4326) start_date dateString (ISO 8601) The start date to include images from end_date dateString (ISO 8601) The end date to include images to Request body { \"geometry\": \"geoJSON\", \"start_date\": \"dateString\", \"end_date\": \"dateString\" } Response Name Type Description array All the days from which images can be queried generationtime dateString (ISO 8601) The date of the image sentinelid string generationtime and geometry converted to sha256-format, generated for the request to be used when fetching the image from database e.g. 2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba038cb86b647 sequenceDiagram Autonumber participant Client participant Server as Server: activate participant MongoDB participant SentinelHub activate Server Note left of Server: /ndvi/api/v1/activate Client->>Server: Request (array of geometries) loop for each geometry in array Server->>MongoDB: Query (geometry) MongoDB-->>Server: Data (geometry) alt Data found in MongoDB alt Current date is newer than last date in list for specific geometry (AOI) Server->>SentinelHub: Request new data (geometry) SentinelHub-->>Server: Response (New data) Server->>MongoDB: Store new data (geometry) Server->>MongoDB: Query (geometry) MongoDB-->>Server: Data (geometry) end Server-->>Client: Response (statuscode 200) Note right of Server: Data found in MongoDB for geometry else Data not found in MongoDB Server->>SentinelHub: Request (geometry) SentinelHub-->>Server: Response (Data not found in MongoDB) Server->>MongoDB: Store Data (geometry) Server->>MongoDB: Query (geometry) MongoDB-->>Server: Data (geometry) Server-->>Client: Response (statuscode 200) Note right of Server: Data not found in MongoDB for geometry end end deactivate Server","title":"TEKSTI ihan puppua t\u00e4h\u00e4n kohtaan"},{"location":"routes/aios/","text":"Returns array of aios. controllers/ \u2502 \u2514\u2500\u2500 ndvi-controllers.js \u2502 \u2514\u2500\u2500 aois \u2514\u2500\u2500 routes/ \u2514\u2500\u2500 ndvi-routes.js const ndviControllers = require('../controllers/ndvi-controllers'); router.post('/aois', ndviControllers.aois); Endpoint Url HTTP Method /ndvi/api/v1/aois GET Request no params Response Responses arrray of json data Name Type Description id string unique identification workareaid string unique workarea identification name string name of aoi geometry geoJSON geometry of aoi in geoJSON format, coordinate reference system WGS84 (EPSG:4326) Sequence diagram sequenceDiagram Autonumber participant Client participant Server as Server: aois participant MongoDB activate Server Note left of Server: /ndvi/api/v1/aois Client->>Server: Request alt Array of Aois found in MongoDB Server->>MongoDB: Query Aois MongoDB-->>Server: Array of Aois Server-->>Client: Response (data) else Array of Aois not found in MongoDB Server-->>Client: Response (statuscode 404) end deactivate Server","title":"aios"},{"location":"routes/aiostomongo/","text":"AiosToMongo Stores area of interest specifig data from json-format to MongoDB database triggered by client. controllers/ \u2502 \u2514\u2500\u2500 dev-controllers.js \u2502 \u2514\u2500\u2500 aiosToMongo \u2514\u2500\u2500 routes/ \u2514\u2500\u2500 dev-routes.js const devControllers = require('../controllers/dev-controllers'); router.get('/aiostomongo', devControllers.aiosToMongo); Endpoint Url HTTP Method /ndvi/api/v1/aiostomongo GET Request No parameters. Response Statuscode 200 if successful, otherwise 404 failed plannin jutussa jotain lis\u00e4\u00e4 endpoint: .../ndvi/api/v1/workAreasToMongo TEE muista vastavaksi ei parametrea ja paluuravoa vain statuscode!!! sequenceDiagram autonumber participant Frontend participant Backend participant MongoDb activate Backend note left of Backend: /ndvi/api/v1/aiostomongo Frontend->>Backend: Request note right of Backend: require(\"../data/workareas.json\") alt All insertions successful loop through each workarea (index i) Backend->>MongoDb: Insert workarea data[i] MongoDb-->>Backend: Acknowledge insertion end Backend->>Frontend: Status 200 (successful) else Some insertion failed or something else got wrong Backend->>Frontend: Status 404 (failure) end deactivate Backend The error statuscode could be more specifig.","title":"aiostomongo"},{"location":"routes/api/","text":"Introduction RESTful interface for getting NDVI-images and related data from Sentinel Hub. list which days have images available for given geometry get images for given days and geometries NDVI service needs to be able to process requests for getting the dates with images for given geometries and for getting the images for given dates and geometries. Use Cases List List the days with found images and related statistical data for the given geometry found in Sentinel Hub. Service should store the given geometry and the days in which the images can be found so that there would be no need to re-query the days (only newer days from the last query should be queried) every time from Sentinel Hub. If the image is available for given day then the service should assign unique id \"sentinelid\" for that day and image. Endpoint Url HTTP Method /ndvi/api/v1/list POST Request parameters Name Type Description geometry geoJSON Geometry in geoJSON format, coordinate reference system WGS84 (EPSG:4326) start_date dateString (ISO 8601) The start date to include images from end_date dateString (ISO 8601) The end date to include images to Request body { \"geometry\": \"geoJSON\", \"start_date\": \"dateString\", \"end_date\": \"dateString\" } Response Name Type Description array All the days from which images can be queried generationtime dateString (ISO 8601) The date of the image sentinelid string generationtime and geometry converted to sha256-format, generated for the request to be used when fetching the image from database e.g. 2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba038cb86b647 ** graphia/cahrtia varten lis\u00e4tty sttistiikkaa ** [ { \"generationtime\": \"2023-05-15T00:00:00Z\", \"sentinelid\": \"2023-05-15T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba...\" }, { \"generationtime\": \"2023-05-30T00:00:00Z\", \"sentinelid\": \"2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba...\" }, // ... ] Sequence diagram olisko NDVi server, ja list muuta muuksi esim. dates tai statsistics !!!! sequenceDiagram autonumber Client->>+NDVI: POST /ndvi/api/v1/dateslist {params} alt data is invalid NDVI->>Client: 422 Unprocessable Entity else NDVI->>Client: return list of dates end NDVI-->>-Client: 200 OK HTTP POST /ndvi/api/v1/dateslist, { \"geometry\": \"geoJSON\", \"start_date\": \"dateString\", \"end_date\": \"dateString\" } Status code 422 will be returned if there is not data for to return for specifig parameters. !!!!!!!! HUOMIOI my\u00f6s stardard deviation tarkoitta sit\u00e4 ett\u00e4 l\u00e4mp\u00e4n\u00e4 0:aa arvot ovat l\u00e4hell\u00e4 toisaan eli tasaista (voitaneen huomata NDVI-kuvasta) HUOMIO my\u00f6s min, max, mean arvot v\u00e4litet\u00e4\u00e4n graafia varten POISTA t\u00e4st\u00e4 dokusta Teemun jutut ehk\u00e4 turhia toisaalta Image Returns the NDVI image for the given sentinelid. Endpoint Url HTTP Method /ndvi/api/v1/image/ GET Request Name Type Description sentinelid string id for image (generated when image with related data fetched from sentinelhub and saved into database) epsg integer optional, used when related coordinates need to be in system EPSG:3067 Response Name Type Description average float Average value of the NDVI max float Maximum value of the NDVI min float Minimum value of the NDVI std float Standard deviation value of the NDVI image Image of the NDVI image.minX float Bounding rect minimum X value, coordinate reference system WGS84 (EPSG:4326) image.minY float Bounding rect minimum Y value, coordinate reference system WGS84 (EPSG:4326) image.maxX float Bounding rect maximum X value, coordinate reference system WGS84 (EPSG:4326) image.maxY float Bounding rect maximum Y value, coordinate reference system WGS84 (EPSG:4326) image.dataUrl Base&4 string Image in Base64 string format (i.e., data:image/png;base64...) scale array Array for NDVI value categories as colours scale.color string Colour as RGB string value scale.amount integer scale.from float Response datatypes { \"average\": \"float\", \"max\": \"float\", \"min\": \"float\", \"image\": { \"minX\": \"float\", \"minY\": \"float\", \"maxX\": \"float\", \"maxY\": \"float\", \"dataUrl\": \"Base64 string\" }, \"scale\": [ { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" } ] } Example LIS\u00c4\u00c4 STD { \"average\": 0.5657129907618343, \"max\": 0.75, \"min\": 0.15, \"image\": { \"minX\": 26.1930913, \"minY\": 62.9857763, \"maxX\": 26.194766, \"maxY\": 62.9867615 \"dataUrl\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABuCAYAAACnQwS5AAADnEl...\" }, \"scale\": [ { \"color\": \"rgb(244, 67, 54)\", \"amount\": 0, \"from\": 0.15 }, { \"color\": \"rgb(255, 152, 0)\", \"amount\": 0, \"from\": 0.3 }, { \"color\": \"rgb(255, 235, 59)\", \"amount\": 22, \"from\": 0.45 }, { \"color\": \"rgb(76, 175, 80)\", \"amount\": 78, \"from\": 0.6 } ] } Sequence diagram sequenceDiagram Client->>+NDVI: image alt no image available for sentinelid NDVI->>Client: 404 Not found else NDVI->>-Client: 200 OK end MARK:notice::: in case of 404 there is sometring error situation on front end or database is corrupted. Will happen very rarely or never but in testinf/developing situations. Activate esimerkki lis\u00e4\u00e4 jokin peltosetti, at the beginnig there no data at all for a specifig time range, so all the data have to be prosessed and fetched/requested from sentinelhub When activate with AOIs so it will be known later which geometries NDI data need to be updated data form upcoming dates 24h cron ja t\u00e4m\u00e4 vain kasvukauden aikana p\u00e4iivtt\u00e4\u00e4 koko kantaa ja peltosetit ovat sopiva m\u00e4\u00e4r\u00e4 kerrall muuten tulee mahd. sanomista too many requests TESTATTAVA useaa samaiakaista toimeksiantoa RiSKI jos resurssit eiv\u00e4t riit\u00e4 erillinen kappale SWOT tai j\u00e4rkev\u00e4mpi ottaa geometriat taleteen ja aja ne Status of activation If tou have large set of fields it will take more time for totally new data time period range Dev Demo kannan testaukseen ja yll\u00e4pitoon erillinen route voidaan helposti ottaa mukaan t\u00e4st\u00e4h\u00e4n on esimerkki t\u00e4m\u00e4 on Mongo joka tapauksessa, json-tiedosto, jossa geometriat -> mongoon CRUD tosin t\u00e4ss\u00e4 tapauksessa ei ole Updatea PUT UPDATE MUTTA UPDATE tai PUT on kun User authetication tulisiko peltotilkutkin listana!!!!","title":"Introduction"},{"location":"routes/api/#introduction","text":"RESTful interface for getting NDVI-images and related data from Sentinel Hub. list which days have images available for given geometry get images for given days and geometries NDVI service needs to be able to process requests for getting the dates with images for given geometries and for getting the images for given dates and geometries.","title":"Introduction"},{"location":"routes/api/#use-cases","text":"","title":"Use Cases"},{"location":"routes/api/#list","text":"List the days with found images and related statistical data for the given geometry found in Sentinel Hub. Service should store the given geometry and the days in which the images can be found so that there would be no need to re-query the days (only newer days from the last query should be queried) every time from Sentinel Hub. If the image is available for given day then the service should assign unique id \"sentinelid\" for that day and image. Endpoint Url HTTP Method /ndvi/api/v1/list POST Request parameters Name Type Description geometry geoJSON Geometry in geoJSON format, coordinate reference system WGS84 (EPSG:4326) start_date dateString (ISO 8601) The start date to include images from end_date dateString (ISO 8601) The end date to include images to Request body { \"geometry\": \"geoJSON\", \"start_date\": \"dateString\", \"end_date\": \"dateString\" } Response Name Type Description array All the days from which images can be queried generationtime dateString (ISO 8601) The date of the image sentinelid string generationtime and geometry converted to sha256-format, generated for the request to be used when fetching the image from database e.g. 2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba038cb86b647 ** graphia/cahrtia varten lis\u00e4tty sttistiikkaa ** [ { \"generationtime\": \"2023-05-15T00:00:00Z\", \"sentinelid\": \"2023-05-15T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba...\" }, { \"generationtime\": \"2023-05-30T00:00:00Z\", \"sentinelid\": \"2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba...\" }, // ... ] Sequence diagram olisko NDVi server, ja list muuta muuksi esim. dates tai statsistics !!!! sequenceDiagram autonumber Client->>+NDVI: POST /ndvi/api/v1/dateslist {params} alt data is invalid NDVI->>Client: 422 Unprocessable Entity else NDVI->>Client: return list of dates end NDVI-->>-Client: 200 OK HTTP POST /ndvi/api/v1/dateslist, { \"geometry\": \"geoJSON\", \"start_date\": \"dateString\", \"end_date\": \"dateString\" } Status code 422 will be returned if there is not data for to return for specifig parameters. !!!!!!!!","title":"List"},{"location":"routes/api/#huomioi-myos-stardard-deviation-tarkoitta-sita-etta-lampana-0aa-arvot-ovat-lahella-toisaan-eli-tasaista-voitaneen-huomata-ndvi-kuvasta","text":"HUOMIO my\u00f6s min, max, mean arvot v\u00e4litet\u00e4\u00e4n graafia varten POISTA t\u00e4st\u00e4 dokusta Teemun jutut ehk\u00e4 turhia toisaalta","title":"HUOMIOI my\u00f6s stardard deviation tarkoitta sit\u00e4 ett\u00e4 l\u00e4mp\u00e4n\u00e4 0:aa arvot ovat l\u00e4hell\u00e4 toisaan eli tasaista (voitaneen huomata NDVI-kuvasta)"},{"location":"routes/api/#image","text":"Returns the NDVI image for the given sentinelid. Endpoint Url HTTP Method /ndvi/api/v1/image/ GET Request Name Type Description sentinelid string id for image (generated when image with related data fetched from sentinelhub and saved into database) epsg integer optional, used when related coordinates need to be in system EPSG:3067 Response Name Type Description average float Average value of the NDVI max float Maximum value of the NDVI min float Minimum value of the NDVI std float Standard deviation value of the NDVI image Image of the NDVI image.minX float Bounding rect minimum X value, coordinate reference system WGS84 (EPSG:4326) image.minY float Bounding rect minimum Y value, coordinate reference system WGS84 (EPSG:4326) image.maxX float Bounding rect maximum X value, coordinate reference system WGS84 (EPSG:4326) image.maxY float Bounding rect maximum Y value, coordinate reference system WGS84 (EPSG:4326) image.dataUrl Base&4 string Image in Base64 string format (i.e., data:image/png;base64...) scale array Array for NDVI value categories as colours scale.color string Colour as RGB string value scale.amount integer scale.from float Response datatypes { \"average\": \"float\", \"max\": \"float\", \"min\": \"float\", \"image\": { \"minX\": \"float\", \"minY\": \"float\", \"maxX\": \"float\", \"maxY\": \"float\", \"dataUrl\": \"Base64 string\" }, \"scale\": [ { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" } ] } Example LIS\u00c4\u00c4 STD { \"average\": 0.5657129907618343, \"max\": 0.75, \"min\": 0.15, \"image\": { \"minX\": 26.1930913, \"minY\": 62.9857763, \"maxX\": 26.194766, \"maxY\": 62.9867615 \"dataUrl\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABuCAYAAACnQwS5AAADnEl...\" }, \"scale\": [ { \"color\": \"rgb(244, 67, 54)\", \"amount\": 0, \"from\": 0.15 }, { \"color\": \"rgb(255, 152, 0)\", \"amount\": 0, \"from\": 0.3 }, { \"color\": \"rgb(255, 235, 59)\", \"amount\": 22, \"from\": 0.45 }, { \"color\": \"rgb(76, 175, 80)\", \"amount\": 78, \"from\": 0.6 } ] } Sequence diagram sequenceDiagram Client->>+NDVI: image alt no image available for sentinelid NDVI->>Client: 404 Not found else NDVI->>-Client: 200 OK end MARK:notice::: in case of 404 there is sometring error situation on front end or database is corrupted. Will happen very rarely or never but in testinf/developing situations.","title":"Image"},{"location":"routes/api/#activate","text":"esimerkki lis\u00e4\u00e4 jokin peltosetti, at the beginnig there no data at all for a specifig time range, so all the data have to be prosessed and fetched/requested from sentinelhub When activate with AOIs so it will be known later which geometries NDI data need to be updated data form upcoming dates 24h cron ja t\u00e4m\u00e4 vain kasvukauden aikana p\u00e4iivtt\u00e4\u00e4 koko kantaa ja peltosetit ovat sopiva m\u00e4\u00e4r\u00e4 kerrall muuten tulee mahd. sanomista too many requests TESTATTAVA useaa samaiakaista toimeksiantoa RiSKI jos resurssit eiv\u00e4t riit\u00e4 erillinen kappale SWOT tai j\u00e4rkev\u00e4mpi ottaa geometriat taleteen ja aja ne","title":"Activate"},{"location":"routes/api/#status-of-activation","text":"If tou have large set of fields it will take more time for totally new data time period range","title":"Status of activation"},{"location":"routes/api/#dev","text":"Demo kannan testaukseen ja yll\u00e4pitoon erillinen route voidaan helposti ottaa mukaan t\u00e4st\u00e4h\u00e4n on esimerkki t\u00e4m\u00e4 on Mongo joka tapauksessa, json-tiedosto, jossa geometriat -> mongoon CRUD tosin t\u00e4ss\u00e4 tapauksessa ei ole Updatea PUT UPDATE MUTTA UPDATE tai PUT on kun","title":"Dev"},{"location":"routes/api/#user","text":"","title":"User"},{"location":"routes/image/","text":"Image Returns the NDVI image with statictics for the given sentinelid. controllers/ \u2502 \u2514\u2500\u2500 ndvi-controllers.js \u2502 \u2514\u2500\u2500 image \u2514\u2500\u2500 routes/ \u2514\u2500\u2500 ndvi-routes.js const ndviControllers = require('../controllers/ndvi-controllers'); router.get('/image/:sentinelid', ndviControllers.image); Endpoint Url HTTP Method /ndvi/api/v1/image GET Request Name Type Description sentinelid string id for image (generated when image with related data fetched from sentinelhub and saved into database) epsg integer optional, used when related coordinates need to be in system EPSG:3067 Response Name Type Description average float Average value of the NDVI max float Maximum value of the NDVI min float Minimum value of the NDVI std float Standard deviation value of the NDVI image Image of the NDVI image.minX float Bounding rect minimum X value, coordinate reference system WGS84 (EPSG:4326) image.minY float Bounding rect minimum Y value, coordinate reference system WGS84 (EPSG:4326) image.maxX float Bounding rect maximum X value, coordinate reference system WGS84 (EPSG:4326) image.maxY float Bounding rect maximum Y value, coordinate reference system WGS84 (EPSG:4326) image.dataUrl Base&4 string Image in Base64 string format (i.e., data:image/png;base64...) scale array Array for NDVI value categories as colours scale.color string Colour as RGB string value scale.amount integer scale.from float Response datatypes { \"average\": \"float\", \"max\": \"float\", \"min\": \"float\", \"std\": \"float\", \"image\": { \"minX\": \"float\", \"minY\": \"float\", \"maxX\": \"float\", \"maxY\": \"float\", \"dataUrl\": \"Base64 string\" }, \"scale\": [ { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" } ] } Example { \"average\": 0.5657129907618343, \"max\": 0.75, \"min\": 0.15, \"std\": 0.90 \"image\": { \"minX\": 26.1930913, \"minY\": 62.9857763, \"maxX\": 26.194766, \"maxY\": 62.9867615 \"dataUrl\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABuCAYAAACnQwS5AAADnEl...\" }, \"scale\": [ { \"color\": \"rgb(244, 67, 54)\", \"amount\": 0, \"from\": 0.15 }, { \"color\": \"rgb(255, 152, 0)\", \"amount\": 0, \"from\": 0.3 }, { \"color\": \"rgb(255, 235, 59)\", \"amount\": 22, \"from\": 0.45 }, { \"color\": \"rgb(76, 175, 80)\", \"amount\": 78, \"from\": 0.6 } ] } KAAVIOSTA puuttuu token in header pit\u00e4isk\u00e4 vaan manita Request(token in header) kuten frontin dokussa pit\u00e4is olla oikeastaan vuokaavio ti structure tms. josskain mongodb.js-> image ehk\u00e4 mongodb kappaleeseen Sequence diagram sequenceDiagram Autonumber participant Client participant Server as Server: image participant MongoDB activate Server Note left of Server: /ndvi/api/v1/image Client->>Server: Request (token in header) alt Image data found in MongoDB Server->>MongoDB: Query for image data MongoDB-->>Server: Image data Server-->>Client: Response (Image data) else Image data not found in MongoDB Server-->>Client: Response (statuscode 404) end deactivate Server sequenceDiagram Client->>+NDVI: image alt no image available for sentinelid NDVI->>Client: 404 Not found else NDVI->>-Client: 200 OK end MARK:notice::: in case of 404 there is sometring error situation on front end or database is corrupted. Will happen very rarely or never but in testinf/developing situations.","title":"image"},{"location":"routes/image/#image","text":"Returns the NDVI image with statictics for the given sentinelid. controllers/ \u2502 \u2514\u2500\u2500 ndvi-controllers.js \u2502 \u2514\u2500\u2500 image \u2514\u2500\u2500 routes/ \u2514\u2500\u2500 ndvi-routes.js const ndviControllers = require('../controllers/ndvi-controllers'); router.get('/image/:sentinelid', ndviControllers.image); Endpoint Url HTTP Method /ndvi/api/v1/image GET Request Name Type Description sentinelid string id for image (generated when image with related data fetched from sentinelhub and saved into database) epsg integer optional, used when related coordinates need to be in system EPSG:3067 Response Name Type Description average float Average value of the NDVI max float Maximum value of the NDVI min float Minimum value of the NDVI std float Standard deviation value of the NDVI image Image of the NDVI image.minX float Bounding rect minimum X value, coordinate reference system WGS84 (EPSG:4326) image.minY float Bounding rect minimum Y value, coordinate reference system WGS84 (EPSG:4326) image.maxX float Bounding rect maximum X value, coordinate reference system WGS84 (EPSG:4326) image.maxY float Bounding rect maximum Y value, coordinate reference system WGS84 (EPSG:4326) image.dataUrl Base&4 string Image in Base64 string format (i.e., data:image/png;base64...) scale array Array for NDVI value categories as colours scale.color string Colour as RGB string value scale.amount integer scale.from float Response datatypes { \"average\": \"float\", \"max\": \"float\", \"min\": \"float\", \"std\": \"float\", \"image\": { \"minX\": \"float\", \"minY\": \"float\", \"maxX\": \"float\", \"maxY\": \"float\", \"dataUrl\": \"Base64 string\" }, \"scale\": [ { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" } ] } Example { \"average\": 0.5657129907618343, \"max\": 0.75, \"min\": 0.15, \"std\": 0.90 \"image\": { \"minX\": 26.1930913, \"minY\": 62.9857763, \"maxX\": 26.194766, \"maxY\": 62.9867615 \"dataUrl\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABuCAYAAACnQwS5AAADnEl...\" }, \"scale\": [ { \"color\": \"rgb(244, 67, 54)\", \"amount\": 0, \"from\": 0.15 }, { \"color\": \"rgb(255, 152, 0)\", \"amount\": 0, \"from\": 0.3 }, { \"color\": \"rgb(255, 235, 59)\", \"amount\": 22, \"from\": 0.45 }, { \"color\": \"rgb(76, 175, 80)\", \"amount\": 78, \"from\": 0.6 } ] }","title":"Image"},{"location":"routes/image/#kaaviosta-puuttuu-token-in-header-pitaiska-vaan-manita-requesttoken-in-header-kuten-frontin-dokussa","text":"","title":"KAAVIOSTA puuttuu token in header pit\u00e4isk\u00e4 vaan manita Request(token in header) kuten frontin dokussa"},{"location":"routes/image/#pitais-olla-oikeastaan-vuokaavio-ti-structure-tms-josskain-mongodbjs-image-ehka-mongodb-kappaleeseen","text":"Sequence diagram sequenceDiagram Autonumber participant Client participant Server as Server: image participant MongoDB activate Server Note left of Server: /ndvi/api/v1/image Client->>Server: Request (token in header) alt Image data found in MongoDB Server->>MongoDB: Query for image data MongoDB-->>Server: Image data Server-->>Client: Response (Image data) else Image data not found in MongoDB Server-->>Client: Response (statuscode 404) end deactivate Server sequenceDiagram Client->>+NDVI: image alt no image available for sentinelid NDVI->>Client: 404 Not found else NDVI->>-Client: 200 OK end MARK:notice::: in case of 404 there is sometring error situation on front end or database is corrupted. Will happen very rarely or never but in testinf/developing situations.","title":"pit\u00e4is olla oikeastaan vuokaavio ti structure tms. josskain mongodb.js-&gt; image ehk\u00e4 mongodb kappaleeseen"},{"location":"routes/list/","text":"list NEEDs token use this endpoint/route Retrieves/returns a list of Sentinel-hub NDVI dates with statistics and updates the database if new data is available. lis\u00e4\u00e4 api.md:st\u00e4 usecases ja parametrit ja paluu arvot mutta frontend docu List the days with found images for the given geometry found in Sentinel Hub. Service should store the given geometry and the days in which the images can be found so that there would be no need to re-query the days (only newer days from the last query should be queried) every time from Sentinel Hub. If the image is available for given day then the service should assign unique id \"sentinelid\" for that day and image. Endpoint Url HTTP Method /ndvi/api/v1/list POST Request Name Type Description geometry geoJSON Geometry in geoJSON format, coordinate reference system WGS84 (EPSG:4326) start_date dateString (ISO 8601) The start date to include images from end_date dateString (ISO 8601) The end date to include images to Request body { \"geometry\": \"geoJSON\", \"start_date\": \"dateString\", \"end_date\": \"dateString\" } Response Name Type Description array All the days from which images can be queried generationtime dateString (ISO 8601) The date of the image sentinelid string generationtime and geometry converted to sha256-format, generated for the request to be used when fetching the image from database e.g. 2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba038cb86b647 [ { \"generationtime\": \"2023-05-15T00:00:00Z\", \"sentinelid\": \"2023-05-15T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba...\" }, { \"generationtime\": \"2023-05-30T00:00:00Z\", \"sentinelid\": \"2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba...\" }, ... ] Sequence diagram sequenceDiagram Autonumber participant Client participant Server as Server: list participant MongoDB participant SentinelHub activate Server Note left of Server: /ndvi/api/v1/list Client->>Server: Request (token in header) Server->>MongoDB: Query MongoDB-->>Server: Data alt Data found in MongoDB alt Current date is newer than last date in list for specific geometry (AOI) Server->>SentinelHub: Request new data SentinelHub-->>Server: Response (New data) Server->>MongoDB: Store new data Server->>MongoDB: Query MongoDB-->>Server: Data end Server-->>Client: Response Note right of Server: Data found in MongoDB else Data not found in MongoDB Server->>SentinelHub: Request SentinelHub-->>Server: Response (Data not found in MongoDB) Server->>MongoDB: Store Data Server->>MongoDB: Query MongoDB-->>Server: Data Server-->>Client: Response Note right of Server: Data not found in MongoDB end deactivate Server Pit\u00e4isk\u00f6 muuttaa mondoB dataBaseksi??? 1. /ndvi/api/v1/list if new data (statistics) is available it will be stored into the database. Also NDVI-imagedata related to all new dates will be request from SentinelHub Sequence diagram sequenceDiagram Autonumber participant Server as Server: list participant SentinelHub participant MongoDB Server->>SentinelHub: Request new data SentinelHub-->>Server: Response (New data) Server->>MongoDB: Store new data loop Request image data Server->>SentinelHub: Request image data (for each new data item) SentinelHub-->>Server: Response (image data) Server->>MongoDB: Store image data with statistics end tulleeko johonkin varsinaiset kutsut sentinelhubiin (senetinelhubista oma kappale) api.md samallahan kun haetaan statistics ja sen perusteella haetaan NDVI-iamges ja tallennetaan kantaan. Jos kannata l\u00e4ytyy niin tsekataan jos l\u00f6ytyy uudempaa dataa sen j\u00e4lkeen kuin viimeksi talllennettiin dataa.","title":"list"},{"location":"routes/list/#list","text":"","title":"list"},{"location":"routes/list/#needs-token-use-this-endpointroute","text":"Retrieves/returns a list of Sentinel-hub NDVI dates with statistics and updates the database if new data is available. lis\u00e4\u00e4 api.md:st\u00e4 usecases ja parametrit ja paluu arvot mutta frontend docu List the days with found images for the given geometry found in Sentinel Hub. Service should store the given geometry and the days in which the images can be found so that there would be no need to re-query the days (only newer days from the last query should be queried) every time from Sentinel Hub. If the image is available for given day then the service should assign unique id \"sentinelid\" for that day and image. Endpoint Url HTTP Method /ndvi/api/v1/list POST Request Name Type Description geometry geoJSON Geometry in geoJSON format, coordinate reference system WGS84 (EPSG:4326) start_date dateString (ISO 8601) The start date to include images from end_date dateString (ISO 8601) The end date to include images to Request body { \"geometry\": \"geoJSON\", \"start_date\": \"dateString\", \"end_date\": \"dateString\" } Response Name Type Description array All the days from which images can be queried generationtime dateString (ISO 8601) The date of the image sentinelid string generationtime and geometry converted to sha256-format, generated for the request to be used when fetching the image from database e.g. 2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba038cb86b647 [ { \"generationtime\": \"2023-05-15T00:00:00Z\", \"sentinelid\": \"2023-05-15T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba...\" }, { \"generationtime\": \"2023-05-30T00:00:00Z\", \"sentinelid\": \"2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba...\" }, ... ] Sequence diagram sequenceDiagram Autonumber participant Client participant Server as Server: list participant MongoDB participant SentinelHub activate Server Note left of Server: /ndvi/api/v1/list Client->>Server: Request (token in header) Server->>MongoDB: Query MongoDB-->>Server: Data alt Data found in MongoDB alt Current date is newer than last date in list for specific geometry (AOI) Server->>SentinelHub: Request new data SentinelHub-->>Server: Response (New data) Server->>MongoDB: Store new data Server->>MongoDB: Query MongoDB-->>Server: Data end Server-->>Client: Response Note right of Server: Data found in MongoDB else Data not found in MongoDB Server->>SentinelHub: Request SentinelHub-->>Server: Response (Data not found in MongoDB) Server->>MongoDB: Store Data Server->>MongoDB: Query MongoDB-->>Server: Data Server-->>Client: Response Note right of Server: Data not found in MongoDB end deactivate Server Pit\u00e4isk\u00f6 muuttaa mondoB dataBaseksi??? 1. /ndvi/api/v1/list if new data (statistics) is available it will be stored into the database. Also NDVI-imagedata related to all new dates will be request from SentinelHub Sequence diagram sequenceDiagram Autonumber participant Server as Server: list participant SentinelHub participant MongoDB Server->>SentinelHub: Request new data SentinelHub-->>Server: Response (New data) Server->>MongoDB: Store new data loop Request image data Server->>SentinelHub: Request image data (for each new data item) SentinelHub-->>Server: Response (image data) Server->>MongoDB: Store image data with statistics end","title":"NEEDs token use this endpoint/route"},{"location":"routes/list/#tulleeko-johonkin-varsinaiset-kutsut-sentinelhubiin-senetinelhubista-oma-kappale","text":"api.md samallahan kun haetaan statistics ja sen perusteella haetaan NDVI-iamges ja tallennetaan kantaan. Jos kannata l\u00e4ytyy niin tsekataan jos l\u00f6ytyy uudempaa dataa sen j\u00e4lkeen kuin viimeksi talllennettiin dataa.","title":"tulleeko johonkin varsinaiset kutsut sentinelhubiin (senetinelhubista oma kappale)"},{"location":"routes/ndvi_controller_js/","text":"HUOMIOI frontille tehdyt kaaviotyhteydeotosta requests!!!!!!! speed up need more testing and developing will be pretty challenging and complicated speed depends of AOI size, resources asure we ans sentinel and load of the sentinelhub depend time when the traffic... updates when aktivating AOI in frontend backend will ask references for images data just for related AOI, first in database if there is not data it will be request from sentinelHub service and saved into database ans retuned to frontend also if data is found in database it databse will be updated up to date so the newest data will be added if any. depending the last use in thois case client may need to wait for a while for updating, but it need to be do once. p\u00e4ivityst\u00e4 ei tehd\u00e4 jos ei olla growinseasonilla eli talviaika joten lataaminen suoraan kannasta ilman statiikan tarkistusta erpceif period backend will automativally will make database up to date. growindseaaon!!!!!!!!! t\u00e4m\u00e4 ehdokis ettei p\u00e4ivityst\u00e4 tsekata jos ollaan offsesonilla!!! need to pe considered using the server plans and updates from sentinel if new customer. this controleler is the only one which is connected to sentinelhub so code related to connection is placed/located here. starting at authentication to sentinelHub auth method is outside of the routes because two of them use the same code. when just one geometry axios.post for statistics and axios.all for images when multiple geometries (an array) axios.all for statistics images will be request just axios.get or should develop part of... there is limit exceeded.... routes/endpoints jokin swagger tai muuntapainen jossa mainittu post tai get DATA testing and demo data is json format having geojson data about 2000 aoi fields data is inserted via this backend server to mongodb atlas database. NDVI data ofr every aoi is requested from sentinel from 3 years as an demo purpose. activate (muuta nimi) vain uusia datasettej\u00e4 varten jos ajetaan uudelleen samoja geometrioita vanhat tuhotaan list LIS\u00c4\u00c4 std min max mean lis\u00e4ksi!!!! parameters endTime: normally the currentDate on growinng season dates collection must be sorted ordered with generationTime beause of axios.all palauttaa dataa \"satunnaisessa j\u00e4rjestksee\u00e4\" ei siis j\u00e4rjestyksess\u00e4 jotka asetetaan parametriksi, joka yhistet\u00e4\u00e4n sentinelhub statistics dataan sis\u00e4lt\u00e4en p\u00e4iv\u00e4m\u00e4\u00e4r\u00e4t. olisiko ndvi_controller jokin postgreelle vai kuinka valitaan kumpaa k\u00e4ytet\u00e4\u00e4n k\u00e4yt\u00e4 samannimis\u00e4 meodeja saman nimisi\u00e4 parametreja routes: activate takes an array of geometries time rannge starttime, endtime beacuse of posible lot of geometries to handle for NDVI data ould take tiem depends on amount of geometries and size of areas it could be need for update token, now it is handle by middleware but in this case method for token should be called for a while, await req.checkToken(); too many request in sentinel hub should be avoided HTTP status 429 https://docs.sentinel-hub.com/api/latest/api/overview/rate-limiting/ voisiko kantaan kirjoittaminen tuoda tarvittavan/riitt\u00e4vn viiveen jotta em. v\u00e4ltyytt\u00e4isiin. activate jos sa,alla geometrialla uuudestaan niin deleteoidaan edelline dates sill\u00e4 aikaj\u00e4nne voi oilla ihan eri ja ei siten p\u00e4ivityajatusta p\u00e4ivitys thd\u00e4\u00e4n list reouteen tai updagte???? ----------------------------------------------------------------------- const axios = require(\"axios\"); const hash = require(\"../utils/hash\"); const geoUtils = require(\"../utils/geoUtils\"); const statistics = require(\"../sentinelhub/getStatistics\"); const imageRef = require(\"../sentinelhub/getImage\"); const imageDataRef = require(\"../utils/image/getImageData\"); const dateTime = require(\"../utils/dateTime\"); var get_bounding_box = require(\"@turf/bbox\").default; const mongodb = require(\"../mongo/mongodb\"); const scheduleUpdateDb = require(\"../utils/scheduleUpdateDb\"); const growingSeason = require(\"../settings/growingSeason.json\"); const isDateInGrowingSeason = require(\"../utils/isdateingrowingseason\"); / * Updates the database with the latest data. * @returns {Promise } - True if the update was successful. / const updateDb = async () => { scheduleUpdateDb.stop(); console.log(\"Updating data * * * * * * * * * * **** \"); let data = await mongodb.getAllDateSets(); if (data && data.length > 0) { console.log(data.length, \" --> [0] \", data[0].id); let endDate = new Date(); await getDates(false, data[0].geometry, null, endDate); } return true; }; /* * Starts the database update schedule. * @returns {Promise } / const startScheduleUpdateDb = async () => { await updateDb(); }; /* * Retrieves Sentinel data for the specified date range and geometry. * @param {Object} geometry - The geometry object. * @param {Date} fromTime - The start date. * @param {Date} toTime - The end date. * @returns {Promise } - The list of dates and corresponding statistics. / const getSentinelDates = async (geometry, fromTime, toTime) => { let data = []; let stats = await statistics.getStatistics(geometry, fromTime, toTime); if (stats.length > 0) { stats.reverse(); for (let stat of stats) { let statRef = stat.outputs.data.bands.B0.stats; let mean = statRef.mean; if (mean >= 0.1) { data = [ ...data, { generationtime: stat.interval.from, stats: { average: statRef.mean, max: statRef.max, min: statRef.min, std: statRef.stDev, }, sentinelid: stat.interval.from + \"_\" + hash.sha256(geometry), }, ]; } } } else { console.log(\"No data for the geometry **********************************************************************\", fromTime, \" - \", toTime); } return data; }; /* * Retrieves image data along with its metadata. * @param {Object} item - The item object containing generation time and statistics. * @param {Object} geometry - The geometry object. * @returns {Promise } - The image data or null if the image is not found. / const getImageWithData = async (item, geometry) => { let image = await imageRef.getImage(item.generationtime, geometry); if (image) { let data = await imageDataRef.getImageData(geometry, image, { id: item.sentinelid, average: item.stats.average, max: item.stats.max, min: item.stats.min, std: item.stats.std, }); return data; } else { return null; } }; /* * Saves Sentinel data to MongoDB. * @param {boolean} save - Whether to save the data. * @param {Object} geometry - The geometry object. * @param {Date} fromTime - The start date. * @param {Date} toTime - The end date. * @returns {Promise } - True if the data was saved successfully, otherwise false. / const saveSentinelDataToMongo = async (save, geometry, fromTime, toTime) => { let id = hash.sha256(geometry); const area = geoUtils.getAreaFromGeometry(geometry); let savedDates = []; let res = null; try { if (save) { res = await mongodb.saveDates(id, savedDates, geometry, area); } let startTime = performance.now(); let dates = await getSentinelDates(geometry, fromTime, toTime); let endTime = performance.now(); console.log(dates.length, \" STATISTICS ElapsedTime (sec): \", (endTime - startTime) / 1000); if (dates.length > 0) { let startTime = performance.now(); const responses = await axios.all( dates.map(async (item) => { let _data = await getImageWithData(item, geometry); if (_data) { await mongodb.saveImage(_data); } }) ); let endTime = performance.now(); console.log(\"IMAGES ElapsedTime (sec): \", (endTime - startTime) / 1000); savedDates = dateTime.sortByDateTime(dates, \"generationtime\", \"desc\"); res = await mongodb.updateDates(id, savedDates); return res; } return false; } catch (e) { console.log(\"XXerror: \", e.message); return false; } }; /* * Gets dates for the specified geometry and date range. * @param {boolean} returnData - Whether to return data. * @param {Object} geometry - The geometry object. * @param {Date} fromTime - The start date. * @param {Date} toTime - The end date. * @returns {Promise } - The data or null if no data is available. / async function getDates(returnData, geometry, fromTime, toTime) { let status = true; let id = hash.sha256(geometry); let data = await mongodb.getDates(id); if (!data || data.dates.length === 0) { status = await saveSentinelDataToMongo(true, geometry, fromTime, toTime); } else if (data.dates.length === 0) { return null; } else { if (isDateInGrowingSeason(toTime, growingSeason)) { if (data.dates[0].generationtime < dateTime.zeroDateTime(toTime)) { let fromTime = new Date(dateTime.addOneDay(data.dates[0].generationtime)); status = await saveSentinelDataToMongo(false, geometry, fromTime, toTime); } } } if (returnData) { data = await mongodb.getDates(id); return data; } else { return null; } } // global let authToken; /* * Lists the data. * @param {Object} req - The request object. * @param {Object} res - The response object. * @param {Function} next - The next middleware function. * @returns {Promise } / const list = async (req, res, next) => { authToken = req.authToken; let startTime = performance.now(); let updateDb = false; try { updateDb = req.body.updateDb; } catch (e) { updateDb = false; } let geometry = null; try { if (typeof req.body.geometry !== \"object\") { geometry = JSON.parse(req.body.geometry); } else { geometry = req.body.geometry; } } catch (e) { console.log(\"ERRORxxxxxxxxxxxxx \", e.message); } let fromTime = new Date(req.body.start_date); let toTime = new Date(req.body.end_date); const data = await getDates(true, geometry, fromTime, toTime); let endTime = performance.now(); console.log(\"All ElapsedTime (sec): \", (endTime - startTime) / 1000); if (updateDb) { res.status(222).send(\"done\"); } else { if (data && !updateDb) { res.status(200).send(data); } else { res.status(404).send(\"no data available\"); } } }; /* * Activates the process for the specified geometry and date range. * @param {Object} req - The request object. * @param {Object} res - The response object. * @param {Function} next - The next middleware function. * @returns {Promise } / const activate = async (req, res, next) => { let startTime = performance.now(); authToken = req.authToken; console.log(\"ACTIVATE authToken: \" + authToken); let geometry = JSON.parse(req.body.geometry); let fromTime = new Date(req.body.start_date); let toTime = new Date(dateTime.addOneDay(req.body.end_date)); const processQueue = async () => { while (queueParams.length > 0) { const params = queueParams.shift(); await doIt(params); } isProcessingQueue = false; }; const addToQueue = async (params) => { queueParams.push(params); if (!isProcessingQueue) { isProcessingQueue = true; await processQueue(); } }; const params = { geometry, fromTime, toTime }; await addToQueue(params); res.status(200).send ------------------------------------------------------------------------- The provided code contains a series of JavaScript modules and functions designed to interact with the SentinelHub API, process satellite data, and manage it in a MongoDB database. Here's an explanation of the hierarchical structure of dependencies and functionality in the code: Hierarchical Structure of Dependencies Core Libraries and Utilities axios: Used for making HTTP requests. hash: Custom utility for generating SHA-256 hashes. geoUtils: Custom utility for geographic calculations. statistics: Module for fetching statistical data from SentinelHub. imageRef: Module for retrieving images from SentinelHub. imageDataRef: Utility for extracting data from images. dateTime: Utility for date and time manipulations. mongodb: Module for interacting with a MongoDB database. scheduleUpdateDb: Utility for scheduling database updates. get_bounding_box: Imported from @turf/bbox for calculating bounding boxes. growingSeason: JSON file containing growing season data. isDateInGrowingSeason: Utility to check if a date is within the growing season. Functions and Main Logic getSentinelDates: Fetches statistical data from SentinelHub for given geometry and time range. getImageWithData: Retrieves an image and its associated data. saveSentinelDataToMongo: Saves Sentinel data to MongoDB, including handling the storage of images. getDates: Manages fetching and updating dates in the MongoDB based on geometry and time. list: Main endpoint function that processes requests to list data. activate: Function to activate data processing for multiple geometries. Detailed Hierarchical Structure plaintext Copy code main module \u251c\u2500\u2500 core libraries \u2502 \u251c\u2500\u2500 axios \u2502 \u251c\u2500\u2500 hash \u2502 \u251c\u2500\u2500 geoUtils \u2502 \u251c\u2500\u2500 statistics \u2502 \u251c\u2500\u2500 imageRef \u2502 \u251c\u2500\u2500 imageDataRef \u2502 \u251c\u2500\u2500 dateTime \u2502 \u251c\u2500\u2500 mongodb \u2502 \u251c\u2500\u2500 scheduleUpdateDb \u2502 \u251c\u2500\u2500 @turf/bbox \u2502 \u251c\u2500\u2500 growingSeason.json \u2502 \u2514\u2500\u2500 isDateInGrowingSeason \u2502 \u251c\u2500\u2500 functions \u2502 \u251c\u2500\u2500 getSentinelDates \u2502 \u251c\u2500\u2500 getImageWithData \u2502 \u251c\u2500\u2500 saveSentinelDataToMongo \u2502 \u251c\u2500\u2500 getDates \u2502 \u251c\u2500\u2500 handleImages \u2502 \u251c\u2500\u2500 getDatesForGeometry \u2502 \u2514\u2500\u2500 doIt \u2502 \u2514\u2500\u2500 main logic \u251c\u2500\u2500 updateDb \u251c\u2500\u2500 startScheduleUpdateDb \u251c\u2500\u2500 list \u251c\u2500\u2500 activate \u251c\u2500\u2500 XXXactivate \u2514\u2500\u2500 image Key Functional Flow Data Retrieval and Processing getSentinelDates: Retrieves statistical data for a specific geometry and time range. getImageWithData: Gets images and extracts additional data. saveSentinelDataToMongo: Saves the retrieved data and images into MongoDB. Date Management getDates: Coordinates the retrieval and updating of dates from MongoDB, handling growing season logic and date calculations. Scheduling and Updating updateDb: Function to manually trigger the update process. startScheduleUpdateDb: Initiates scheduled updates. scheduleUpdateDb: Utility to schedule database updates. API Endpoints list: Main endpoint for listing data based on input geometry and date range. activate: Handles batch processing of geometries and their respective data. XXXactivate: Variant of the activate function with different processing logic. image: Endpoint for handling image-related requests. This structure ensures modular and organized code, allowing for easier maintenance, debugging, and scalability. Each module and function has a specific role, contributing to the overall functionality of processing and managing SentinelHub data within a MongoDB database.","title":"Ndvi controller js"},{"location":"routes/ndvi_controller_js/#growindseaaon","text":"t\u00e4m\u00e4 ehdokis ettei p\u00e4ivityst\u00e4 tsekata jos ollaan offsesonilla!!! need to pe considered using the server plans and updates from sentinel if new customer. this controleler is the only one which is connected to sentinelhub so code related to connection is placed/located here. starting at authentication to sentinelHub auth method is outside of the routes because two of them use the same code. when just one geometry axios.post for statistics and axios.all for images when multiple geometries (an array) axios.all for statistics images will be request just axios.get or should develop part of... there is limit exceeded.... routes/endpoints jokin swagger tai muuntapainen jossa mainittu post tai get","title":"growindseaaon!!!!!!!!!"},{"location":"routes/ndvi_controller_js/#data","text":"testing and demo data is json format having geojson data about 2000 aoi fields data is inserted via this backend server to mongodb atlas database. NDVI data ofr every aoi is requested from sentinel from 3 years as an demo purpose.","title":"DATA"},{"location":"routes/ndvi_controller_js/#activate-muuta-nimi","text":"vain uusia datasettej\u00e4 varten jos ajetaan uudelleen samoja geometrioita vanhat tuhotaan","title":"activate (muuta nimi)"},{"location":"routes/ndvi_controller_js/#list-lisaa-std-min-max-mean-lisaksi","text":"parameters endTime: normally the currentDate on growinng season dates collection must be sorted ordered with generationTime beause of axios.all palauttaa dataa \"satunnaisessa j\u00e4rjestksee\u00e4\" ei siis j\u00e4rjestyksess\u00e4 jotka asetetaan parametriksi, joka yhistet\u00e4\u00e4n sentinelhub statistics dataan sis\u00e4lt\u00e4en p\u00e4iv\u00e4m\u00e4\u00e4r\u00e4t. olisiko ndvi_controller jokin postgreelle vai kuinka valitaan kumpaa k\u00e4ytet\u00e4\u00e4n k\u00e4yt\u00e4 samannimis\u00e4 meodeja saman nimisi\u00e4 parametreja","title":"list LIS\u00c4\u00c4 std min max mean lis\u00e4ksi!!!!"},{"location":"routes/ndvi_controller_js/#routes","text":"activate takes an array of geometries time rannge starttime, endtime beacuse of posible lot of geometries to handle for NDVI data ould take tiem depends on amount of geometries and size of areas it could be need for update token, now it is handle by middleware but in this case method for token should be called for a while, await req.checkToken(); too many request in sentinel hub should be avoided HTTP status 429 https://docs.sentinel-hub.com/api/latest/api/overview/rate-limiting/ voisiko kantaan kirjoittaminen tuoda tarvittavan/riitt\u00e4vn viiveen jotta em. v\u00e4ltyytt\u00e4isiin. activate jos sa,alla geometrialla uuudestaan niin deleteoidaan edelline dates sill\u00e4 aikaj\u00e4nne voi oilla ihan eri ja ei siten p\u00e4ivityajatusta p\u00e4ivitys thd\u00e4\u00e4n list reouteen tai updagte????","title":"routes:"},{"location":"routes/ndvi_controller_js/#-","text":"const axios = require(\"axios\"); const hash = require(\"../utils/hash\"); const geoUtils = require(\"../utils/geoUtils\"); const statistics = require(\"../sentinelhub/getStatistics\"); const imageRef = require(\"../sentinelhub/getImage\"); const imageDataRef = require(\"../utils/image/getImageData\"); const dateTime = require(\"../utils/dateTime\"); var get_bounding_box = require(\"@turf/bbox\").default; const mongodb = require(\"../mongo/mongodb\"); const scheduleUpdateDb = require(\"../utils/scheduleUpdateDb\"); const growingSeason = require(\"../settings/growingSeason.json\"); const isDateInGrowingSeason = require(\"../utils/isdateingrowingseason\"); / * Updates the database with the latest data. * @returns {Promise } - True if the update was successful. / const updateDb = async () => { scheduleUpdateDb.stop(); console.log(\"Updating data * * * * * * * * * * **** \"); let data = await mongodb.getAllDateSets(); if (data && data.length > 0) { console.log(data.length, \" --> [0] \", data[0].id); let endDate = new Date(); await getDates(false, data[0].geometry, null, endDate); } return true; }; /* * Starts the database update schedule. * @returns {Promise } / const startScheduleUpdateDb = async () => { await updateDb(); }; /* * Retrieves Sentinel data for the specified date range and geometry. * @param {Object} geometry - The geometry object. * @param {Date} fromTime - The start date. * @param {Date} toTime - The end date. * @returns {Promise } - The list of dates and corresponding statistics. / const getSentinelDates = async (geometry, fromTime, toTime) => { let data = []; let stats = await statistics.getStatistics(geometry, fromTime, toTime); if (stats.length > 0) { stats.reverse(); for (let stat of stats) { let statRef = stat.outputs.data.bands.B0.stats; let mean = statRef.mean; if (mean >= 0.1) { data = [ ...data, { generationtime: stat.interval.from, stats: { average: statRef.mean, max: statRef.max, min: statRef.min, std: statRef.stDev, }, sentinelid: stat.interval.from + \"_\" + hash.sha256(geometry), }, ]; } } } else { console.log(\"No data for the geometry **********************************************************************\", fromTime, \" - \", toTime); } return data; }; /* * Retrieves image data along with its metadata. * @param {Object} item - The item object containing generation time and statistics. * @param {Object} geometry - The geometry object. * @returns {Promise } - The image data or null if the image is not found. / const getImageWithData = async (item, geometry) => { let image = await imageRef.getImage(item.generationtime, geometry); if (image) { let data = await imageDataRef.getImageData(geometry, image, { id: item.sentinelid, average: item.stats.average, max: item.stats.max, min: item.stats.min, std: item.stats.std, }); return data; } else { return null; } }; /* * Saves Sentinel data to MongoDB. * @param {boolean} save - Whether to save the data. * @param {Object} geometry - The geometry object. * @param {Date} fromTime - The start date. * @param {Date} toTime - The end date. * @returns {Promise } - True if the data was saved successfully, otherwise false. / const saveSentinelDataToMongo = async (save, geometry, fromTime, toTime) => { let id = hash.sha256(geometry); const area = geoUtils.getAreaFromGeometry(geometry); let savedDates = []; let res = null; try { if (save) { res = await mongodb.saveDates(id, savedDates, geometry, area); } let startTime = performance.now(); let dates = await getSentinelDates(geometry, fromTime, toTime); let endTime = performance.now(); console.log(dates.length, \" STATISTICS ElapsedTime (sec): \", (endTime - startTime) / 1000); if (dates.length > 0) { let startTime = performance.now(); const responses = await axios.all( dates.map(async (item) => { let _data = await getImageWithData(item, geometry); if (_data) { await mongodb.saveImage(_data); } }) ); let endTime = performance.now(); console.log(\"IMAGES ElapsedTime (sec): \", (endTime - startTime) / 1000); savedDates = dateTime.sortByDateTime(dates, \"generationtime\", \"desc\"); res = await mongodb.updateDates(id, savedDates); return res; } return false; } catch (e) { console.log(\"XXerror: \", e.message); return false; } }; /* * Gets dates for the specified geometry and date range. * @param {boolean} returnData - Whether to return data. * @param {Object} geometry - The geometry object. * @param {Date} fromTime - The start date. * @param {Date} toTime - The end date. * @returns {Promise } - The data or null if no data is available. / async function getDates(returnData, geometry, fromTime, toTime) { let status = true; let id = hash.sha256(geometry); let data = await mongodb.getDates(id); if (!data || data.dates.length === 0) { status = await saveSentinelDataToMongo(true, geometry, fromTime, toTime); } else if (data.dates.length === 0) { return null; } else { if (isDateInGrowingSeason(toTime, growingSeason)) { if (data.dates[0].generationtime < dateTime.zeroDateTime(toTime)) { let fromTime = new Date(dateTime.addOneDay(data.dates[0].generationtime)); status = await saveSentinelDataToMongo(false, geometry, fromTime, toTime); } } } if (returnData) { data = await mongodb.getDates(id); return data; } else { return null; } } // global let authToken; /* * Lists the data. * @param {Object} req - The request object. * @param {Object} res - The response object. * @param {Function} next - The next middleware function. * @returns {Promise } / const list = async (req, res, next) => { authToken = req.authToken; let startTime = performance.now(); let updateDb = false; try { updateDb = req.body.updateDb; } catch (e) { updateDb = false; } let geometry = null; try { if (typeof req.body.geometry !== \"object\") { geometry = JSON.parse(req.body.geometry); } else { geometry = req.body.geometry; } } catch (e) { console.log(\"ERRORxxxxxxxxxxxxx \", e.message); } let fromTime = new Date(req.body.start_date); let toTime = new Date(req.body.end_date); const data = await getDates(true, geometry, fromTime, toTime); let endTime = performance.now(); console.log(\"All ElapsedTime (sec): \", (endTime - startTime) / 1000); if (updateDb) { res.status(222).send(\"done\"); } else { if (data && !updateDb) { res.status(200).send(data); } else { res.status(404).send(\"no data available\"); } } }; /* * Activates the process for the specified geometry and date range. * @param {Object} req - The request object. * @param {Object} res - The response object. * @param {Function} next - The next middleware function. * @returns {Promise } / const activate = async (req, res, next) => { let startTime = performance.now(); authToken = req.authToken; console.log(\"ACTIVATE authToken: \" + authToken); let geometry = JSON.parse(req.body.geometry); let fromTime = new Date(req.body.start_date); let toTime = new Date(dateTime.addOneDay(req.body.end_date)); const processQueue = async () => { while (queueParams.length > 0) { const params = queueParams.shift(); await doIt(params); } isProcessingQueue = false; }; const addToQueue = async (params) => { queueParams.push(params); if (!isProcessingQueue) { isProcessingQueue = true; await processQueue(); } }; const params = { geometry, fromTime, toTime }; await addToQueue(params); res.status(200).send","title":"-----------------------------------------------------------------------"},{"location":"routes/ndvi_controller_js/#-_1","text":"The provided code contains a series of JavaScript modules and functions designed to interact with the SentinelHub API, process satellite data, and manage it in a MongoDB database. Here's an explanation of the hierarchical structure of dependencies and functionality in the code: Hierarchical Structure of Dependencies Core Libraries and Utilities axios: Used for making HTTP requests. hash: Custom utility for generating SHA-256 hashes. geoUtils: Custom utility for geographic calculations. statistics: Module for fetching statistical data from SentinelHub. imageRef: Module for retrieving images from SentinelHub. imageDataRef: Utility for extracting data from images. dateTime: Utility for date and time manipulations. mongodb: Module for interacting with a MongoDB database. scheduleUpdateDb: Utility for scheduling database updates. get_bounding_box: Imported from @turf/bbox for calculating bounding boxes. growingSeason: JSON file containing growing season data. isDateInGrowingSeason: Utility to check if a date is within the growing season. Functions and Main Logic getSentinelDates: Fetches statistical data from SentinelHub for given geometry and time range. getImageWithData: Retrieves an image and its associated data. saveSentinelDataToMongo: Saves Sentinel data to MongoDB, including handling the storage of images. getDates: Manages fetching and updating dates in the MongoDB based on geometry and time. list: Main endpoint function that processes requests to list data. activate: Function to activate data processing for multiple geometries. Detailed Hierarchical Structure plaintext Copy code main module \u251c\u2500\u2500 core libraries \u2502 \u251c\u2500\u2500 axios \u2502 \u251c\u2500\u2500 hash \u2502 \u251c\u2500\u2500 geoUtils \u2502 \u251c\u2500\u2500 statistics \u2502 \u251c\u2500\u2500 imageRef \u2502 \u251c\u2500\u2500 imageDataRef \u2502 \u251c\u2500\u2500 dateTime \u2502 \u251c\u2500\u2500 mongodb \u2502 \u251c\u2500\u2500 scheduleUpdateDb \u2502 \u251c\u2500\u2500 @turf/bbox \u2502 \u251c\u2500\u2500 growingSeason.json \u2502 \u2514\u2500\u2500 isDateInGrowingSeason \u2502 \u251c\u2500\u2500 functions \u2502 \u251c\u2500\u2500 getSentinelDates \u2502 \u251c\u2500\u2500 getImageWithData \u2502 \u251c\u2500\u2500 saveSentinelDataToMongo \u2502 \u251c\u2500\u2500 getDates \u2502 \u251c\u2500\u2500 handleImages \u2502 \u251c\u2500\u2500 getDatesForGeometry \u2502 \u2514\u2500\u2500 doIt \u2502 \u2514\u2500\u2500 main logic \u251c\u2500\u2500 updateDb \u251c\u2500\u2500 startScheduleUpdateDb \u251c\u2500\u2500 list \u251c\u2500\u2500 activate \u251c\u2500\u2500 XXXactivate \u2514\u2500\u2500 image Key Functional Flow Data Retrieval and Processing getSentinelDates: Retrieves statistical data for a specific geometry and time range. getImageWithData: Gets images and extracts additional data. saveSentinelDataToMongo: Saves the retrieved data and images into MongoDB. Date Management getDates: Coordinates the retrieval and updating of dates from MongoDB, handling growing season logic and date calculations. Scheduling and Updating updateDb: Function to manually trigger the update process. startScheduleUpdateDb: Initiates scheduled updates. scheduleUpdateDb: Utility to schedule database updates. API Endpoints list: Main endpoint for listing data based on input geometry and date range. activate: Handles batch processing of geometries and their respective data. XXXactivate: Variant of the activate function with different processing logic. image: Endpoint for handling image-related requests. This structure ensures modular and organized code, allowing for easier maintenance, debugging, and scalability. Each module and function has a specific role, contributing to the overall functionality of processing and managing SentinelHub data within a MongoDB database.","title":"-------------------------------------------------------------------------"},{"location":"routes/overview/","text":"developing route otetaan mukaan vain develop modessa priction modessa ko. route ei tule mukaan Backend NDVI-controller - list - activate - image Develop - database... Erikseen on develop-route sis\u00e4lt\u00e4en demon datan sek\u00e4 joitakin mm. database maintrenece tools Weather - t\u00e4ss\u00e4 tapuksessa haetaan valitun paikkakunnan s\u00e4\u00e4dataa vaikka joka p\u00e4iv\u00e4lt\u00e4 mit\u00e4 on ollut - voisi n\u00e4ky\u00e4 ko. paikkakunnan s\u00e4\u00e4 joka on parhaillaan (jokin p\u00e4ivitys cronilla) frontille ie vitisyksi\u00e4 kaikki menee backendin kautta Monitoring SOCKET - p\u00e4ivityksen monitotointi resfFull plugin tee testi routeihin ilman ja tokenin kanssa!!!! Routes AOIs to MongoDB puuttuu Routes \u251c\u2500\u2500 user-routes \u2502 \u251c\u2500\u2500 register \u2502 \u2514\u2500\u2500 login \u2502 \u251c\u2500\u2500 ndvi-routes \u2502 \u251c\u2500\u2500 list \u2502 \u251c\u2500\u2500 image \u2502 \u251c\u2500\u2500 weather \u2502 \u251c\u2500\u2500 activate \u2502 \u2514\u2500\u2500 aois \u2502 \u2514\u2500\u2500 dev-routes \u2514\u2500\u2500 (multiple actions) for dev-routes the routes are not documented in this case. just one aoistomongo. Jotenkin pit\u00e4isi kuvata kuinka \"koodillisesti\" rakenne user-routes Register Authentication / token use of all the routes need authentocation made from frontend app to route named user to get token which is needed for use of services. so token is needed and some route needs administrator privileges. user-routes -> user-controllers router.post('/login', usersControllers.login); router.post('/register', usersControllers.register); user-controllers const bcrypt = require('bcrypt'); const jwt = require('jsonwebtoken') register login register sequenceDiagram autonumber participant Client participant Server participant MongoDb Client->>Server: POST /ndvi/api/v1/register alt Insertion Successful Server->>MongoDb: Insert user data MongoDb-->>Server: Acknowledge insertion Server-->>Client: Status 200 (Registration successful) else Insertion Failed Server-->>Client: Status 401 (Registration failed, user exists) end taking in action on App.js const userRouter = require(\"./routes/user-routes\"); app.use(\"/ndvi/api/v1\",userRouter); calling to ../ndvi/api/v1/register - parameters firstname, lastname, email, password if exists return xxxx if not exists -> sace - return saved 200 returns if succees (Teemun jutusta mallia) mit\u00e4 parmaetriksi eli kuinka kutsutaan ja pit\u00e4 palauttaa Login ndvi-routes list NEEDs token use this endpoint/route Retrieves/returns a list of Sentinel-hub NDVI dates with statistics and updates the database if new data is available. List the days with found images for the given geometry found in Sentinel Hub. Service stores the given geometry and the days in which the images can be found so that there would be no need to re-query the days (only newer days from the last query should be queried) every time from Sentinel Hub. If the image is available for given day then the service should assign unique id \"sentinelid\" for that day and image. Endpoint Url HTTP Method /ndvi/api/v1/list POST Request Name Type Description geometry geoJSON Geometry in geoJSON format, coordinate reference system WGS84 (EPSG:4326) start_date dateString (ISO 8601) The start date to include images from end_date dateString (ISO 8601) The end date to include images to Request body { \"geometry\": \"geoJSON\", \"start_date\": \"dateString\", \"end_date\": \"dateString\" } Response Name Type Description array All the days from which images can be queried generationtime dateString (ISO 8601) The date of the image sentinelid string generationtime and geometry converted to sha256-format, generated for the request to be used when fetching the image from database e.g. 2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba038cb86b647 [ { \"generationtime\": \"2023-05-15T00:00:00Z\", \"sentinelid\": \"2023-05-15T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba...\" }, { \"generationtime\": \"2023-05-30T00:00:00Z\", \"sentinelid\": \"2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba...\" }, ... ] Sequence diagram sequenceDiagram Autonumber participant Client participant Server as Server: list participant MongoDB participant SentinelHub Note left of Server: /ndvi/api/v1/list Client->>Server: Request (token in header) Server->>MongoDB: Query MongoDB-->>Server: Data alt Data found in MongoDB alt Current date is newer than last date in list for specific geometry (AOI) Server->>SentinelHub: Request new data SentinelHub-->>Server: Response (New data) Server->>MongoDB: Store new data Server->>MongoDB: Query MongoDB-->>Server: Data end Server-->>Client: Response Note right of Server: Data found in MongoDB else Data not found in MongoDB Server->>SentinelHub: Request SentinelHub-->>Server: Response (Data not found in MongoDB) Server->>MongoDB: Store Data Server->>MongoDB: Query MongoDB-->>Server: Data Server-->>Client: Response Note right of Server: Data not found in MongoDB end Pit\u00e4isk\u00f6 muuttaa mondoB dataBaseksi??? 1. /ndvi/api/v1/list if new data (statistics) is available it will be stored into the database. Also NDVI-imagedata related to all new dates will be request from SentinelHub Sequence diagram sequenceDiagram Autonumber participant Server as Server: list participant SentinelHub participant MongoDB Server->>SentinelHub: Request new data SentinelHub-->>Server: Response (New data) Server->>MongoDB: Store new data loop Request image data Server->>SentinelHub: Request image data (for each new data item) SentinelHub-->>Server: Response (image data) Server->>MongoDB: Store image data with statistics end tulleeko johonkin varsinaiset kutsut sentinelhubiin (senetinelhubista oma kappale) api.md samallahan kun haetaan statistics ja sen perusteella haetaan NDVI-iamges ja tallennetaan kantaan. Jos kannata l\u00e4ytyy niin tsekataan jos l\u00f6ytyy uudempaa dataa sen j\u00e4lkeen kuin viimeksi talllennettiin dataa. activate TEKSTI ihan puppua t\u00e4h\u00e4n kohtaan Activate specifig aois to get NDVI-iamge and related statistics. this is just for updating database with multiple aois does not return any data for client, is triggered from the client. sama kuin list mutta array of geometries as parameter and process is different... is identical too list but technically implemented in the code some kind of parallel simplified, general and principled description not quite real does not return anything jsut success 200 statuscode Retrieves/returns a list of Sentinel-hub NDVI dates with statistics and updates the database if new data is available. lis\u00e4\u00e4 api.md:st\u00e4 usecases ja parametrit ja paluu arvot mutta frontend docu List the days with found images for the given geometry found in Sentinel Hub. Service should store the given geometry and the days in which the images can be found so that there would be no need to re-query the days (only newer days from the last query should be queried) every time from Sentinel Hub. If the image is available for given day then the service should assign unique id \"sentinelid\" for that day and image. Endpoint Url HTTP Method /ndvi/api/v1/activate POST Request Name Type Description geometry Array of geoJSON Array of geometries in geoJSON format, coordinate reference system WGS84 (EPSG:4326) start_date dateString (ISO 8601) The start date to include images from end_date dateString (ISO 8601) The end date to include images to Request body { \"geometry\": \"geoJSON\", \"start_date\": \"dateString\", \"end_date\": \"dateString\" } Response Name Type Description array All the days from which images can be queried generationtime dateString (ISO 8601) The date of the image sentinelid string generationtime and geometry converted to sha256-format, generated for the request to be used when fetching the image from database e.g. 2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba038cb86b647 sequenceDiagram Autonumber participant Client participant Server as Server: activate participant MongoDB participant SentinelHub Note left of Server: /ndvi/api/v1/activate Client->>Server: Request (array of geometries) loop for each geometry in array Server->>MongoDB: Query (geometry) MongoDB-->>Server: Data (geometry) alt Data found in MongoDB alt Current date is newer than last date in list for specific geometry (AOI) Server->>SentinelHub: Request new data (geometry) SentinelHub-->>Server: Response (New data) Server->>MongoDB: Store new data (geometry) Server->>MongoDB: Query (geometry) MongoDB-->>Server: Data (geometry) end Server-->>Client: Response (statuscode 200) Note right of Server: Data found in MongoDB for geometry else Data not found in MongoDB Server->>SentinelHub: Request (geometry) SentinelHub-->>Server: Response (Data not found in MongoDB) Server->>MongoDB: Store Data (geometry) Server->>MongoDB: Query (geometry) MongoDB-->>Server: Data (geometry) Server-->>Client: Response (statuscode 200) Note right of Server: Data not found in MongoDB for geometry end end Image Returns the NDVI image with statictics for the given sentinelid. controllers/ \u2502 \u2514\u2500\u2500 ndvi-controllers.js \u2502 \u2514\u2500\u2500 image \u2514\u2500\u2500 routes/ \u2514\u2500\u2500 ndvi-routes.js const ndviControllers = require('../controllers/ndvi-controllers'); router.get('/image/:sentinelid', ndviControllers.image); Endpoint Url HTTP Method /ndvi/api/v1/image GET Request Name Type Description sentinelid string id for image (generated when image with related data fetched from sentinelhub and saved into database) epsg integer optional, used when related coordinates need to be in system EPSG:3067 Response Name Type Description average float Average value of the NDVI max float Maximum value of the NDVI min float Minimum value of the NDVI std float Standard deviation value of the NDVI image Image of the NDVI image.minX float Bounding rect minimum X value, coordinate reference system WGS84 (EPSG:4326) image.minY float Bounding rect minimum Y value, coordinate reference system WGS84 (EPSG:4326) image.maxX float Bounding rect maximum X value, coordinate reference system WGS84 (EPSG:4326) image.maxY float Bounding rect maximum Y value, coordinate reference system WGS84 (EPSG:4326) image.dataUrl Base&4 string Image in Base64 string format (i.e., data:image/png;base64...) scale array Array for NDVI value categories as colours scale.color string Colour as RGB string value scale.amount integer scale.from float Response datatypes { \"average\": \"float\", \"max\": \"float\", \"min\": \"float\", \"std\": \"float\", \"image\": { \"minX\": \"float\", \"minY\": \"float\", \"maxX\": \"float\", \"maxY\": \"float\", \"dataUrl\": \"Base64 string\" }, \"scale\": [ { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" } ] } Example { \"average\": 0.5657129907618343, \"max\": 0.75, \"min\": 0.15, \"std\": 0.90 \"image\": { \"minX\": 26.1930913, \"minY\": 62.9857763, \"maxX\": 26.194766, \"maxY\": 62.9867615 \"dataUrl\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABuCAYAAACnQwS5AAADnEl...\" }, \"scale\": [ { \"color\": \"rgb(244, 67, 54)\", \"amount\": 0, \"from\": 0.15 }, { \"color\": \"rgb(255, 152, 0)\", \"amount\": 0, \"from\": 0.3 }, { \"color\": \"rgb(255, 235, 59)\", \"amount\": 22, \"from\": 0.45 }, { \"color\": \"rgb(76, 175, 80)\", \"amount\": 78, \"from\": 0.6 } ] } KAAVIOSTA puuttuu token in header pit\u00e4isk\u00e4 vaan manita Request(token in header) kuten frontin dokussa pit\u00e4is olla oikeastaan vuokaavio ti structure tms. josskain mongodb.js-> image ehk\u00e4 mongodb kappaleeseen Sequence diagram sequenceDiagram Autonumber participant Client participant Server as Server: image participant MongoDB Note left of Server: /ndvi/api/v1/image Client->>Server: Request (token in header) alt Image data found in MongoDB Server->>MongoDB: Query for image data MongoDB-->>Server: Image data Server-->>Client: Response (Image data) else Image data not found in MongoDB Server-->>Client: Response (statuscode 404) end sequenceDiagram Client->>+NDVI: image alt no image available for sentinelid NDVI->>Client: 404 Not found else NDVI->>-Client: 200 OK end MARK:notice::: in case of 404 there is sometring error situation on front end or database is corrupted. Will happen very rarely or never but in testinf/developing situations. weather controllers/ \u2502 \u2514\u2500\u2500 ndvi-controllers.js \u2502 \u2514\u2500\u2500 weather \u2514\u2500\u2500 routes/ \u2514\u2500\u2500 ndvi-routes.js const ndviControllers = require('../controllers/ndvi-controllers'); router.post('/weather', ndviControllers.weather); Returns the NDVI image with statictics for the given sentinelid. Endpoint Url HTTP Method /ndvi/api/v1/weather POST Request Name Type Description topic string current weather or accumulated_temperature or accumulated_precipitation geometry geoJSON Geometry in geoJSON format, coordinate reference system WGS84 (EPSG:4326) start_date dateString (ISO 8601) The start date to history data from end_date dateString (ISO 8601) The end date to history data to Request body { \"topic\": \"string\", \"geometry\": \"geoJSON\", \"start_date\": \"dateString\", \"end_date\": \"dateString\" } Date parameters are just for topic as accumulated_temperature or accumulated_precipitation Response when topic parameter is \"current\" Name Type Description data json there are multiple variables, getting main.temp, main.feels_like, main.temp_min, main.temp_max weather[0].main Response when topic parameter is \"accumulated_temperature\" or \"accumulated_precipitation\" Name Type Description data array of json there are multiple variables, getting date, rain or temp Sequence diagram sequenceDiagram Autonumber participant Client participant Server as Server: weather participant OpenWeatherMap Note left of Server: /ndvi/api/v1/weather Client->>Server: Request alt Topic is current Server->>OpenWeatherMap: Request (https://api.openweathermap.org) OpenWeatherMap-->>Server: Response with current weather data Server-->>Client: Response with current weather data else Topic is accumulated_temperature Server->>OpenWeatherMap: Request (https://history.openweathermap.org) OpenWeatherMap-->>Server: Response with accumulated temperature data Server-->>Client: Response with accumulated temperature data else Topic is accumulated_precipitation Server->>OpenWeatherMap: Request (https://history.openweathermap.org) OpenWeatherMap-->>Server: Response with accumulated precipitation data Server-->>Client: Response with accumulated precipitation data end numeroituihin kohtiin paremmin parametrit yms. Aois Returns array of aios. controllers/ \u2502 \u2514\u2500\u2500 ndvi-controllers.js \u2502 \u2514\u2500\u2500 aois \u2514\u2500\u2500 routes/ \u2514\u2500\u2500 ndvi-routes.js const ndviControllers = require('../controllers/ndvi-controllers'); router.post('/aois', ndviControllers.aois); Endpoint Url HTTP Method /ndvi/api/v1/aois GET Request no params Response Responses arrray of json data Name Type Description id string unique identification workareaid string unique workarea identification name string name of aoi geometry geoJSON geometry of aoi in geoJSON format, coordinate reference system WGS84 (EPSG:4326) Sequence diagram sequenceDiagram Autonumber participant Client participant Server as Server: aois participant MongoDB Note left of Server: /ndvi/api/v1/aois Client->>Server: Request alt Array of Aois found in MongoDB Server->>MongoDB: Query Aois MongoDB-->>Server: Array of Aois Server-->>Client: Response (data) else Array of Aois not found in MongoDB Server-->>Client: Response (statuscode 404) end Dev-routes plannin jutussa jotain lis\u00e4\u00e4 endpoint: .../ndvi/api/v1/workAreasToMongo TEE muista vastavaksi ei parametrea ja paluuravoa vain statuscode!!! sequenceDiagram autonumber participant Frontend participant Backend participant MongoDb Frontend->>Backend: GET /ndvi/api/v1/workAreasToMongo activate Backend note right of Backend: require(\"../data/workareas.json\") alt Backend->>Backend: Loop through each workarea (index i) Backend->>MongoDb: Insert workarea data[i] MongoDb-->>Backend: Acknowledge insertion else Loop Done deactivate Backend Backend->>Frontend: Status 200 (successful) end list sentinelhub token activate (keksi jokin muu nimi) vaatii admin oikeudet. ehtona developing route otetaan mukaan vain develop modessa priction modessa ko. route ei tule mukaan NDVI-controller - list - activate - image Develop - database... Erikseen on develop-route sis\u00e4lt\u00e4en demon datan sek\u00e4 joitakin mm. database maintrenece tools Weather - t\u00e4ss\u00e4 tapuksessa haetaan valitun paikkakunnan s\u00e4\u00e4dataa vaikka joka p\u00e4iv\u00e4lt\u00e4 mit\u00e4 on ollut - voisi n\u00e4ky\u00e4 ko. paikkakunnan s\u00e4\u00e4 joka on parhaillaan (jokin p\u00e4ivitys cronilla) frontille ie vitisyksi\u00e4 kaikki menee backendin kautta Monitoring SOCKET - p\u00e4ivityksen monitotointi","title":"Overview"},{"location":"routes/overview/#backend","text":"NDVI-controller - list - activate - image Develop - database... Erikseen on develop-route sis\u00e4lt\u00e4en demon datan sek\u00e4 joitakin mm. database maintrenece tools Weather - t\u00e4ss\u00e4 tapuksessa haetaan valitun paikkakunnan s\u00e4\u00e4dataa vaikka joka p\u00e4iv\u00e4lt\u00e4 mit\u00e4 on ollut - voisi n\u00e4ky\u00e4 ko. paikkakunnan s\u00e4\u00e4 joka on parhaillaan (jokin p\u00e4ivitys cronilla) frontille ie vitisyksi\u00e4 kaikki menee backendin kautta Monitoring SOCKET - p\u00e4ivityksen monitotointi","title":"Backend"},{"location":"routes/overview/#resffull-plugin-tee-testi-routeihin-ilman-ja-tokenin-kanssa","text":"","title":"resfFull plugin tee testi routeihin ilman ja tokenin kanssa!!!!"},{"location":"routes/overview/#routes","text":"","title":"Routes"},{"location":"routes/overview/#aois-to-mongodb-puuttuu","text":"Routes \u251c\u2500\u2500 user-routes \u2502 \u251c\u2500\u2500 register \u2502 \u2514\u2500\u2500 login \u2502 \u251c\u2500\u2500 ndvi-routes \u2502 \u251c\u2500\u2500 list \u2502 \u251c\u2500\u2500 image \u2502 \u251c\u2500\u2500 weather \u2502 \u251c\u2500\u2500 activate \u2502 \u2514\u2500\u2500 aois \u2502 \u2514\u2500\u2500 dev-routes \u2514\u2500\u2500 (multiple actions) for dev-routes the routes are not documented in this case. just one aoistomongo.","title":"AOIs to MongoDB puuttuu"},{"location":"routes/overview/#jotenkin-pitaisi-kuvata-kuinka-koodillisesti-rakenne","text":"","title":"Jotenkin pit\u00e4isi kuvata kuinka \"koodillisesti\" rakenne"},{"location":"routes/overview/#user-routes","text":"Register","title":"user-routes"},{"location":"routes/overview/#authentication-token","text":"use of all the routes need authentocation made from frontend app to route named user to get token which is needed for use of services. so token is needed and some route needs administrator privileges.","title":"Authentication / token"},{"location":"routes/overview/#user-routes-user-controllers","text":"router.post('/login', usersControllers.login); router.post('/register', usersControllers.register);","title":"user-routes -&gt; user-controllers"},{"location":"routes/overview/#user-controllers","text":"const bcrypt = require('bcrypt'); const jwt = require('jsonwebtoken') register login","title":"user-controllers"},{"location":"routes/overview/#register","text":"sequenceDiagram autonumber participant Client participant Server participant MongoDb Client->>Server: POST /ndvi/api/v1/register alt Insertion Successful Server->>MongoDb: Insert user data MongoDb-->>Server: Acknowledge insertion Server-->>Client: Status 200 (Registration successful) else Insertion Failed Server-->>Client: Status 401 (Registration failed, user exists) end taking in action on App.js const userRouter = require(\"./routes/user-routes\"); app.use(\"/ndvi/api/v1\",userRouter); calling to ../ndvi/api/v1/register - parameters firstname, lastname, email, password if exists return xxxx if not exists -> sace - return saved 200 returns if succees (Teemun jutusta mallia) mit\u00e4 parmaetriksi eli kuinka kutsutaan ja pit\u00e4 palauttaa Login","title":"register"},{"location":"routes/overview/#ndvi-routes","text":"","title":"ndvi-routes"},{"location":"routes/overview/#list","text":"","title":"list"},{"location":"routes/overview/#needs-token-use-this-endpointroute","text":"Retrieves/returns a list of Sentinel-hub NDVI dates with statistics and updates the database if new data is available. List the days with found images for the given geometry found in Sentinel Hub. Service stores the given geometry and the days in which the images can be found so that there would be no need to re-query the days (only newer days from the last query should be queried) every time from Sentinel Hub. If the image is available for given day then the service should assign unique id \"sentinelid\" for that day and image. Endpoint Url HTTP Method /ndvi/api/v1/list POST Request Name Type Description geometry geoJSON Geometry in geoJSON format, coordinate reference system WGS84 (EPSG:4326) start_date dateString (ISO 8601) The start date to include images from end_date dateString (ISO 8601) The end date to include images to Request body { \"geometry\": \"geoJSON\", \"start_date\": \"dateString\", \"end_date\": \"dateString\" } Response Name Type Description array All the days from which images can be queried generationtime dateString (ISO 8601) The date of the image sentinelid string generationtime and geometry converted to sha256-format, generated for the request to be used when fetching the image from database e.g. 2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba038cb86b647 [ { \"generationtime\": \"2023-05-15T00:00:00Z\", \"sentinelid\": \"2023-05-15T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba...\" }, { \"generationtime\": \"2023-05-30T00:00:00Z\", \"sentinelid\": \"2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba...\" }, ... ] Sequence diagram sequenceDiagram Autonumber participant Client participant Server as Server: list participant MongoDB participant SentinelHub Note left of Server: /ndvi/api/v1/list Client->>Server: Request (token in header) Server->>MongoDB: Query MongoDB-->>Server: Data alt Data found in MongoDB alt Current date is newer than last date in list for specific geometry (AOI) Server->>SentinelHub: Request new data SentinelHub-->>Server: Response (New data) Server->>MongoDB: Store new data Server->>MongoDB: Query MongoDB-->>Server: Data end Server-->>Client: Response Note right of Server: Data found in MongoDB else Data not found in MongoDB Server->>SentinelHub: Request SentinelHub-->>Server: Response (Data not found in MongoDB) Server->>MongoDB: Store Data Server->>MongoDB: Query MongoDB-->>Server: Data Server-->>Client: Response Note right of Server: Data not found in MongoDB end Pit\u00e4isk\u00f6 muuttaa mondoB dataBaseksi??? 1. /ndvi/api/v1/list if new data (statistics) is available it will be stored into the database. Also NDVI-imagedata related to all new dates will be request from SentinelHub Sequence diagram sequenceDiagram Autonumber participant Server as Server: list participant SentinelHub participant MongoDB Server->>SentinelHub: Request new data SentinelHub-->>Server: Response (New data) Server->>MongoDB: Store new data loop Request image data Server->>SentinelHub: Request image data (for each new data item) SentinelHub-->>Server: Response (image data) Server->>MongoDB: Store image data with statistics end","title":"NEEDs token use this endpoint/route"},{"location":"routes/overview/#tulleeko-johonkin-varsinaiset-kutsut-sentinelhubiin-senetinelhubista-oma-kappale","text":"api.md samallahan kun haetaan statistics ja sen perusteella haetaan NDVI-iamges ja tallennetaan kantaan. Jos kannata l\u00e4ytyy niin tsekataan jos l\u00f6ytyy uudempaa dataa sen j\u00e4lkeen kuin viimeksi talllennettiin dataa.","title":"tulleeko johonkin varsinaiset kutsut sentinelhubiin (senetinelhubista oma kappale)"},{"location":"routes/overview/#activate","text":"","title":"activate"},{"location":"routes/overview/#teksti-ihan-puppua-tahan-kohtaan","text":"Activate specifig aois to get NDVI-iamge and related statistics. this is just for updating database with multiple aois does not return any data for client, is triggered from the client. sama kuin list mutta array of geometries as parameter and process is different... is identical too list but technically implemented in the code some kind of parallel simplified, general and principled description not quite real does not return anything jsut success 200 statuscode Retrieves/returns a list of Sentinel-hub NDVI dates with statistics and updates the database if new data is available. lis\u00e4\u00e4 api.md:st\u00e4 usecases ja parametrit ja paluu arvot mutta frontend docu List the days with found images for the given geometry found in Sentinel Hub. Service should store the given geometry and the days in which the images can be found so that there would be no need to re-query the days (only newer days from the last query should be queried) every time from Sentinel Hub. If the image is available for given day then the service should assign unique id \"sentinelid\" for that day and image. Endpoint Url HTTP Method /ndvi/api/v1/activate POST Request Name Type Description geometry Array of geoJSON Array of geometries in geoJSON format, coordinate reference system WGS84 (EPSG:4326) start_date dateString (ISO 8601) The start date to include images from end_date dateString (ISO 8601) The end date to include images to Request body { \"geometry\": \"geoJSON\", \"start_date\": \"dateString\", \"end_date\": \"dateString\" } Response Name Type Description array All the days from which images can be queried generationtime dateString (ISO 8601) The date of the image sentinelid string generationtime and geometry converted to sha256-format, generated for the request to be used when fetching the image from database e.g. 2023-05-30T00:00:00Z_c7a5478757abfae7286751b0950e58991fa3f6ef77f77e844baba038cb86b647 sequenceDiagram Autonumber participant Client participant Server as Server: activate participant MongoDB participant SentinelHub Note left of Server: /ndvi/api/v1/activate Client->>Server: Request (array of geometries) loop for each geometry in array Server->>MongoDB: Query (geometry) MongoDB-->>Server: Data (geometry) alt Data found in MongoDB alt Current date is newer than last date in list for specific geometry (AOI) Server->>SentinelHub: Request new data (geometry) SentinelHub-->>Server: Response (New data) Server->>MongoDB: Store new data (geometry) Server->>MongoDB: Query (geometry) MongoDB-->>Server: Data (geometry) end Server-->>Client: Response (statuscode 200) Note right of Server: Data found in MongoDB for geometry else Data not found in MongoDB Server->>SentinelHub: Request (geometry) SentinelHub-->>Server: Response (Data not found in MongoDB) Server->>MongoDB: Store Data (geometry) Server->>MongoDB: Query (geometry) MongoDB-->>Server: Data (geometry) Server-->>Client: Response (statuscode 200) Note right of Server: Data not found in MongoDB for geometry end end","title":"TEKSTI ihan puppua t\u00e4h\u00e4n kohtaan"},{"location":"routes/overview/#image","text":"Returns the NDVI image with statictics for the given sentinelid. controllers/ \u2502 \u2514\u2500\u2500 ndvi-controllers.js \u2502 \u2514\u2500\u2500 image \u2514\u2500\u2500 routes/ \u2514\u2500\u2500 ndvi-routes.js const ndviControllers = require('../controllers/ndvi-controllers'); router.get('/image/:sentinelid', ndviControllers.image); Endpoint Url HTTP Method /ndvi/api/v1/image GET Request Name Type Description sentinelid string id for image (generated when image with related data fetched from sentinelhub and saved into database) epsg integer optional, used when related coordinates need to be in system EPSG:3067 Response Name Type Description average float Average value of the NDVI max float Maximum value of the NDVI min float Minimum value of the NDVI std float Standard deviation value of the NDVI image Image of the NDVI image.minX float Bounding rect minimum X value, coordinate reference system WGS84 (EPSG:4326) image.minY float Bounding rect minimum Y value, coordinate reference system WGS84 (EPSG:4326) image.maxX float Bounding rect maximum X value, coordinate reference system WGS84 (EPSG:4326) image.maxY float Bounding rect maximum Y value, coordinate reference system WGS84 (EPSG:4326) image.dataUrl Base&4 string Image in Base64 string format (i.e., data:image/png;base64...) scale array Array for NDVI value categories as colours scale.color string Colour as RGB string value scale.amount integer scale.from float Response datatypes { \"average\": \"float\", \"max\": \"float\", \"min\": \"float\", \"std\": \"float\", \"image\": { \"minX\": \"float\", \"minY\": \"float\", \"maxX\": \"float\", \"maxY\": \"float\", \"dataUrl\": \"Base64 string\" }, \"scale\": [ { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" }, { \"color\": \"string\", \"amount\": \"integer\", \"from\": \"float\" } ] } Example { \"average\": 0.5657129907618343, \"max\": 0.75, \"min\": 0.15, \"std\": 0.90 \"image\": { \"minX\": 26.1930913, \"minY\": 62.9857763, \"maxX\": 26.194766, \"maxY\": 62.9867615 \"dataUrl\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFoAAABuCAYAAACnQwS5AAADnEl...\" }, \"scale\": [ { \"color\": \"rgb(244, 67, 54)\", \"amount\": 0, \"from\": 0.15 }, { \"color\": \"rgb(255, 152, 0)\", \"amount\": 0, \"from\": 0.3 }, { \"color\": \"rgb(255, 235, 59)\", \"amount\": 22, \"from\": 0.45 }, { \"color\": \"rgb(76, 175, 80)\", \"amount\": 78, \"from\": 0.6 } ] }","title":"Image"},{"location":"routes/overview/#kaaviosta-puuttuu-token-in-header-pitaiska-vaan-manita-requesttoken-in-header-kuten-frontin-dokussa","text":"","title":"KAAVIOSTA puuttuu token in header pit\u00e4isk\u00e4 vaan manita Request(token in header) kuten frontin dokussa"},{"location":"routes/overview/#pitais-olla-oikeastaan-vuokaavio-ti-structure-tms-josskain-mongodbjs-image-ehka-mongodb-kappaleeseen","text":"Sequence diagram sequenceDiagram Autonumber participant Client participant Server as Server: image participant MongoDB Note left of Server: /ndvi/api/v1/image Client->>Server: Request (token in header) alt Image data found in MongoDB Server->>MongoDB: Query for image data MongoDB-->>Server: Image data Server-->>Client: Response (Image data) else Image data not found in MongoDB Server-->>Client: Response (statuscode 404) end sequenceDiagram Client->>+NDVI: image alt no image available for sentinelid NDVI->>Client: 404 Not found else NDVI->>-Client: 200 OK end MARK:notice::: in case of 404 there is sometring error situation on front end or database is corrupted. Will happen very rarely or never but in testinf/developing situations.","title":"pit\u00e4is olla oikeastaan vuokaavio ti structure tms. josskain mongodb.js-&gt; image ehk\u00e4 mongodb kappaleeseen"},{"location":"routes/overview/#weather","text":"controllers/ \u2502 \u2514\u2500\u2500 ndvi-controllers.js \u2502 \u2514\u2500\u2500 weather \u2514\u2500\u2500 routes/ \u2514\u2500\u2500 ndvi-routes.js const ndviControllers = require('../controllers/ndvi-controllers'); router.post('/weather', ndviControllers.weather); Returns the NDVI image with statictics for the given sentinelid. Endpoint Url HTTP Method /ndvi/api/v1/weather POST Request Name Type Description topic string current weather or accumulated_temperature or accumulated_precipitation geometry geoJSON Geometry in geoJSON format, coordinate reference system WGS84 (EPSG:4326) start_date dateString (ISO 8601) The start date to history data from end_date dateString (ISO 8601) The end date to history data to Request body { \"topic\": \"string\", \"geometry\": \"geoJSON\", \"start_date\": \"dateString\", \"end_date\": \"dateString\" } Date parameters are just for topic as accumulated_temperature or accumulated_precipitation Response when topic parameter is \"current\" Name Type Description data json there are multiple variables, getting main.temp, main.feels_like, main.temp_min, main.temp_max weather[0].main Response when topic parameter is \"accumulated_temperature\" or \"accumulated_precipitation\" Name Type Description data array of json there are multiple variables, getting date, rain or temp Sequence diagram sequenceDiagram Autonumber participant Client participant Server as Server: weather participant OpenWeatherMap Note left of Server: /ndvi/api/v1/weather Client->>Server: Request alt Topic is current Server->>OpenWeatherMap: Request (https://api.openweathermap.org) OpenWeatherMap-->>Server: Response with current weather data Server-->>Client: Response with current weather data else Topic is accumulated_temperature Server->>OpenWeatherMap: Request (https://history.openweathermap.org) OpenWeatherMap-->>Server: Response with accumulated temperature data Server-->>Client: Response with accumulated temperature data else Topic is accumulated_precipitation Server->>OpenWeatherMap: Request (https://history.openweathermap.org) OpenWeatherMap-->>Server: Response with accumulated precipitation data Server-->>Client: Response with accumulated precipitation data end numeroituihin kohtiin paremmin parametrit yms.","title":"weather"},{"location":"routes/overview/#aois","text":"Returns array of aios. controllers/ \u2502 \u2514\u2500\u2500 ndvi-controllers.js \u2502 \u2514\u2500\u2500 aois \u2514\u2500\u2500 routes/ \u2514\u2500\u2500 ndvi-routes.js const ndviControllers = require('../controllers/ndvi-controllers'); router.post('/aois', ndviControllers.aois); Endpoint Url HTTP Method /ndvi/api/v1/aois GET Request no params Response Responses arrray of json data Name Type Description id string unique identification workareaid string unique workarea identification name string name of aoi geometry geoJSON geometry of aoi in geoJSON format, coordinate reference system WGS84 (EPSG:4326) Sequence diagram sequenceDiagram Autonumber participant Client participant Server as Server: aois participant MongoDB Note left of Server: /ndvi/api/v1/aois Client->>Server: Request alt Array of Aois found in MongoDB Server->>MongoDB: Query Aois MongoDB-->>Server: Array of Aois Server-->>Client: Response (data) else Array of Aois not found in MongoDB Server-->>Client: Response (statuscode 404) end","title":"Aois"},{"location":"routes/overview/#dev-routes","text":"plannin jutussa jotain lis\u00e4\u00e4 endpoint: .../ndvi/api/v1/workAreasToMongo TEE muista vastavaksi ei parametrea ja paluuravoa vain statuscode!!! sequenceDiagram autonumber participant Frontend participant Backend participant MongoDb Frontend->>Backend: GET /ndvi/api/v1/workAreasToMongo activate Backend note right of Backend: require(\"../data/workareas.json\") alt Backend->>Backend: Loop through each workarea (index i) Backend->>MongoDb: Insert workarea data[i] MongoDb-->>Backend: Acknowledge insertion else Loop Done deactivate Backend Backend->>Frontend: Status 200 (successful) end","title":"Dev-routes"},{"location":"routes/overview/#list_1","text":"sentinelhub token","title":"list"},{"location":"routes/overview/#activate-keksi-jokin-muu-nimi","text":"vaatii admin oikeudet. ehtona developing route otetaan mukaan vain develop modessa priction modessa ko. route ei tule mukaan NDVI-controller - list - activate - image Develop - database... Erikseen on develop-route sis\u00e4lt\u00e4en demon datan sek\u00e4 joitakin mm. database maintrenece tools Weather - t\u00e4ss\u00e4 tapuksessa haetaan valitun paikkakunnan s\u00e4\u00e4dataa vaikka joka p\u00e4iv\u00e4lt\u00e4 mit\u00e4 on ollut - voisi n\u00e4ky\u00e4 ko. paikkakunnan s\u00e4\u00e4 joka on parhaillaan (jokin p\u00e4ivitys cronilla) frontille ie vitisyksi\u00e4 kaikki menee backendin kautta Monitoring SOCKET - p\u00e4ivityksen monitotointi","title":"activate (keksi jokin muu nimi)"},{"location":"routes/routes/","text":"developing route otetaan mukaan vain develop modessa priction modessa ko. route ei tule mukaan Backend NDVI-controller - list - activate - image Develop - database... Erikseen on develop-route sis\u00e4lt\u00e4en demon datan sek\u00e4 joitakin mm. database maintrenece tools Weather - t\u00e4ss\u00e4 tapuksessa haetaan valitun paikkakunnan s\u00e4\u00e4dataa vaikka joka p\u00e4iv\u00e4lt\u00e4 mit\u00e4 on ollut - voisi n\u00e4ky\u00e4 ko. paikkakunnan s\u00e4\u00e4 joka on parhaillaan (jokin p\u00e4ivitys cronilla) frontille ie vitisyksi\u00e4 kaikki menee backendin kautta Monitoring SOCKET - p\u00e4ivityksen monitotointi resfFull plugin tee testi routeihin ilman ja tokenin kanssa!!!! Routes AOIs to MongoDB puuttuu Routes \u251c\u2500\u2500 user-routes \u2502 \u251c\u2500\u2500 register \u2502 \u2514\u2500\u2500 login \u2502 \u251c\u2500\u2500 ndvi-routes \u2502 \u251c\u2500\u2500 list \u2502 \u251c\u2500\u2500 image \u2502 \u251c\u2500\u2500 weather \u2502 \u251c\u2500\u2500 activate \u2502 \u2514\u2500\u2500 aois \u2502 \u2514\u2500\u2500 dev-routes \u2514\u2500\u2500 (multiple actions) Jotenkin pit\u00e4isi kuvata kuinka \"koodillisesti\" rakenne user-routes Register Authentication / token use of all the routes need authentocation made from frontend app to route named user to get token which is needed for use of services. so token is needed and some route needs administrator privileges. user-routes -> user-controllers router.post('/login', usersControllers.login); router.post('/register', usersControllers.register); user-controllers const bcrypt = require('bcrypt'); const jwt = require('jsonwebtoken') register login register sequenceDiagram autonumber participant Client participant Server participant MongoDb Client->>Server: POST /ndvi/api/v1/register alt Insertion Successful Server->>MongoDb: Insert user data MongoDb-->>Server: Acknowledge insertion Server-->>Client: Status 200 (Registration successful) else Insertion Failed Server-->>Client: Status 401 (Registration failed, user exists) end taking in action on App.js const userRouter = require(\"./routes/user-routes\"); app.use(\"/ndvi/api/v1\",userRouter); calling to ../ndvi/api/v1/register - parameters firstname, lastname, email, password if exists return xxxx if not exists -> sace - return saved 200 returns if succees (Teemun jutusta mallia) mit\u00e4 parmaetriksi eli kuinka kutsutaan ja pit\u00e4 palauttaa Login ndvi-routes list activate weather Aois Dev-routes list sentinelhub token activate (keksi jokin muu nimi) vaatii admin oikeudet. ehtona developing route otetaan mukaan vain develop modessa priction modessa ko. route ei tule mukaan NDVI-controller - list - activate - image Develop - database... Erikseen on develop-route sis\u00e4lt\u00e4en demon datan sek\u00e4 joitakin mm. database maintrenece tools Weather - t\u00e4ss\u00e4 tapuksessa haetaan valitun paikkakunnan s\u00e4\u00e4dataa vaikka joka p\u00e4iv\u00e4lt\u00e4 mit\u00e4 on ollut - voisi n\u00e4ky\u00e4 ko. paikkakunnan s\u00e4\u00e4 joka on parhaillaan (jokin p\u00e4ivitys cronilla) frontille ie vitisyksi\u00e4 kaikki menee backendin kautta Monitoring SOCKET - p\u00e4ivityksen monitotointi","title":"Routes"},{"location":"routes/routes/#backend","text":"NDVI-controller - list - activate - image Develop - database... Erikseen on develop-route sis\u00e4lt\u00e4en demon datan sek\u00e4 joitakin mm. database maintrenece tools Weather - t\u00e4ss\u00e4 tapuksessa haetaan valitun paikkakunnan s\u00e4\u00e4dataa vaikka joka p\u00e4iv\u00e4lt\u00e4 mit\u00e4 on ollut - voisi n\u00e4ky\u00e4 ko. paikkakunnan s\u00e4\u00e4 joka on parhaillaan (jokin p\u00e4ivitys cronilla) frontille ie vitisyksi\u00e4 kaikki menee backendin kautta Monitoring SOCKET - p\u00e4ivityksen monitotointi","title":"Backend"},{"location":"routes/routes/#resffull-plugin-tee-testi-routeihin-ilman-ja-tokenin-kanssa","text":"","title":"resfFull plugin tee testi routeihin ilman ja tokenin kanssa!!!!"},{"location":"routes/routes/#routes","text":"","title":"Routes"},{"location":"routes/routes/#aois-to-mongodb-puuttuu","text":"Routes \u251c\u2500\u2500 user-routes \u2502 \u251c\u2500\u2500 register \u2502 \u2514\u2500\u2500 login \u2502 \u251c\u2500\u2500 ndvi-routes \u2502 \u251c\u2500\u2500 list \u2502 \u251c\u2500\u2500 image \u2502 \u251c\u2500\u2500 weather \u2502 \u251c\u2500\u2500 activate \u2502 \u2514\u2500\u2500 aois \u2502 \u2514\u2500\u2500 dev-routes \u2514\u2500\u2500 (multiple actions)","title":"AOIs to MongoDB puuttuu"},{"location":"routes/routes/#jotenkin-pitaisi-kuvata-kuinka-koodillisesti-rakenne","text":"","title":"Jotenkin pit\u00e4isi kuvata kuinka \"koodillisesti\" rakenne"},{"location":"routes/routes/#user-routes","text":"Register","title":"user-routes"},{"location":"routes/routes/#authentication-token","text":"use of all the routes need authentocation made from frontend app to route named user to get token which is needed for use of services. so token is needed and some route needs administrator privileges.","title":"Authentication / token"},{"location":"routes/routes/#user-routes-user-controllers","text":"router.post('/login', usersControllers.login); router.post('/register', usersControllers.register);","title":"user-routes -&gt; user-controllers"},{"location":"routes/routes/#user-controllers","text":"const bcrypt = require('bcrypt'); const jwt = require('jsonwebtoken') register login","title":"user-controllers"},{"location":"routes/routes/#register","text":"sequenceDiagram autonumber participant Client participant Server participant MongoDb Client->>Server: POST /ndvi/api/v1/register alt Insertion Successful Server->>MongoDb: Insert user data MongoDb-->>Server: Acknowledge insertion Server-->>Client: Status 200 (Registration successful) else Insertion Failed Server-->>Client: Status 401 (Registration failed, user exists) end taking in action on App.js const userRouter = require(\"./routes/user-routes\"); app.use(\"/ndvi/api/v1\",userRouter); calling to ../ndvi/api/v1/register - parameters firstname, lastname, email, password if exists return xxxx if not exists -> sace - return saved 200 returns if succees (Teemun jutusta mallia) mit\u00e4 parmaetriksi eli kuinka kutsutaan ja pit\u00e4 palauttaa Login","title":"register"},{"location":"routes/routes/#ndvi-routes","text":"","title":"ndvi-routes"},{"location":"routes/routes/#list","text":"","title":"list"},{"location":"routes/routes/#activate","text":"","title":"activate"},{"location":"routes/routes/#weather","text":"","title":"weather"},{"location":"routes/routes/#aois","text":"","title":"Aois"},{"location":"routes/routes/#dev-routes","text":"","title":"Dev-routes"},{"location":"routes/routes/#list_1","text":"sentinelhub token","title":"list"},{"location":"routes/routes/#activate-keksi-jokin-muu-nimi","text":"vaatii admin oikeudet. ehtona developing route otetaan mukaan vain develop modessa priction modessa ko. route ei tule mukaan NDVI-controller - list - activate - image Develop - database... Erikseen on develop-route sis\u00e4lt\u00e4en demon datan sek\u00e4 joitakin mm. database maintrenece tools Weather - t\u00e4ss\u00e4 tapuksessa haetaan valitun paikkakunnan s\u00e4\u00e4dataa vaikka joka p\u00e4iv\u00e4lt\u00e4 mit\u00e4 on ollut - voisi n\u00e4ky\u00e4 ko. paikkakunnan s\u00e4\u00e4 joka on parhaillaan (jokin p\u00e4ivitys cronilla) frontille ie vitisyksi\u00e4 kaikki menee backendin kautta Monitoring SOCKET - p\u00e4ivityksen monitotointi","title":"activate (keksi jokin muu nimi)"},{"location":"routes/token_middleware/","text":"Routes which use middleware to checkout valid token. const express = require('express'); const ndviControllers = require('../controllers/ndvi-controllers'); const sentinelhubTokenMiddleware = require('../sentinelhub/sentinelhub_token'); const router = express.Router(); // Middleware for checking token const { checkToken } = sentinelhubTokenMiddleware; // Routes router.post('/list', checkToken, ndviControllers.list); router.post('/activate', checkToken, ndviControllers.activate);","title":"Token middleware"},{"location":"routes/token_middleware/#routes-which-use-middleware-to-checkout-valid-token","text":"const express = require('express'); const ndviControllers = require('../controllers/ndvi-controllers'); const sentinelhubTokenMiddleware = require('../sentinelhub/sentinelhub_token'); const router = express.Router(); // Middleware for checking token const { checkToken } = sentinelhubTokenMiddleware; // Routes router.post('/list', checkToken, ndviControllers.list); router.post('/activate', checkToken, ndviControllers.activate);","title":"Routes which use middleware to checkout valid token."},{"location":"routes/weather/","text":"controllers/ \u2502 \u2514\u2500\u2500 ndvi-controllers.js \u2502 \u2514\u2500\u2500 weather \u2514\u2500\u2500 routes/ \u2514\u2500\u2500 ndvi-routes.js const ndviControllers = require('../controllers/ndvi-controllers'); router.post('/weather', ndviControllers.weather); Returns the NDVI image with statictics for the given sentinelid. Endpoint Url HTTP Method /ndvi/api/v1/weather POST Request Name Type Description topic string current weather or accumulated_temperature or accumulated_precipitation geometry geoJSON Geometry in geoJSON format, coordinate reference system WGS84 (EPSG:4326) start_date dateString (ISO 8601) The start date to history data from end_date dateString (ISO 8601) The end date to history data to Request body { \"topic\": \"string\", \"geometry\": \"geoJSON\", \"start_date\": \"dateString\", \"end_date\": \"dateString\" } Date parameters are just for topic as accumulated_temperature or accumulated_precipitation Response when topic parameter is \"current\" Name Type Description data json there are multiple variables, getting main.temp, main.feels_like, main.temp_min, main.temp_max weather[0].main Response when topic parameter is \"accumulated_temperature\" or \"accumulated_precipitation\" Name Type Description data array of json there are multiple variables, getting date, rain or temp Sequence diagram sequenceDiagram Autonumber participant Client participant Server as Server: weather participant OpenWeatherMap activate Server Note left of Server: /ndvi/api/v1/weather Client->>Server: Request alt Topic is current Server->>OpenWeatherMap: Request (https://api.openweathermap.org) OpenWeatherMap-->>Server: Response with current weather data Server-->>Client: Response with current weather data else Topic is accumulated_temperature Server->>OpenWeatherMap: Request (https://history.openweathermap.org) OpenWeatherMap-->>Server: Response with accumulated temperature data Server-->>Client: Response with accumulated temperature data else Topic is accumulated_precipitation Server->>OpenWeatherMap: Request (https://history.openweathermap.org) OpenWeatherMap-->>Server: Response with accumulated precipitation data Server-->>Client: Response with accumulated precipitation data end deactivate Server numeroituihin kohtiin paremmin parametrit yms.","title":"weather"},{"location":"sentinelhub/evalscript/","text":"The Evalscript https://medium.com/sentinel-hub/tk-why-its-time-to-stop-processing-satellite-imagery-on-your-laptop-a09dbf8c72c0 This is where we perform the same analysis as above in the traditional workflow. Evalscripts are a piece of Javascript code, used to visualise satellite imagery and to control what values the Sentinel Hub services will return. In this evalscript, we have three functions: In function setup()we specify the required (Sentinel-2) bands as inputs and also specify the output responses with individually assigned ids. We can further customise the number of bands and the raster sampleType of each output response to your requirements. We also specify the mosaicking method Orbit. This means you are requesting the flattened mosaicked image for each orbit so that there is only one sample per pixel per orbit. With the help of preProcessScenes, we allow only data from the two defined dates to be used, and the Orbit mosaicking method is used to mosaic the two scenes that cover the AOI into a single pixel array. The third function is where pixel analysis takes place; computing NDVI for both scenes and BSI for the second scene. Lastly, the harvested formula is applied to the two indices you generated. Advanced evalscripts can be complicated, and what we explain above with all the functions, may not make sense if you are not familiar with them. We invite you to learn all about scripting with Sentinel Hub, starting with tutorials for anyone, including those not familiar with coding or remote sensing","title":"Evalscript"},{"location":"sentinelhub/evalscript/#the-evalscript","text":"https://medium.com/sentinel-hub/tk-why-its-time-to-stop-processing-satellite-imagery-on-your-laptop-a09dbf8c72c0 This is where we perform the same analysis as above in the traditional workflow. Evalscripts are a piece of Javascript code, used to visualise satellite imagery and to control what values the Sentinel Hub services will return. In this evalscript, we have three functions: In function setup()we specify the required (Sentinel-2) bands as inputs and also specify the output responses with individually assigned ids. We can further customise the number of bands and the raster sampleType of each output response to your requirements. We also specify the mosaicking method Orbit. This means you are requesting the flattened mosaicked image for each orbit so that there is only one sample per pixel per orbit. With the help of preProcessScenes, we allow only data from the two defined dates to be used, and the Orbit mosaicking method is used to mosaic the two scenes that cover the AOI into a single pixel array. The third function is where pixel analysis takes place; computing NDVI for both scenes and BSI for the second scene. Lastly, the harvested formula is applied to the two indices you generated. Advanced evalscripts can be complicated, and what we explain above with all the functions, may not make sense if you are not familiar with them. We invite you to learn all about scripting with Sentinel Hub, starting with tutorials for anyone, including those not familiar with coding or remote sensing","title":"The Evalscript"},{"location":"sentinelhub/getimage/","text":"getImage.js NDVI Image Fetching Module This JavaScript module fetches NDVI (Normalized Difference Vegetation Index) images from Sentinel Hub based on a given date and geometry. Below is a summary of the key components and functionality. Imports sentinelHub : A library for interacting with Sentinel Hub's API. calculateDim : A custom utility module for calculating image dimensions. get_bounding_box : A function from the @turf/bbox package to get the bounding box of a geometry. Helper Functions addOneDay(date) Description : Takes a date object and returns a string representing the next day in ISO format. Parameters : date - The input date. Returns : A string representing the date of the next day. getWidthAndHeight(geometry) Description : Calculates the width and height for an image based on a provided geometry. Parameters : geometry - The geometry object. Returns : An object containing the width and height for the image. Main Function getImage(date, geometry) Description : Fetches an NDVI image for a specific date and geometry. Parameters : date - The date of the image. geometry - The geometry object. Returns : The NDVI image response. Details : Evalscript : Defines how to calculate NDVI and visualize it with specific color mappings based on the NDVI value. Layer Setup : Configures a Sentinel-2 Layer with the evalscript and a cloud cover limit. Image Dimensions : Uses getWidthAndHeight to determine the image's width and height. Bounding Box : Computes the bounding box for the provided geometry. Map Parameters : Sets parameters for the map request, including time range (from the given date to the next day), resolution (10m), and image dimensions. Fetch Image : Attempts to fetch the NDVI image using the specified layer and parameters. Logs an error if the fetch fails. Export The module exports the getImage function, making it available for other parts of the application to use.","title":"GetImage"},{"location":"sentinelhub/getimage/#ndvi-image-fetching-module","text":"This JavaScript module fetches NDVI (Normalized Difference Vegetation Index) images from Sentinel Hub based on a given date and geometry. Below is a summary of the key components and functionality.","title":"NDVI Image Fetching Module"},{"location":"sentinelhub/getimage/#imports","text":"sentinelHub : A library for interacting with Sentinel Hub's API. calculateDim : A custom utility module for calculating image dimensions. get_bounding_box : A function from the @turf/bbox package to get the bounding box of a geometry.","title":"Imports"},{"location":"sentinelhub/getimage/#helper-functions","text":"","title":"Helper Functions"},{"location":"sentinelhub/getimage/#addonedaydate","text":"Description : Takes a date object and returns a string representing the next day in ISO format. Parameters : date - The input date. Returns : A string representing the date of the next day.","title":"addOneDay(date)"},{"location":"sentinelhub/getimage/#getwidthandheightgeometry","text":"Description : Calculates the width and height for an image based on a provided geometry. Parameters : geometry - The geometry object. Returns : An object containing the width and height for the image.","title":"getWidthAndHeight(geometry)"},{"location":"sentinelhub/getimage/#main-function","text":"","title":"Main Function"},{"location":"sentinelhub/getimage/#getimagedate-geometry","text":"Description : Fetches an NDVI image for a specific date and geometry. Parameters : date - The date of the image. geometry - The geometry object. Returns : The NDVI image response. Details : Evalscript : Defines how to calculate NDVI and visualize it with specific color mappings based on the NDVI value. Layer Setup : Configures a Sentinel-2 Layer with the evalscript and a cloud cover limit. Image Dimensions : Uses getWidthAndHeight to determine the image's width and height. Bounding Box : Computes the bounding box for the provided geometry. Map Parameters : Sets parameters for the map request, including time range (from the given date to the next day), resolution (10m), and image dimensions. Fetch Image : Attempts to fetch the NDVI image using the specified layer and parameters. Logs an error if the fetch fails.","title":"getImage(date, geometry)"},{"location":"sentinelhub/getimage/#export","text":"The module exports the getImage function, making it available for other parts of the application to use.","title":"Export"},{"location":"sentinelhub/getstatistics/","text":"getStatistics.js Statistics Fetching Module This JavaScript module fetches statistical data for a given geometry and time range from Sentinel Hub. Below is a summary of the key components and functionality. Imports axios : A library for making HTTP requests. calculateDim : A custom utility module for calculating image dimensions. Main Function getStatistics(geometry, dateFrom, dateTo) Description : Fetches statistical data for a specific geometry and time range. Parameters : geometry - The geometry object. dateFrom - The start date in ISO format. dateTo - The end date in ISO format. Returns : An array of statistics data. Details Evalscript : Defines how to calculate an index (e.g., NDVI) and the bands to be used. Setup Function : Specifies the input bands and the output structure. evaluatePixel Function : Calculates the index and returns it along with the data mask. Helper Function getWidthAndHeight(geometry) : Calculates the width and height for an image based on a provided geometry. Parameters : geometry - The geometry object. Returns : An object containing the width and height for the image. Request Parameters : Width and Height : Uses getWidthAndHeight to determine the image's width and height. Authorization : Sets up the bearer token for authentication. Data Object : Contains the input geometry, data filters, and aggregation settings. Aggregation Settings : Specifies the time range, aggregation interval, and resolution. Error Handling : Returns an empty array if the request fails. Export The module exports the getStatistics function, making it available for other parts of the application to use.","title":"GetStatistics"},{"location":"sentinelhub/getstatistics/#statistics-fetching-module","text":"This JavaScript module fetches statistical data for a given geometry and time range from Sentinel Hub. Below is a summary of the key components and functionality.","title":"Statistics Fetching Module"},{"location":"sentinelhub/getstatistics/#imports","text":"axios : A library for making HTTP requests. calculateDim : A custom utility module for calculating image dimensions.","title":"Imports"},{"location":"sentinelhub/getstatistics/#main-function","text":"","title":"Main Function"},{"location":"sentinelhub/getstatistics/#details","text":"Evalscript : Defines how to calculate an index (e.g., NDVI) and the bands to be used. Setup Function : Specifies the input bands and the output structure. evaluatePixel Function : Calculates the index and returns it along with the data mask. Helper Function getWidthAndHeight(geometry) : Calculates the width and height for an image based on a provided geometry. Parameters : geometry - The geometry object. Returns : An object containing the width and height for the image. Request Parameters : Width and Height : Uses getWidthAndHeight to determine the image's width and height. Authorization : Sets up the bearer token for authentication. Data Object : Contains the input geometry, data filters, and aggregation settings. Aggregation Settings : Specifies the time range, aggregation interval, and resolution. Error Handling : Returns an empty array if the request fails.","title":"Details"},{"location":"sentinelhub/getstatistics/#export","text":"The module exports the getStatistics function, making it available for other parts of the application to use.","title":"Export"},{"location":"sentinelhub/sentinelhub/","text":"in general Satellite NDVI-image data and statistics https://www.sentinel-hub.com/ account/plan userId secret sessionId statistics process Language/framework Python Javascript two approach using Python or Javascript, this presentation uses Javasript even Pythin has much more ecample user-cases. It's possible to use Pyhon as sub-process for node/express so somekind of hybrid approach is available. When tested Python approach it's slightly faster than JavaScript approach mostly because of main developing in sentinelHub is doe using Python which could be wise considering AI which Python is the facto. this coukb done using Python as well as JavaScript ptefer approach would be because python is used for main language api environment framework is develop first But there is some reason using Javascript based approach.","title":"in general"},{"location":"sentinelhub/sentinelhub/#in-general","text":"Satellite NDVI-image data and statistics https://www.sentinel-hub.com/ account/plan userId secret sessionId","title":"in general"},{"location":"sentinelhub/sentinelhub/#statistics","text":"","title":"statistics"},{"location":"sentinelhub/sentinelhub/#process","text":"","title":"process"},{"location":"sentinelhub/sentinelhub/#languageframework","text":"","title":"Language/framework"},{"location":"sentinelhub/sentinelhub/#python","text":"","title":"Python"},{"location":"sentinelhub/sentinelhub/#javascript","text":"two approach using Python or Javascript, this presentation uses Javasript even Pythin has much more ecample user-cases. It's possible to use Pyhon as sub-process for node/express so somekind of hybrid approach is available. When tested Python approach it's slightly faster than JavaScript approach mostly because of main developing in sentinelHub is doe using Python which could be wise considering AI which Python is the facto. this coukb done using Python as well as JavaScript ptefer approach would be because python is used for main language api environment framework is develop first But there is some reason using Javascript based approach.","title":"Javascript"},{"location":"sentinelhub/sentinelhub_auth/","text":"TSEKKAA DIAGRAMS!!!!! koska sentinelhub token yhteys tarvitaan vain ndvi-contollers.js:ss\u00e4 niin eik\u00e4 globa authoteken voisi olla ja cron p\u00e4ivitt\u00e4isi sit\u00e4 tai tekisi tietyinnv\u00e4liajoin tsekin!!! kerro mit\u00e4 pit\u00e4\u00e4 huomioda kun/jos pit\u00e4\u00e4 kutsua muuten kuin middlewaren kautta er\u00e4iss\u00e4 poikkeustapauksissa silloin kun pitki\u00e4 sessioita midllewaren kautta check ei toimi kun sen kerran mutta TESTAA ett\u00e4 kun laittaa toisen setin niin toimiiko check mutta se ei kuitenkaan uusi tokenia JOTEn t\u00e4ytyy v\u00e4litt\u00e4\u00e4 activaterouteen check ja kutsua sit\u00e4 \"sopivassa\" \"kohtaa\" muuta tiedoston nimi authetication.js tms. user on erikseeen smanniminen mutta eri hakemistossa esim.user user (node/express-server) for sentinelhub service needs service plan with the values are stored into .env file e.g. sentinelHubClientId = \"6c9c641b-cc70-4595-8007-360b09cd533a\" sentinelHubClientSecret = \"88myeh2ksnUjQjcCMTL580HAkoifxYgR\" instanceId = \"8c9fd4ff-f38d-42ef-aad2-0f0a2d0d7bfa\" in production env should be stored in secrets of the server sequenceDiagram autonumber participant Server participant Sentinelhub Note left of Server: ndvi_controller.js Server ->> Sentinelhub: Request authToken Sentinelhub -->> Server: authToken (60 min.) Server ->> Server: checkToken(authToken) alt Token about to expire Server ->> Sentinelhub: Request authToken Sentinelhub -->> Server: Updated authToken (60 min.) end checkToken is used in ndvi_controller.js for list and image routes as middleware Point 1 in ndvi_controller.js request for sentinelHub token params: clientId, clientSecret Point 2 token to global varaiable authToken When request for token from sentinelhub it will be expired in 60 min, so it need to be refreshed actually asking for new so expiration need to be checked for a while on serverside code on backend server code request for token ../utils/authenticate.js request for the time left for the expiration ../utils/checkToken.js var authToken is holding the token to sentinelHub it is a global variable the scope just in the code of ndvi_cotroller.js There is not sense to request token for every request but the status an left time will be asked Middleware checkstatus w there is limit for request token during time.. this may be the clearest and most solid simple way!!!! mainitse OAUTH2 token middleware can be used just for specifig route token kokeilu siirretty middlewareen koko kirjautuminen MUTTA ehtii mahd. joissakin tapaukissa jos esim. kauan kest\u00e4v\u00e4 prosessi niin voi j\u00e4\u00e4d\u00e4 uusiminen, sama ongelma kuin AIKAISEMMINKin eli pitkiss\u00e4 pit\u00e4is olla kutsu usemmaoin tsekkaukseen 10min vara!!! Itse good and convenient way to check token in middleware but if very long process eik\u00e4 muu prosessi uusi SIIS onko token sama varmaankin joka sessiolle!!!! mihin talletetaan onko kompomnentin sis\u00e4ll\u00e4 k\u00e4ytet\u00e4\u00e4n my\u00f6s statisticksissa beareer versiona when module/component is defined or taken in action const middleware = require('../utils/sentinelhub_token') new token for sentinelhub is requested first time and in the future refresing actually getting new will be handled by middleware everytime request for the route token expiration time will be compared to current time, elapsed time when if the remaining tme is which defined expiration time is 60 min Kuva aikaisemmin siihe liittyen t\u00e4m\u00e4 middleware jolloin note ndvi_controller.js on v\u00e4\u00e4r\u00e4 tai miten sen ottaa ndvi-routes.js const middleware = require('../middlewares/sentinelhub_token') router.post('/list', middleware.checkToken,ndviControllers.list); explanation global variable autToken, method to rwust token is executed when module is required when servers is started.","title":"Authentication"},{"location":"sentinelhub/sentinelhub_token/","text":"sentinelhub_token.js Token Management Module This JavaScript module manages authentication tokens for Sentinel Hub. It includes functions to authenticate, check token expiration, and middleware to ensure valid tokens are attached to requests. Below is a summary of the key components and functionality. Imports sentinelHub : A library for interacting with Sentinel Hub's API. auth : A custom utility module for authenticating with Sentinel Hub. _checkToken : A custom utility module for checking token expiration. Variables authToken : A variable to store the authentication token. Functions authenticate() Description : Authenticates with Sentinel Hub and retrieves an authentication token. Returns : A promise that resolves to the authentication token. doCheckToken(request) Description : Checks the token expiration time and re-authenticates if the token is about to expire. Parameters : request - The HTTP request object. Returns : A promise that resolves when the token check and possible re-authentication are complete. Details : Retrieves the token's expiration time. Logs the expiration time. Re-authenticates if the expiration time is less than or equal to 600 seconds. checkToken(request, response, next) Description : Middleware that checks the token and attaches it to the request object. Parameters : request - The HTTP request object. response - The HTTP response object. next - The next middleware function. Returns : A promise that resolves when the middleware function completes. Details : Calls doCheckToken to ensure the token is valid. Attaches the doCheckToken function and authToken to the request object. Calls next to pass control to the next middleware function.","title":"Token"},{"location":"sentinelhub/sentinelhub_token/#token-management-module","text":"This JavaScript module manages authentication tokens for Sentinel Hub. It includes functions to authenticate, check token expiration, and middleware to ensure valid tokens are attached to requests. Below is a summary of the key components and functionality.","title":"Token Management Module"},{"location":"sentinelhub/sentinelhub_token/#imports","text":"sentinelHub : A library for interacting with Sentinel Hub's API. auth : A custom utility module for authenticating with Sentinel Hub. _checkToken : A custom utility module for checking token expiration.","title":"Imports"},{"location":"sentinelhub/sentinelhub_token/#variables","text":"authToken : A variable to store the authentication token.","title":"Variables"},{"location":"sentinelhub/sentinelhub_token/#functions","text":"","title":"Functions"},{"location":"sentinelhub/sentinelhub_token/#authenticate","text":"Description : Authenticates with Sentinel Hub and retrieves an authentication token. Returns : A promise that resolves to the authentication token.","title":"authenticate()"},{"location":"sentinelhub/sentinelhub_token/#dochecktokenrequest","text":"Description : Checks the token expiration time and re-authenticates if the token is about to expire. Parameters : request - The HTTP request object. Returns : A promise that resolves when the token check and possible re-authentication are complete. Details : Retrieves the token's expiration time. Logs the expiration time. Re-authenticates if the expiration time is less than or equal to 600 seconds.","title":"doCheckToken(request)"},{"location":"sentinelhub/sentinelhub_token/#checktokenrequest-response-next","text":"Description : Middleware that checks the token and attaches it to the request object. Parameters : request - The HTTP request object. response - The HTTP response object. next - The next middleware function. Returns : A promise that resolves when the middleware function completes. Details : Calls doCheckToken to ensure the token is valid. Attaches the doCheckToken function and authToken to the request object. Calls next to pass control to the next middleware function.","title":"checkToken(request, response, next)"},{"location":"summary/summary/","text":"","title":"Summary"},{"location":"utils/utils/","text":"image/getImageData.js getPixelData : Processes the response to extract pixel data and calculate color percentages. getTemplate : Creates a template with color percentages based on the given image. getImageData : Generates image data including statistics and bounding box information. image/scales.js A template array containing objects with color information, amount, and from value. authenticate.js authenticate : Function to authenticate with Sentinel Hub API. bboxRatio.js calculateAutoDimensions : Calculates the auto dimensions for width and height based on the provided geometry, maximum width, and maximum height. calculateMaxMetersPerPixel : Calculates the maximum meters per pixel for a given geometry. calculatePixelSize : Calculates the pixel size based on the provided geometry and dimensions. calculateDim.js calculateWidth : Calculates the width dimension based on the given geometry and height. calculateHeight : Calculates the height dimension based on the given geometry and width. checkToken.js getTokenFrom : Extracts the token from the authorization header of a request. checkAuthToken : Checks the validity of the JWT token in the authorization header of a request. dateTime.js getFormattedTime : Formats the elapsed time into minutes and seconds. zeroDateTime : Sets the time of a date object to midnight (00:00:00.000). addOneDay : Adds one day to the given date. sortByDateTime : Sorts an array of objects by a specified date-time property. geoUtils.js getFeatureCollectionMultiPolygon : Gets the multi-polygon geometry from a feature collection. appendPolygon : Appends a polygon to the current geometry. isPolygon : Checks if a geometry is a polygon. isMultiPolygon : Checks if a geometry is a multi-polygon. isBbox : Checks if a geometry is a bounding box. getLatLngFromBbox : Gets the latitude and longitude coordinates from a bounding box. areAllNumbers : Checks if all elements in an array are numbers. isValidBbox : Checks if a bounding box is valid. isValidGeometry : Checks if a geometry is valid. getBboxFromCoords : Gets a bounding box from coordinates. getAreaFromGeometry : Gets the area from a geometry. getAreaFromBounds : Gets the area from a bounds object. getIntersection : Calculates the intersection of two geometries. getProperGeometry : Gets the proper geometry from bounds. getUnion : Computes the union of two geometries. getAreaCoverPercentage : Calculates the area cover percentage of one geometry over another. focusMap : Focuses on the map element. getCoordsFromBbox : Gets the coordinates from a bounding box. hash.js sha256 : Calculates the SHA-256 hash of a given geometry object or string. isdateingrowingseason.js isDateInGrowingSeason : Checks if a given date falls within the specified growing season. middleware.js getTokenFrom : Retrieves the token from the request headers. tokenExtractor : Middleware for extracting and verifying JWT token from requests. scheduleUpdateDb.js start : Starts a cron job that runs the provided callback function at regular intervals. stop : Stops the currently running cron job.","title":"Utilities"},{"location":"utils/utils/#imagegetimagedatajs","text":"getPixelData : Processes the response to extract pixel data and calculate color percentages. getTemplate : Creates a template with color percentages based on the given image. getImageData : Generates image data including statistics and bounding box information.","title":"image/getImageData.js"},{"location":"utils/utils/#imagescalesjs","text":"A template array containing objects with color information, amount, and from value.","title":"image/scales.js"},{"location":"utils/utils/#authenticatejs","text":"authenticate : Function to authenticate with Sentinel Hub API.","title":"authenticate.js"},{"location":"utils/utils/#bboxratiojs","text":"calculateAutoDimensions : Calculates the auto dimensions for width and height based on the provided geometry, maximum width, and maximum height. calculateMaxMetersPerPixel : Calculates the maximum meters per pixel for a given geometry. calculatePixelSize : Calculates the pixel size based on the provided geometry and dimensions.","title":"bboxRatio.js"},{"location":"utils/utils/#calculatedimjs","text":"calculateWidth : Calculates the width dimension based on the given geometry and height. calculateHeight : Calculates the height dimension based on the given geometry and width.","title":"calculateDim.js"},{"location":"utils/utils/#checktokenjs","text":"getTokenFrom : Extracts the token from the authorization header of a request. checkAuthToken : Checks the validity of the JWT token in the authorization header of a request.","title":"checkToken.js"},{"location":"utils/utils/#datetimejs","text":"getFormattedTime : Formats the elapsed time into minutes and seconds. zeroDateTime : Sets the time of a date object to midnight (00:00:00.000). addOneDay : Adds one day to the given date. sortByDateTime : Sorts an array of objects by a specified date-time property.","title":"dateTime.js"},{"location":"utils/utils/#geoutilsjs","text":"getFeatureCollectionMultiPolygon : Gets the multi-polygon geometry from a feature collection. appendPolygon : Appends a polygon to the current geometry. isPolygon : Checks if a geometry is a polygon. isMultiPolygon : Checks if a geometry is a multi-polygon. isBbox : Checks if a geometry is a bounding box. getLatLngFromBbox : Gets the latitude and longitude coordinates from a bounding box. areAllNumbers : Checks if all elements in an array are numbers. isValidBbox : Checks if a bounding box is valid. isValidGeometry : Checks if a geometry is valid. getBboxFromCoords : Gets a bounding box from coordinates. getAreaFromGeometry : Gets the area from a geometry. getAreaFromBounds : Gets the area from a bounds object. getIntersection : Calculates the intersection of two geometries. getProperGeometry : Gets the proper geometry from bounds. getUnion : Computes the union of two geometries. getAreaCoverPercentage : Calculates the area cover percentage of one geometry over another. focusMap : Focuses on the map element. getCoordsFromBbox : Gets the coordinates from a bounding box.","title":"geoUtils.js"},{"location":"utils/utils/#hashjs","text":"sha256 : Calculates the SHA-256 hash of a given geometry object or string.","title":"hash.js"},{"location":"utils/utils/#isdateingrowingseasonjs","text":"isDateInGrowingSeason : Checks if a given date falls within the specified growing season.","title":"isdateingrowingseason.js"},{"location":"utils/utils/#middlewarejs","text":"getTokenFrom : Retrieves the token from the request headers. tokenExtractor : Middleware for extracting and verifying JWT token from requests.","title":"middleware.js"},{"location":"utils/utils/#scheduleupdatedbjs","text":"start : Starts a cron job that runs the provided callback function at regular intervals. stop : Stops the currently running cron job.","title":"scheduleUpdateDb.js"},{"location":"video/video/","text":"Devmode morgn tulostukset My\u00f6s show users from data studio insert new user-> show on datastudio show statistics on datastudio how many dates ja milt\u00e4 yksi tietue n\u00e4ytt\u00e4\u00e4 show image and show how on image shows Deployment to Azure commands from VSCODE Docker dektop, devops pipeline Azure Portal n\u00e4kym\u00e4 register , web server, log","title":"Video"},{"location":"video/video/#deployment-to-azure-commands-from-vscode-docker-dektop-devops-pipeline","text":"","title":"Deployment to Azure commands from VSCODE Docker dektop, devops pipeline"},{"location":"video/video/#azure-portal","text":"n\u00e4kym\u00e4 register , web server, log","title":"Azure Portal"}]}